<!DOCTYPE html>
<html lang="en" class="theme-black">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>AblesAI | Pre-Qualification Engine</title>
  
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg viewBox='0 0 64 64' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cellipse cx='32' cy='32' rx='28' ry='8' stroke='%23ea580c' stroke-width='2.5' fill='none' transform='rotate(-20 32 32)' stroke-dasharray='70 140'/%3E%3Ccircle cx='32' cy='32' r='12' fill='%23eab308'/%3E%3Cellipse cx='32' cy='32' rx='28' ry='8' stroke='%23ea580c' stroke-width='2.5' fill='none' transform='rotate(-20 32 32)' stroke-dasharray='70 140' stroke-dashoffset='-70'/%3E%3Ccircle cx='54' cy='26' r='4' fill='%23a855f7'/%3E%3C/svg%3E">
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { 
            sans: ['Plus Jakarta Sans', 'sans-serif'],
            mono: ['monospace']
          },
          colors: {
            emerald: {
              450: '#34d399',
              550: '#10b981'
            },
            neutral: { 
              850: '#1a1a1a',
              925: '#0d0d0d'
            }
          }
        }
      }
    }
  </script>

  <style>
    /* ============================================
       BLACK THEME (AMOLED) - from agent-underwriter.html
       ============================================ */
    :root,
    .theme-black {
      --bg-body: #000000;
      --bg-body-gradient: linear-gradient(135deg, #000000 0%, #050505 100%);
      --bg-card: #121212;
      --bg-card-inner: #0a0a0a;
      --bg-input: #1f1f1f;
      --bg-toggle: #1f1f1f;
      --bg-option-card: #0a0a0a;
      --bg-stat-hover: rgba(16, 185, 129, 0.2);
      --border-primary: #2a2a2a;
      --border-secondary: #1a1a1a;
      --text-primary: #f5f5f5;
      --text-secondary: #a3a3a3;
      --text-muted: #666666;
      --slider-track: #2a2a2a;
      --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.5);
      --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.6), 0 2px 4px -2px rgb(0 0 0 / 0.5);
      --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.7), 0 4px 6px -4px rgb(0 0 0 / 0.6);
      --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.7), 0 8px 10px -6px rgb(0 0 0 / 0.6);
      --preview-header-bg: linear-gradient(135deg, #000000 0%, #0a0a0a 50%, #000000 100%);
      --preview-header-text: #f5f5f5;
      --pattern-color: rgba(255,255,255,0.01);
      --chart-bg: #1f1f1f;
      --modal-overlay: rgba(0, 0, 0, 0.9);
      --accent: #10b981;
      --accent-light: #34d399;
      --accent-dark: #059669;
      --accent-glow: rgba(16, 185, 129, 0.15);
      --accent-text: #ffffff;
      --accent-rgb: 16, 185, 129;
    }

    * {
      -webkit-font-smoothing: antialiased;
    }

    body {
      background: var(--bg-body-gradient);
      min-height: 100vh;
    }

    /* ============================================
       CARDS
       ============================================ */
    .card {
      background: var(--bg-card);
      border-radius: 20px;
      border: 1px solid var(--border-secondary);
      box-shadow: var(--shadow-md);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .card:hover {
      box-shadow: var(--shadow-lg);
    }

    /* ============================================
       TAB NAVIGATION
       ============================================ */
    /* ============================================
       MAIN HEADER
       ============================================ */
    .orbiting-moon {
      transform-origin: 32px 32px;
      animation: orbit 3s linear infinite, moonColor 2s ease-in-out infinite;
    }
    @keyframes orbit {
      0% { transform: rotate(-20deg) translate(26px, 0) scale(1); opacity: 1; }
      12.5% { transform: rotate(-20deg) translate(18px, 5px) scale(0.9); opacity: 1; }
      25% { transform: rotate(-20deg) translate(0, 7px) scale(0.75); opacity: 0.7; }
      37.5% { transform: rotate(-20deg) translate(-18px, 5px) scale(0.6); opacity: 0.5; }
      50% { transform: rotate(-20deg) translate(-26px, 0) scale(0.5); opacity: 0.4; }
      62.5% { transform: rotate(-20deg) translate(-18px, -5px) scale(0.6); opacity: 0.5; }
      75% { transform: rotate(-20deg) translate(0, -7px) scale(0.75); opacity: 0.7; }
      87.5% { transform: rotate(-20deg) translate(18px, -5px) scale(0.9); opacity: 1; }
      100% { transform: rotate(-20deg) translate(26px, 0) scale(1); opacity: 1; }
    }
    @keyframes moonColor {
      0%, 100% { fill: #a855f7; }
      25% { fill: #3b82f6; }
      50% { fill: #ec4899; }
      75% { fill: #10b981; }
    }

    .main-header {
      display: flex;
      flex-direction: row;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 10px 24px;
      background: var(--bg-card);
      border-bottom: 1px solid var(--border-secondary);
      position: relative;
    }

    .main-header svg:first-of-type {
      width: 24px;
      height: 24px;
    }

    .main-header h1 {
      font-size: 16px;
      font-weight: 800;
      letter-spacing: 0.02em;
      color: var(--text-primary);
    }

    .settings-btn {
      position: absolute;
      right: 16px;
      top: 50%;
      transform: translateY(-50%);
      background: transparent;
      border: none;
      padding: 2px;
      color: var(--text-muted);
      cursor: pointer;
      transition: color 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .settings-btn:hover {
      color: var(--accent);
    }

    .settings-btn svg {
      width: 12px;
      height: 12px;
    }

    /* Settings Modal */
    .settings-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.7);
      z-index: 1000;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .settings-overlay.active {
      display: flex;
    }

    .settings-modal {
      background: var(--bg-card);
      border-radius: 16px;
      width: 100%;
      max-width: 600px;
      max-height: 90vh;
      overflow-y: auto;
      border: 1px solid var(--border-secondary);
    }

    .settings-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 16px 20px;
      border-bottom: 1px solid var(--border-secondary);
    }

    .settings-header h2 {
      font-size: 18px;
      font-weight: 700;
      color: var(--text-primary);
    }

    .settings-close {
      background: none;
      border: none;
      color: var(--text-muted);
      cursor: pointer;
      padding: 4px;
    }

    .settings-close:hover {
      color: var(--text-primary);
    }

    .settings-body {
      padding: 20px;
    }

    .settings-section {
      margin-bottom: 24px;
    }

    .settings-section:last-child {
      margin-bottom: 0;
    }

    .settings-section-title {
      font-size: 12px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--text-muted);
      margin-bottom: 12px;
    }

    .settings-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 16px;
      background: var(--bg-card-inner);
      border-radius: 8px;
      margin-bottom: 8px;
    }

    .settings-row:last-child {
      margin-bottom: 0;
    }

    .settings-row-label {
      font-size: 14px;
      font-weight: 500;
      color: var(--text-primary);
    }

    .settings-row-desc {
      font-size: 12px;
      color: var(--text-muted);
      margin-top: 2px;
    }

    /* Toggle Switch */
    .toggle-switch {
      position: relative;
      width: 48px;
      height: 26px;
      background: var(--bg-main);
      border-radius: 13px;
      cursor: pointer;
      transition: background 0.2s ease;
    }

    .toggle-switch.active {
      background: var(--accent);
    }

    .toggle-switch::after {
      content: '';
      position: absolute;
      top: 3px;
      left: 3px;
      width: 20px;
      height: 20px;
      background: #fff;
      border-radius: 50%;
      transition: transform 0.2s ease;
    }

    .toggle-switch.active::after {
      transform: translateX(22px);
    }

    /* Model Adjustment Sliders */
    .model-slider-row {
      padding: 12px 16px;
      background: var(--bg-card-inner);
      border-radius: 8px;
      margin-bottom: 8px;
    }

    .model-slider-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 8px;
    }

    .model-slider-label {
      font-size: 13px;
      font-weight: 600;
      color: var(--text-primary);
    }

    .model-slider-value {
      font-size: 13px;
      font-weight: 700;
      color: var(--accent);
      min-width: 50px;
      text-align: right;
    }

    .model-slider-desc {
      font-size: 11px;
      color: var(--text-muted);
      margin-bottom: 8px;
    }

    .model-slider-input {
      width: 100%;
      height: 6px;
      -webkit-appearance: none;
      appearance: none;
      background: var(--bg-main);
      border-radius: 3px;
      outline: none;
    }

    .model-slider-input::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 16px;
      height: 16px;
      background: var(--accent);
      border-radius: 50%;
      cursor: pointer;
    }

    .model-slider-input::-moz-range-thumb {
      width: 16px;
      height: 16px;
      background: var(--accent);
      border-radius: 50%;
      cursor: pointer;
      border: none;
    }

    .settings-reset-btn {
      width: 100%;
      padding: 12px;
      background: var(--bg-card-inner);
      border: 1px solid var(--border-secondary);
      border-radius: 8px;
      color: var(--text-muted);
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      margin-top: 12px;
      transition: all 0.2s ease;
    }

    .settings-reset-btn:hover {
      border-color: var(--accent);
      color: var(--text-primary);
    }

    /* Light Theme */
    body.light-theme {
      --bg-body: #f8fafc;
      --bg-body-gradient: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
      --bg-main: #f8fafc;
      --bg-card: #ffffff;
      --bg-card-inner: #f1f5f9;
      --bg-input: #e2e8f0;
      --bg-toggle: #e2e8f0;
      --bg-option-card: #f8fafc;
      --bg-stat-hover: rgba(16, 185, 129, 0.15);
      --border-primary: #cbd5e1;
      --border-secondary: #e2e8f0;
      --text-primary: #0f172a;
      --text-secondary: #475569;
      --text-muted: #64748b;
      --slider-track: #cbd5e1;
      --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
      --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.08), 0 2px 4px -2px rgb(0 0 0 / 0.05);
      --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.08), 0 4px 6px -4px rgb(0 0 0 / 0.05);
      --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.05);
      --preview-header-bg: linear-gradient(135deg, #ffffff 0%, #f8fafc 50%, #ffffff 100%);
      --preview-header-text: #0f172a;
      --pattern-color: rgba(0,0,0,0.02);
      --chart-bg: #f1f5f9;
      --modal-overlay: rgba(0, 0, 0, 0.4);
    }

    /* Header */
    body.light-theme .main-header {
      background: #ffffff;
      border-bottom-color: #e2e8f0;
    }

    body.light-theme .main-header h1 span:first-child {
      color: #0f172a !important;
    }

    body.light-theme .main-header h1 span:last-child {
      color: #64748b !important;
    }

    /* Settings button */
    body.light-theme .settings-btn {
      color: #64748b;
    }

    body.light-theme .settings-btn:hover {
      color: var(--accent);
    }

    /* Tabs */
    body.light-theme .tab-nav {
      background: #ffffff;
      border-bottom-color: #e2e8f0;
    }

    body.light-theme .tab-btn {
      color: #64748b;
    }

    body.light-theme .tab-btn.active {
      color: #0f172a;
    }

    /* Cards */
    body.light-theme .card {
      background: #ffffff !important;
      border-color: #e2e8f0;
      box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    }

    body.light-theme #calcSummaryCard,
    body.light-theme .risk-card {
      background: #ffffff !important;
    }

    /* Inner card sections */
    body.light-theme .p-4.rounded-lg[style*="background: var(--bg-card)"] {
      background: #f8fafc !important;
    }

    body.light-theme [style*="background: var(--bg-card-inner)"] {
      background: #f1f5f9 !important;
    }

    /* Score breakdown bars - ensure they use proper colors */
    body.light-theme .breakdown-fill {
      opacity: 1;
    }

    /* DSCR bar */
    body.light-theme .dscr-bar-track {
      background: #e2e8f0;
    }

    body.light-theme .dscr-marker {
      background: #94a3b8;
    }

    /* Sliders */
    body.light-theme input[type="range"] {
      background: #e2e8f0;
    }

    body.light-theme .model-slider-input {
      background: #e2e8f0;
    }

    /* Score meter */
    body.light-theme .score-meter-bar {
      background: linear-gradient(to right, #ef4444, #f97316, #eab308, #22c55e, #10b981);
    }

    body.light-theme .score-meter-track {
      background: #e2e8f0;
    }

    /* Settings modal */
    body.light-theme .settings-overlay {
      background: rgba(0,0,0,0.3);
    }

    body.light-theme .settings-modal {
      background: #ffffff;
      border-color: #e2e8f0;
      box-shadow: 0 25px 50px rgba(0,0,0,0.15);
    }

    body.light-theme .settings-header {
      border-bottom-color: #e2e8f0;
    }

    body.light-theme .settings-row,
    body.light-theme .model-slider-row {
      background: #f8fafc;
    }

    body.light-theme .toggle-switch {
      background: #cbd5e1;
    }

    body.light-theme .toggle-switch.active {
      background: var(--accent);
    }

    /* Offer section */
    body.light-theme .offer-term-cell {
      background: rgba(16, 185, 129, 0.08);
    }

    body.light-theme .variance-badge {
      background: rgba(0,0,0,0.06);
    }

    /* Result card sections */
    body.light-theme .closing-breakdown {
      background: #f8fafc;
    }

    /* Section titles */
    body.light-theme .section-title {
      color: #0f172a;
    }

    /* Risk indicator text */
    body.light-theme .risk-value {
      color: #0f172a;
    }

    /* Tier badge backgrounds */
    body.light-theme .text-center.px-4.py-2.rounded-xl {
      background: #f1f5f9 !important;
    }

    /* FAB modal */
    body.light-theme .slider-modal,
    body.light-theme .slider-modal-content,
    body.light-theme .fab-modal-content {
      background: #ffffff;
      box-shadow: 0 25px 50px rgba(0,0,0,0.15);
    }

    /* Points table in MODEL INFO */
    body.light-theme .points-cell {
      border-color: #e2e8f0;
    }

    /* Ensure accent color text stays readable */
    body.light-theme [style*="color: var(--accent)"] {
      filter: brightness(0.85);
    }

    /* Settings modal text */
    body.light-theme .settings-header h2 {
      color: #0f172a;
    }

    body.light-theme .settings-section-title {
      color: #475569;
    }

    body.light-theme .settings-row-label {
      color: #0f172a;
    }

    body.light-theme .settings-row-desc {
      color: #64748b;
    }

    body.light-theme .model-slider-label {
      color: #0f172a;
    }

    body.light-theme .model-slider-desc {
      color: #64748b;
    }

    body.light-theme .settings-reset-btn {
      color: #475569;
    }

    body.light-theme .settings-reset-btn:hover {
      color: #0f172a;
    }

    /* Slider labels */
    body.light-theme .calc-slider-label,
    body.light-theme .override-slider-label {
      color: #0f172a;
    }

    /* Muted text elements */
    body.light-theme [style*="color: var(--text-muted)"] {
      color: #64748b !important;
    }

    body.light-theme [style*="color: var(--text-secondary)"] {
      color: #475569 !important;
    }

    body.light-theme [style*="color: var(--text-primary)"] {
      color: #0f172a !important;
    }

    /* Comparison labels */
    body.light-theme .comparison-label {
      color: #64748b;
    }

    body.light-theme .comparison-calc {
      color: #64748b;
    }

    /* Input fields */
    body.light-theme input[type="number"],
    body.light-theme select {
      background: #ffffff;
      border-color: #e2e8f0;
      color: #0f172a;
    }

    /* Select dropdowns */
    body.light-theme .industry-select-wrapper select {
      background: #ffffff;
      color: #0f172a;
    }

    /* Labels above inputs */
    body.light-theme label {
      color: #475569;
    }

    /* Metric subheaders - override white to dark in light theme */
    body.light-theme [style*="color: #ffffff"] {
      color: #475569 !important;
    }

    .tab-nav {
      display: flex;
      background: var(--bg-card);
      border-bottom: 1px solid var(--border-secondary);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    @media (max-width: 768px) {
      .tab-nav {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        top: auto;
        border-bottom: none;
        border-top: 1px solid var(--border-secondary);
        box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.3);
      }
      
      .tab-btn.active::before {
        top: auto;
        bottom: 0;
        border-radius: 3px 3px 0 0;
      }
      
      body {
        padding-bottom: 60px;
      }
    }

    @media (max-width: 1024px) {
      #calcRiskIndicators > div,
      #overrideRiskIndicators > div {
        border-right: none !important;
      }
    }

    .tab-btn {
      flex: 1;
      padding: 16px 24px;
      font-size: 11px;
      font-weight: 800;
      letter-spacing: 0.08em;
      color: var(--text-muted);
      background: transparent;
      border: none;
      cursor: pointer;
      transition: all 0.2s;
      position: relative;
    }

    .tab-btn:hover:not(.active) {
      color: var(--text-secondary);
    }

    .tab-btn.active {
      color: var(--accent);
      background: var(--bg-body);
    }

    .tab-btn.tab-btn-calculator.active {
      color: #eab308;
    }

    .tab-btn.tab-btn-calculator.active::before {
      background: linear-gradient(90deg, #eab308, #fde047);
    }

    .tab-btn.active::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, var(--accent), var(--accent-light));
      border-radius: 0 0 3px 3px;
    }

    .tab-panel {
      display: none;
    }

    .tab-panel.active {
      display: block;
    }

    /* ============================================
       SECTION LABELS
       ============================================ */
    .section-indicator {
      width: 4px;
      height: 24px;
      background: linear-gradient(180deg, var(--accent), var(--accent-light));
      border-radius: 4px;
    }

    .section-title {
      font-size: 11px;
      font-weight: 800;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text-secondary);
    }

    /* ============================================
       SLIDERS
       ============================================ */
    .slider {
      -webkit-appearance: none;
      appearance: none;
      height: 8px;
      background: var(--slider-track);
      border-radius: 999px;
      outline: none;
      cursor: pointer;
      overflow: visible;
      touch-action: none;
    }

    .slider::-webkit-slider-runnable-track {
      height: 8px;
      background: var(--slider-track);
      border-radius: 999px;
    }

    .slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      height: 24px;
      width: 24px;
      border-radius: 50%;
      background: white;
      border: 3px solid var(--accent);
      cursor: grab;
      box-shadow: 0 0 12px rgba(var(--accent-rgb), 0.4), 0 2px 8px rgba(0,0,0,0.12);
      transition: all 0.15s ease, border-color 1.5s ease, box-shadow 1.5s ease;
      margin-top: -8px;
    }

    .slider::-webkit-slider-thumb:hover {
      transform: scale(1.1);
      box-shadow: 0 0 20px rgba(var(--accent-rgb), 0.5), 0 4px 12px rgba(0,0,0,0.15);
    }

    .slider::-webkit-slider-thumb:active {
      cursor: grabbing;
      transform: scale(1.05);
    }

    .slider::-moz-range-thumb {
      height: 24px;
      width: 24px;
      border-radius: 50%;
      background: white;
      border: 3px solid var(--accent);
      cursor: grab;
      box-shadow: 0 0 12px rgba(var(--accent-rgb), 0.4), 0 2px 8px rgba(0,0,0,0.12);
      transition: all 0.15s ease, border-color 1.5s ease, box-shadow 1.5s ease;
    }

    .slider::-moz-range-track {
      height: 8px;
      background: var(--slider-track);
      border-radius: 999px;
    }

    /* ============================================
       CALCULATOR RESULT PREVIEW
       ============================================ */
    .calc-result-preview {
      background: var(--bg-card);
      border-radius: 28px;
      border: 4px solid var(--accent);
      width: 100%;
      box-shadow: 
        0 0 40px rgba(var(--accent-rgb), 0.25),
        0 0 80px rgba(var(--accent-rgb), 0.1),
        0 25px 50px -12px rgba(0, 0, 0, 0.25);
      overflow: hidden;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .calc-result-preview:hover {
      transform: translateY(-4px);
      box-shadow: 
        0 0 60px rgba(var(--accent-rgb), 0.35),
        0 0 100px rgba(var(--accent-rgb), 0.15),
        0 30px 60px -12px rgba(0, 0, 0, 0.3);
    }

    .calc-preview-header {
      background: var(--preview-header-bg);
      padding: 32px 24px;
      text-align: center;
      position: relative;
    }

    .calc-preview-header::before {
      content: '';
      position: absolute;
      inset: 0;
      background: 
        radial-gradient(circle at 30% 20%, rgba(var(--accent-rgb), 0.08) 0%, transparent 50%),
        radial-gradient(circle at 70% 80%, rgba(var(--accent-rgb), 0.05) 0%, transparent 40%);
      pointer-events: none;
    }

    .calc-preview-label {
      font-size: 10px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.15em;
      color: var(--text-muted);
      margin-bottom: 8px;
    }

    .calc-preview-amount {
      font-size: clamp(2rem, 6vw, 2.75rem);
      font-weight: 800;
      letter-spacing: -0.03em;
      background: linear-gradient(180deg, #ffffff 0%, #e2e8f0 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .calc-stats-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      background: var(--bg-option-card);
    }

    .calc-stat-cell {
      padding: 20px 16px;
      text-align: center;
      border-bottom: 1px solid var(--border-secondary);
    }

    .calc-stat-cell:nth-child(odd) {
      border-right: 1px solid var(--border-secondary);
    }

    .calc-stat-label {
      font-size: 9px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text-muted);
      display: block;
      margin-bottom: 4px;
    }

    .calc-stat-value {
      font-size: 18px;
      font-weight: 800;
      color: var(--text-primary);
    }

    .calc-stat-value.accent {
      color: var(--accent);
    }

    .calc-payment-display {
      padding: 32px 24px;
      text-align: center;
      background: var(--bg-card);
    }

    .calc-payment-label {
      font-size: 10px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.15em;
      color: var(--text-muted);
      margin-bottom: 8px;
    }

    .calc-payment-amount {
      font-size: 2.25rem;
      font-weight: 800;
      color: var(--text-primary);
    }

    /* ============================================
       PREVIEW STICKY WRAPPER
       ============================================ */
    .preview-sticky-wrapper {
      position: sticky;
      top: 80px;
    }

    /* ============================================
       SCORE PANEL
       ============================================ */
    .score-panel {
      background: var(--bg-option-card);
      border: 1px solid var(--border-secondary);
      border-radius: 16px;
      overflow: hidden;
      margin-bottom: 24px;
    }
    
    /* Mobile score section - hidden on desktop */
    .mobile-score-section {
      display: none;
    }

    .score-header {
      padding: 16px 20px;
      border-bottom: 1px solid var(--border-secondary);
    }

    .score-body {
      padding: 16px 20px;
    }

    .breakdown-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 12px;
    }

    .breakdown-bar-track {
      width: 96px;
      height: 8px;
      background: var(--bg-input);
      border-radius: 4px;
      overflow: hidden;
    }

    .breakdown-bar-fill {
      height: 100%;
      border-radius: 4px;
      transition: width 0.4s ease;
    }

    /* ============================================
       TIER SCALE
       ============================================ */
    .tier-scale {
      display: flex;
      border-radius: 8px;
      overflow: hidden;
      margin-top: 16px;
    }

    .tier-seg {
      flex: 1;
      padding: 8px 4px;
      text-align: center;
      font-size: 10px;
      font-weight: 700;
      color: rgba(0,0,0,0.8);
    }

    .tier-seg.tier-a { background: #10b981; }
    .tier-seg.tier-b { background: #22c55e; }
    .tier-seg.tier-c { background: #eab308; }
    .tier-seg.tier-d { background: #f97316; }
    .tier-seg.tier-e { background: #ef4444; }

    /* ============================================
       DECLINED STATE
       ============================================ */
    .declined-card {
      background: rgba(239, 68, 68, 0.1);
      border: 1px solid rgba(239, 68, 68, 0.3);
      border-radius: 16px;
      padding: 32px;
      text-align: center;
    }

    /* ============================================
       MODEL INFO SECTION
       ============================================ */
    .model-container {
      max-width: 900px;
      margin: 0 auto;
      padding: 40px 24px;
    }

    .model-card {
      background: var(--bg-card);
      border-radius: 20px;
      border: 1px solid var(--border-secondary);
      overflow: hidden;
      margin-bottom: 24px;
    }

    .model-card-header {
      padding: 16px 20px;
      border-bottom: 1px solid var(--border-secondary);
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .model-card-icon {
      width: 32px;
      height: 32px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      font-weight: 800;
      color: #000;
    }

    .model-card-body {
      padding: 20px;
    }

    .tier-table-row {
      display: flex;
      align-items: center;
      padding: 12px 0;
      border-bottom: 1px solid var(--border-secondary);
    }

    .tier-table-row:last-child {
      border-bottom: none;
    }

    .tier-badge {
      width: 32px;
      height: 32px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      font-weight: 800;
      color: #000;
      margin-right: 16px;
      flex-shrink: 0;
    }

    .donut-section {
      display: flex;
      align-items: center;
      gap: 32px;
      flex-wrap: wrap;
    }

    .donut-chart {
      position: relative;
      width: 160px;
      height: 160px;
      flex-shrink: 0;
    }

    .donut-chart svg {
      transform: rotate(-90deg);
    }

    .donut-center {
      position: absolute;
      inset: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .score-component {
      background: var(--bg-card);
      border-radius: 20px;
      border: 1px solid var(--border-secondary);
      margin-bottom: 20px;
      overflow: hidden;
    }

    .score-component-header {
      padding: 16px 20px;
      display: flex;
      align-items: center;
      gap: 12px;
      border-bottom: 1px solid var(--border-secondary);
    }

    .score-comp-badge {
      width: 40px;
      height: 40px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      font-weight: 800;
      color: #000;
    }

    .score-component-body {
      padding: 20px;
    }

    .formula-value {
      font-family: monospace;
      font-size: 13px;
      color: var(--text-secondary);
      background: var(--bg-input);
      padding: 12px 14px;
      border-radius: 8px;
      border: 1px solid var(--border-secondary);
    }

    .score-gradient-bar {
      height: 10px;
      border-radius: 5px;
      background: linear-gradient(90deg, #ef4444 0%, #f97316 25%, #eab308 50%, #22c55e 75%, #10b981 100%);
      margin-bottom: 8px;
    }

    .points-grid {
      display: flex;
      gap: 4px;
    }

    .points-cell {
      flex: 1;
      text-align: center;
      padding: 10px 4px;
      border-radius: 8px;
      font-size: 10px;
      font-weight: 700;
    }

    .tier-boxes {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
    }

    .tier-box {
      padding: 16px;
      border-radius: 12px;
      text-align: center;
      border: 2px solid;
    }

    .buffer-boxes {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
    }

    .rules-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 24px;
    }

    .rules-card {
      background: var(--bg-card);
      border-radius: 20px;
      border: 1px solid var(--border-secondary);
      overflow: hidden;
    }

    .rules-card-header {
      padding: 16px 20px;
      display: flex;
      align-items: center;
      gap: 12px;
      border-bottom: 1px solid var(--border-secondary);
    }

    .rules-icon {
      width: 28px;
      height: 28px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
    }

    .rules-card-body {
      padding: 16px 20px;
    }

    .rules-list {
      list-style: none;
    }

    .rules-list li {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 8px 0;
      font-size: 13px;
      color: var(--text-secondary);
      border-bottom: 1px solid var(--border-secondary);
    }

    .rules-list li:last-child {
      border-bottom: none;
    }

    .sizing-section {
      background: var(--bg-card);
      border-radius: 20px;
      border: 1px solid var(--border-secondary);
      padding: 24px;
      margin-bottom: 24px;
    }

    .sizing-caps {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 16px;
      margin-bottom: 24px;
    }

    .sizing-cap {
      text-align: center;
      padding: 20px;
      background: var(--bg-input);
      border-radius: 12px;
      border: 1px solid var(--border-secondary);
    }

    .example-box {
      background: var(--bg-input);
      border-radius: 12px;
      padding: 20px;
      border: 1px solid var(--border-secondary);
    }

    /* ============================================
       SCROLLBAR
       ============================================ */
    ::-webkit-scrollbar {
      width: 6px;
    }
    ::-webkit-scrollbar-track {
      background: var(--bg-body);
    }
    ::-webkit-scrollbar-thumb {
      background: var(--border-primary);
      border-radius: 3px;
    }

    /* ============================================
       OVERRIDE TAB STYLES
       ============================================ */
    .override-layout {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 24px;
    }

    @media (max-width: 1024px) {
      .override-layout {
        grid-template-columns: 1fr;
      }
      .override-layout > .override-controls-column {
        order: 2;
      }
      .override-layout > .override-result-column {
        order: 1;
      }
    }

    .variance-indicator {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      border-radius: 8px;
      font-size: 11px;
      font-weight: 700;
    }

    .variance-indicator.positive {
      background: rgba(16, 185, 129, 0.15);
      color: #10b981;
    }

    .variance-indicator.negative {
      background: rgba(239, 68, 68, 0.15);
      color: #ef4444;
    }

    .variance-indicator.neutral {
      background: rgba(234, 179, 8, 0.15);
      color: #eab308;
    }

    .gauge-container {
      position: relative;
      width: 180px;
      height: 100px;
      margin: 0 auto;
    }

    .gauge-arc {
      fill: none;
      stroke-width: 16;
      stroke-linecap: round;
    }

    .gauge-bg {
      stroke: #374151;
    }
    
    body.light-theme .gauge-bg {
      stroke: #e2e8f0;
    }

    .gauge-fill {
      transition: stroke-dashoffset 0.5s ease;
    }

    .gauge-needle {
      transition: cx 0.5s ease, cy 0.5s ease;
      fill: var(--text-primary);
      stroke: none;
    }

    .gauge-center-label {
      position: absolute;
      bottom: 5px;
      left: 50%;
      transform: translateX(-50%);
      text-align: center;
    }

    .risk-meter {
      height: 8px;
      background: var(--bg-card-inner);
      border-radius: 4px;
      overflow: hidden;
      position: relative;
    }

    .risk-meter-fill {
      height: 100%;
      border-radius: 4px;
      transition: width 0.5s ease, background 0.3s ease;
    }

    .risk-meter-zones {
      position: absolute;
      inset: 0;
      display: flex;
    }

    .risk-zone {
      flex: 1;
      border-right: 1px solid var(--bg-card);
    }

    .risk-zone:last-child {
      border-right: none;
    }

    .dscr-bar {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .dscr-bar-track {
      flex: 1;
      height: 24px;
      background: var(--bg-card-inner);
      border-radius: 12px;
      position: relative;
      overflow: hidden;
    }

    .dscr-bar-fill {
      height: 100%;
      border-radius: 12px;
      transition: width 0.5s ease, background 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: flex-end;
      padding-right: 8px;
    }

    .dscr-marker {
      position: absolute;
      top: -8px;
      bottom: -8px;
      width: 2px;
      background: var(--text-primary);
    }

    .dscr-marker::after {
      content: attr(data-label);
      position: absolute;
      top: -18px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 9px;
      font-weight: 700;
      color: var(--text-muted);
      white-space: nowrap;
    }

    .impact-chart {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
    }

    .impact-item {
      background: var(--bg-card-inner);
      border-radius: 12px;
      padding: 16px;
      text-align: center;
      border: 1px solid var(--border-secondary);
    }

    .impact-value {
      font-size: 24px;
      font-weight: 800;
      margin-bottom: 4px;
    }

    .impact-label {
      font-size: 10px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--text-muted);
    }

    .override-slider-group {
      background: var(--bg-option-card);
      border-radius: 16px;
      padding: 20px;
      border: 1px solid var(--border-secondary);
    }

    .override-slider-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 16px;
    }

    .override-value-display {
      text-align: right;
    }

    .override-value-main {
      font-size: 28px;
      font-weight: 800;
      color: var(--text-primary);
    }

    .override-value-calc {
      font-size: 11px;
      color: var(--text-muted);
    }

    .comparison-row {
      display: flex;
      justify-content: space-between;
      padding: 12px 0;
      border-bottom: 1px solid var(--border-secondary);
    }

    .comparison-row:last-child {
      border-bottom: none;
    }

    .comparison-label {
      font-size: 12px;
      color: var(--text-secondary);
    }

    .comparison-values {
      display: flex;
      gap: 16px;
      align-items: center;
    }

    .comparison-calc {
      font-size: 12px;
      color: var(--text-muted);
      text-decoration: line-through;
    }

    .comparison-override {
      font-size: 14px;
      font-weight: 700;
      color: var(--text-primary);
    }

    .pd-scale {
      display: flex;
      justify-content: space-between;
      margin-top: 8px;
    }

    .pd-scale-item {
      font-size: 9px;
      font-weight: 600;
      text-transform: uppercase;
    }

    /* ============================================
       SUMMARY SCORE BAR
       ============================================ */
    .summary-score-bar {
      position: relative;
      height: 10px;
      background: linear-gradient(90deg, 
        #ef4444 0%, 
        #f97316 25%, 
        #eab308 50%, 
        #22c55e 75%, 
        #10b981 100%
      );
      border-radius: 5px;
      overflow: visible;
    }

    .summary-score-fill {
      position: absolute;
      top: 0;
      left: 0;
      height: 100%;
      background: transparent;
      border-radius: 5px;
      transition: width 0.5s ease;
    }

    .summary-score-marker {
      position: absolute;
      top: -8px;
      transform: translateX(-50%);
      width: 0;
      height: 0;
      border-left: 6px solid transparent;
      border-right: 6px solid transparent;
      border-top: 8px solid var(--text-primary);
      transition: left 0.5s ease;
      font-size: 0;
    }
    
    .summary-score-marker::after {
      content: attr(data-score);
      position: absolute;
      top: -22px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 11px;
      font-weight: 800;
      color: var(--text-primary);
      white-space: nowrap;
    }

    /* ============================================
       PAYMENT FREQUENCY TOGGLES
       ============================================ */
    .freq-toggle-group {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .freq-toggle {
      position: relative;
    }

    .freq-toggle input {
      position: absolute;
      opacity: 0;
      width: 0;
      height: 0;
    }

    .freq-toggle-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 12px 20px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      cursor: pointer;
      transition: all 0.25s ease;
      background: var(--bg-card-inner);
      border: 2px solid var(--border-secondary);
      color: var(--text-muted);
    }

    .freq-toggle-btn:hover {
      border-color: var(--border-primary);
      color: var(--text-secondary);
    }

    .freq-toggle input:checked + .freq-toggle-btn {
      background: linear-gradient(135deg, rgba(16,185,129,0.2) 0%, rgba(16,185,129,0.1) 100%);
      border-color: #10b981;
      color: #10b981;
      box-shadow: 0 0 20px rgba(16,185,129,0.2);
    }

    /* ============================================
       CALC LAYOUT (matching override-layout)
       ============================================ */
    .calc-layout {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 24px;
    }

    /* Score section wrapper - centered above results */
    .score-section-wrapper {
      margin-bottom: 24px;
    }
    
    /* Hide duplicate score card in drawer - shown separately above */
    .score-card-desktop {
      display: none;
    }

    /* Panel toggle handle - hidden on desktop */
    .mobile-panel-handle {
      display: none;
    }
    
    .drawer-label {
      display: none;
    }
    
    .drawer-chevrons {
      display: none;
    }

    /* ============================================
       RESPONSIVE - MOBILE
       ============================================ */
    @media (max-width: 1024px) {
      .calc-layout {
        display: block;
      }
      
      /* Results column full width */
      .calc-result-column {
        max-width: 100%;
        padding-bottom: 80px; /* Space for FAB */
      }
      
      /* Hide sliders column - controlled by modal */
      .calc-controls-column {
        display: none !important;
      }
      
      /* Floating Action Button */
      .slider-fab {
        display: flex !important;
        position: fixed;
        bottom: 70px;
        right: 16px;
        width: 56px;
        height: 56px;
        border-radius: 50%;
        background: var(--accent);
        border: none;
        box-shadow: 0 4px 16px rgba(16, 185, 129, 0.35);
        cursor: pointer;
        z-index: 200;
        align-items: center;
        justify-content: center;
        transition: transform 0.2s, box-shadow 0.2s;
        color: #000;
      }
      
      .slider-fab:active {
        transform: scale(0.95);
      }
      
      .slider-fab svg {
        width: 24px;
        height: 24px;
      }
      
      .slider-fab.hidden {
        display: none !important;
      }
      
      /* Slider Modal - expands from button */
      .slider-modal-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0,0,0,0.85);
        z-index: 300;
        align-items: center;
        justify-content: center;
        padding: 12px;
      }
      
      .slider-modal-overlay.active {
        display: flex !important;
      }
      
      /* Slider Modal Panel - FULL WIDTH HORIZONTAL */
      .slider-modal {
        width: 100%;
        max-width: 95vw;
        max-height: 90vh;
        background: var(--bg-card);
        border-radius: 16px;
        padding: 20px;
        overflow-y: auto;
        transform-origin: center center;
        animation: expandFromFab 0.25s ease-out;
        border: 1px solid var(--border-primary);
        box-shadow: 0 8px 40px rgba(0,0,0,0.5);
      }
      
      @keyframes expandFromFab {
        from { 
          transform: scale(0.3);
          opacity: 0;
        }
        to { 
          transform: scale(1);
          opacity: 1;
        }
      }
      
      /* Score Meter in Modal - PROMINENT HORIZONTAL BAR */
      .modal-score-meter {
        background: var(--bg-option-card);
        border-radius: 12px;
        padding: 16px;
        margin-bottom: 12px;
        border: 1px solid var(--border-secondary);
      }
      
      .modal-score-header {
        display: flex;
        align-items: center;
        gap: 16px;
        margin-bottom: 0;
      }
      
      .modal-score-info {
        display: flex;
        align-items: center;
        gap: 12px;
        flex-shrink: 0;
      }
      
      .modal-tier-badge {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        width: 52px;
        height: 52px;
        border-radius: 10px;
        background: rgba(0,0,0,0.3);
        border: 2px solid currentColor;
      }
      
      .modal-tier-letter {
        font-size: 24px;
        font-weight: 900;
        line-height: 1;
      }
      
      .modal-tier-label {
        font-size: 8px;
        font-weight: 700;
        color: var(--text-muted);
        text-transform: uppercase;
        margin-top: 2px;
        white-space: nowrap;
      }
      
      .modal-score-text {
        display: flex;
        flex-direction: column;
      }
      
      .modal-score-label {
        font-size: 9px;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        color: var(--text-muted);
        margin-bottom: 2px;
      }
      
      .modal-score-value {
        display: flex;
        align-items: baseline;
        gap: 2px;
      }
      
      .modal-score-number {
        font-size: 28px;
        font-weight: 800;
        color: var(--text-primary);
        line-height: 1;
      }
      
      .modal-score-max {
        font-size: 12px;
        font-weight: 600;
        color: var(--text-muted);
      }
      
      .modal-score-bar-container {
        flex: 1;
      }
      
      .modal-score-bar {
        height: 10px;
        background: rgba(255,255,255,0.08);
        border-radius: 5px;
        position: relative;
        overflow: visible;
      }
      
      .modal-score-bar-fill {
        height: 100%;
        border-radius: 5px;
        background: linear-gradient(90deg, #ef4444 0%, #f97316 25%, #eab308 50%, #22c55e 75%, #10b981 100%);
        transition: width 0.3s ease;
      }
      
      .modal-score-bar-marker {
        position: absolute;
        top: -4px;
        width: 3px;
        height: 18px;
        background: white;
        border-radius: 2px;
        transform: translateX(-50%);
        box-shadow: 0 2px 6px rgba(0,0,0,0.4);
      }
      
      .modal-score-scale {
        display: flex;
        justify-content: space-between;
        margin-top: 6px;
        font-size: 9px;
        font-weight: 700;
      }
      
      .modal-score-scale span {
        text-align: center;
        flex: 1;
      }
      
      /* Offer Terms Section */
      .modal-offer-terms {
        margin-bottom: 12px;
      }
      
      .modal-section-label {
        font-size: 9px;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 1px;
        color: var(--accent);
        margin-bottom: 8px;
        text-align: center;
      }
      
      .slider-cell.offer-term-cell {
        background: var(--bg-option-card) !important;
        border: 1px solid var(--border-secondary) !important;
        text-align: center;
        padding: 12px 8px !important;
      }
      
      .slider-cell.offer-term-cell label {
        font-size: 8px !important;
        margin-bottom: 4px !important;
      }
      
      .slider-cell.offer-term-cell .value {
        font-size: 20px !important;
        color: var(--accent) !important;
        font-weight: 800 !important;
      }
      
      /* Override modal variance styling */
      .modal-override-section {
        margin-top: 8px;
      }
      
      .override-value-row {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
      }
      
      .variance-badge {
        font-size: 10px;
        padding: 2px 6px;
        border-radius: 4px;
        background: rgba(100,100,100,0.3);
        color: var(--text-muted);
        font-weight: 500;
      }
      
      .variance-badge.positive {
        background: rgba(239, 68, 68, 0.2);
        color: #ef4444;
      }
      
      .variance-badge.negative {
        background: rgba(16, 185, 129, 0.2);
        color: #10b981;
      }
      
      .slider-cell.override-slider-cell {
        background: var(--bg-option-card) !important;
        border: 1px solid var(--border-secondary) !important;
      }
      
      /* Compact Inline Risk Metrics */
      .modal-risk-metrics-inline {
        display: flex;
        gap: 12px;
        margin-top: 8px;
        padding: 10px 12px;
        background: var(--bg-option-card);
        border: 1px solid var(--border-secondary);
        border-radius: 10px;
      }
      
      .modal-pd-inline {
        display: flex;
        align-items: center;
        gap: 8px;
        flex: 1;
      }
      
      .modal-pd-gauge-small {
        position: relative;
      }
      
      .modal-pd-info {
        display: flex;
        flex-direction: column;
      }
      
      .modal-pd-number {
        font-size: 16px;
        font-weight: 800;
        color: var(--text-primary);
      }
      
      .modal-pd-text {
        font-size: 8px;
        font-weight: 700;
        text-transform: uppercase;
        color: var(--text-muted);
      }
      
      .modal-dscr-inline {
        display: flex;
        align-items: center;
        gap: 8px;
        flex: 1.5;
      }
      
      .modal-dscr-mini-bar {
        flex: 1;
        height: 16px;
        background: rgba(255,255,255,0.1);
        border-radius: 8px;
        overflow: hidden;
      }
      
      .modal-dscr-mini-fill {
        height: 100%;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: flex-end;
        padding-right: 6px;
        transition: width 0.3s ease;
      }
      
      .modal-dscr-mini-fill span {
        font-size: 8px;
        font-weight: 800;
        color: #000;
      }
      
      .modal-dscr-info {
        display: flex;
        flex-direction: column;
        min-width: 50px;
      }
      
      .modal-dscr-number {
        font-size: 16px;
        font-weight: 800;
        color: #10b981;
      }
      
      .modal-dscr-text {
        font-size: 8px;
        font-weight: 700;
        text-transform: uppercase;
        color: var(--text-muted);
      }
      
      /* Hide old modal risk metrics styles - keep for reference */
      .modal-risk-metrics {
        display: none;
      }
      
      .modal-score-bar-fill {
        height: 100%;
        border-radius: 4px;
        background: linear-gradient(90deg, #ef4444 0%, #f97316 25%, #eab308 50%, #22c55e 75%, #10b981 100%);
        transition: width 0.3s ease;
      }
      
      .modal-score-bar-marker {
        position: absolute;
        top: -4px;
        width: 3px;
        height: 16px;
        background: white;
        border-radius: 2px;
        transform: translateX(-50%);
        box-shadow: 0 2px 4px rgba(0,0,0,0.3);
      }
      
      .modal-score-scale {
        display: flex;
        justify-content: space-between;
        margin-top: 6px;
        font-size: 8px;
        font-weight: 700;
      }
      
      .modal-score-scale span {
        text-align: center;
        flex: 1;
      }
      
      .slider-modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0 0 12px;
        border-bottom: 1px solid var(--border-secondary);
        margin-bottom: 12px;
      }
      
      .slider-modal-title {
        font-size: 12px;
        font-weight: 800;
        text-transform: uppercase;
        letter-spacing: 1px;
        color: var(--text-primary);
      }
      
      .slider-modal-close {
        width: 32px;
        height: 32px;
        border-radius: 8px;
        background: var(--bg-option-card);
        border: 1px solid var(--border-secondary);
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--text-muted);
        font-size: 20px;
        transition: all 0.2s;
      }
      
      .slider-modal-close:hover {
        background: rgba(255,255,255,0.1);
        color: var(--text-primary);
      }
      
      /* Slider grid inside modal - 3 columns for horizontal layout */
      .slider-modal .sliders-grid {
        display: grid !important;
        grid-template-columns: repeat(3, 1fr) !important;
        gap: 8px !important;
      }
      
      .slider-modal .slider-cell {
        padding: 12px 10px !important;
        border-radius: 12px !important;
        background: var(--bg-option-card) !important;
        border: 1px solid var(--border-secondary) !important;
      }
      
      .slider-modal .slider-cell label {
        font-size: 8px !important;
        margin-bottom: 4px !important;
        display: block;
        color: var(--text-muted);
        text-transform: uppercase;
        font-weight: 700;
        letter-spacing: 0.3px;
      }
      
      .slider-modal .slider-cell .value {
        font-size: 20px !important;
        font-weight: 800;
        color: var(--text-primary);
        margin-bottom: 8px;
      }
      
      .slider-modal .slider-cell input[type="range"] {
        width: 100%;
        height: 6px !important;
      }
      
      /* Toggle sections in modal - 1x2 grid */
      .slider-modal .toggles-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 8px;
        margin-top: 12px;
      }
      
      .slider-modal .toggle-section {
        padding: 12px;
        background: var(--bg-option-card);
        border: 1px solid var(--border-secondary);
        border-radius: 12px;
      }
      
      .slider-modal .toggle-section label {
        font-size: 8px;
        color: var(--text-muted);
        text-transform: uppercase;
        font-weight: 700;
        letter-spacing: 0.3px;
        display: block;
        text-align: center;
        margin-bottom: 10px;
      }
      
      .slider-modal .toggle-section .freq-toggle-group {
        flex-direction: row;
        gap: 6px;
        justify-content: center;
      }
      
      .slider-modal .toggle-section .freq-toggle-btn {
        padding: 8px 14px;
        font-size: 11px;
        font-weight: 700;
      }
      
      /* Override grid - 3 columns */
      .slider-modal .override-grid {
        grid-template-columns: repeat(3, 1fr) !important;
      }
      
      .slider-modal .override-grid .full-width {
        grid-column: 1 / -1;
      }
      
      /* Override modal toggle section */
      #modalOverrideContent .toggle-section {
        padding: 12px;
        background: var(--bg-option-card);
        border: 1px solid var(--border-secondary);
        border-radius: 12px;
      }
      
      #modalOverrideContent .toggle-section label {
        font-size: 8px;
        color: var(--text-muted);
        text-transform: uppercase;
        font-weight: 700;
        letter-spacing: 0.3px;
        display: block;
        text-align: center;
        margin-bottom: 10px;
      }
      
      #modalOverrideContent .toggle-section .freq-toggle-group {
        justify-content: center;
      }
      
      #modalOverrideContent .toggle-section .freq-toggle-btn {
        padding: 8px 14px;
        font-size: 11px;
        font-weight: 700;
      }
      
      /* Override layout */
      .override-layout {
        display: block;
      }
      
      .override-result-column {
        padding-bottom: 80px;
      }
      
      .override-controls-column {
        display: none !important;
      }
      
      /* Override tab mobile optimizations */
      #tab-override .card.p-3 {
        padding: 8px !important;
      }
      
      #tab-override .card .p-4 {
        padding: 10px !important;
      }
      
      /* Summary bar compact on mobile */
      #tab-override .flex.items-center.justify-between {
        flex-direction: column;
        align-items: stretch;
        gap: 12px;
      }
      
      #tab-override .flex.items-center.gap-6.flex-1 {
        justify-content: center;
      }
      
      #tab-override .flex.gap-6.flex-shrink-0 {
        justify-content: space-around;
        width: 100%;
      }
      
      /* Make score bar smaller on mobile */
      #tab-override .min-w-\[200px\] {
        min-width: 150px !important;
      }
      
      /* Risk analytics row - stack vertically */
      #overrideRiskIndicators {
        gap: 8px !important;
      }
      
      #overrideRiskIndicators > div {
        padding: 10px !important;
      }
      
      /* Override result card compact */
      #overrideResultCard .calc-preview-header {
        padding: 16px !important;
      }
      
      #overrideResultCard .calc-stats-grid {
        gap: 0 !important;
      }
      
      #overrideResultCard .p-4 {
        padding: 12px !important;
      }
    }
    
    /* Hide FAB on desktop */
    .slider-fab {
      display: none;
    }
    
    .slider-modal-overlay {
      display: none;
    }

    @media (max-width: 768px) {
      .tier-boxes, .buffer-boxes {
        grid-template-columns: repeat(2, 1fr);
      }
      .rules-grid, .sizing-caps {
        grid-template-columns: 1fr;
      }
      .calc-result-preview {
        border-radius: 20px;
        border-width: 3px;
      }
    }
  </style>
</head>
<body class="min-h-screen font-sans">

  <!-- MAIN HEADER -->
  <header class="main-header">
    <svg viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
      <!-- Back half of ring (behind planet) -->
      <ellipse cx="32" cy="32" rx="28" ry="8" stroke="#ea580c" stroke-width="2.5" fill="none" transform="rotate(-20 32 32)" stroke-dasharray="70 140"/>
      <!-- Planet -->
      <circle cx="32" cy="32" r="12" fill="#eab308"/>
      <!-- Front half of ring (in front of planet) -->
      <ellipse cx="32" cy="32" rx="28" ry="8" stroke="#ea580c" stroke-width="2.5" fill="none" transform="rotate(-20 32 32)" stroke-dasharray="70 140" stroke-dashoffset="-70"/>
      <!-- Orbiting moon -->
      <circle class="orbiting-moon" cx="32" cy="32" r="4" fill="#a855f7"/>
    </svg>
    <h1><span style="color: #ffffff;">Ables</span><span style="color: #6b7280;">AI</span></h1>
    <button class="settings-btn" onclick="openSettings()" title="Settings">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/>
        <circle cx="12" cy="12" r="3"/>
      </svg>
    </button>
  </header>

  <!-- TAB NAVIGATION -->
  <nav class="tab-nav">
    <button class="tab-btn" onclick="switchTab('model')">MODEL INFO</button>
    <button class="tab-btn tab-btn-calculator active" onclick="switchTab('calculator')">MODEL SCORE</button>
    <button class="tab-btn" onclick="switchTab('override')">MODEL OVERRIDE</button>
  </nav>

  <!-- CALCULATOR TAB -->
  <div id="tab-calculator" class="tab-panel active">
    <div class="p-6 pb-0 max-w-[1600px] mx-auto">
      
      <!-- Header -->
      <div class="mb-6 text-center">
        <div class="flex items-center justify-center gap-3 mb-2">
          <div class="w-1 h-8 rounded-full" style="background: var(--accent);"></div>
          <h1 class="text-2xl font-extrabold" style="color: var(--text-primary);">Model Score</h1>
        </div>
        <p class="text-sm" style="color: var(--text-muted);">Analyze merchant data and generate AblesAI-based offer terms</p>
      </div>

      <!-- CREDIT ENGINE SECTION (moved to top) -->
      <div class="card p-6 mb-6" id="calcCreditEngineCard">
        <div class="flex items-center gap-3 mb-6">
          <div class="section-indicator"></div>
          <h3 class="section-title">AblesAI v4.2 Credit Engine</h3>
        </div>
        <div class="score-panel" id="scorePanelTop">
          <div class="score-header" id="scoreHeaderBgTop" style="background: linear-gradient(135deg, rgba(234,179,8,0.15) 0%, rgba(234,179,8,0.05) 100%);">
            <div style="display: flex; align-items: center; justify-content: space-between;">
              <div>
                <div style="font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; color: var(--text-muted);">AblesAI Score</div>
                <div id="scoreValueTop" style="font-size: 30px; font-weight: 900; color: #eab308;">62<span style="font-size: 18px; font-weight: 600; color: var(--text-muted);">/100</span></div>
              </div>
              <div style="text-align: center;">
                <div id="tierLetterTop" style="font-size: 36px; font-weight: 900; color: #eab308;">C</div>
                <div id="tierLabelTop" style="font-size: 10px; font-weight: 700; text-transform: uppercase; color: var(--text-muted);">Mid-Prime</div>
              </div>
            </div>
          </div>
          <div class="score-body">
            <div style="font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 16px; color: var(--text-muted);">Score Breakdown</div>
            <div class="breakdown-row">
              <div style="display: flex; align-items: center; gap: 8px;">
                <div id="dotCreditTop" style="width: 8px; height: 8px; border-radius: 50%; background: #eab308;"></div>
                <span style="font-size: 12px; font-weight: 600; color: var(--text-secondary);">Credit Score</span>
              </div>
              <div style="display: flex; align-items: center; gap: 8px;">
                <div class="breakdown-bar-track"><div class="breakdown-bar-fill" id="barCreditTop" style="width: 50%; background: #eab308;"></div></div>
                <span id="scoreCreditTop" style="font-size: 12px; font-weight: 700; width: 48px; text-align: right; color: var(--text-primary);">15/30</span>
              </div>
            </div>
            <div class="breakdown-row">
              <div style="display: flex; align-items: center; gap: 8px;">
                <div id="dotBehaviorTop" style="width: 8px; height: 8px; border-radius: 50%; background: #10b981;"></div>
                <span style="font-size: 12px; font-weight: 600; color: var(--text-secondary);">Behavior (<span id="eventsLabelTop">3</span> events)</span>
              </div>
              <div style="display: flex; align-items: center; gap: 8px;">
                <div class="breakdown-bar-track"><div class="breakdown-bar-fill" id="barBehaviorTop" style="width: 70%; background: #10b981;"></div></div>
                <span id="scoreBehaviorTop" style="font-size: 12px; font-weight: 700; width: 48px; text-align: right; color: var(--text-primary);">21/30</span>
              </div>
            </div>
            <div class="breakdown-row">
              <div style="display: flex; align-items: center; gap: 8px;">
                <div id="dotRevenueTop" style="width: 8px; height: 8px; border-radius: 50%; background: #eab308;"></div>
                <span style="font-size: 12px; font-weight: 600; color: var(--text-secondary);">Revenue</span>
              </div>
              <div style="display: flex; align-items: center; gap: 8px;">
                <div class="breakdown-bar-track"><div class="breakdown-bar-fill" id="barRevenueTop" style="width: 46%; background: #eab308;"></div></div>
                <span id="scoreRevenueTop" style="font-size: 12px; font-weight: 700; width: 48px; text-align: right; color: var(--text-primary);">9/20</span>
              </div>
            </div>
            <div class="breakdown-row">
              <div style="display: flex; align-items: center; gap: 8px;">
                <div id="dotStabilityTop" style="width: 8px; height: 8px; border-radius: 50%; background: #10b981;"></div>
                <span style="font-size: 12px; font-weight: 600; color: var(--text-secondary);">Stability</span>
              </div>
              <div style="display: flex; align-items: center; gap: 8px;">
                <div class="breakdown-bar-track"><div class="breakdown-bar-fill" id="barStabilityTop" style="width: 70%; background: #10b981;"></div></div>
                <span id="scoreStabilityTop" style="font-size: 12px; font-weight: 700; width: 48px; text-align: right; color: var(--text-primary);">7/10</span>
              </div>
            </div>
            <div class="breakdown-row">
              <div style="display: flex; align-items: center; gap: 8px;">
                <div id="dotBufferTop" style="width: 8px; height: 8px; border-radius: 50%; background: #10b981;"></div>
                <span style="font-size: 12px; font-weight: 600; color: var(--text-secondary);">Buffer (<span id="bufferPctTop">16</span>%)</span>
              </div>
              <div style="display: flex; align-items: center; gap: 8px;">
                <div class="breakdown-bar-track"><div class="breakdown-bar-fill" id="barBufferTop" style="width: 100%; background: #10b981;"></div></div>
                <span id="scoreBufferTop" style="font-size: 12px; font-weight: 700; width: 48px; text-align: right; color: var(--text-primary);">10/10</span>
              </div>
            </div>
            <div class="tier-scale">
              <div class="tier-seg tier-a">A 80+</div>
              <div class="tier-seg tier-b">B 65+</div>
              <div class="tier-seg tier-c">C 50+</div>
              <div class="tier-seg tier-d">D 35+</div>
              <div class="tier-seg tier-e">E &lt;35</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Combined Summary & Risk Analytics Card -->
      <div class="card p-3 mb-6" style="background: var(--bg-card-inner);" id="calcSummaryCard">
        <!-- Top Row: Score & Offer Summary -->
        <div class="p-4 flex items-center justify-between flex-wrap gap-4 rounded-lg mb-3" style="background: var(--bg-card);">
          <div class="flex items-center gap-6 flex-1">
            <div class="text-center px-4 py-2 rounded-xl flex-shrink-0" style="background: var(--bg-card-inner);">
              <div class="text-xs font-bold uppercase tracking-wider" style="color: var(--text-muted);">Tier</div>
              <div class="text-3xl font-black" id="summaryTier" style="color: var(--accent);">C</div>
            </div>
            <div class="flex-1 min-w-[200px]">
              <div class="flex items-center justify-between mb-2">
                <div class="text-xs font-bold uppercase tracking-wider" style="color: var(--text-muted);">AblesAI Score</div>
                <div class="text-lg font-extrabold" style="color: var(--text-primary);"><span id="summaryScore">62</span>/100</div>
              </div>
              <div class="summary-score-bar">
                <div class="summary-score-fill" id="summaryScoreFill" style="width: 62%;"></div>
                <div class="summary-score-marker" id="summaryScoreMarker" style="left: 62%;" data-score="62"></div>
              </div>
              <div class="flex justify-between mt-1">
                <span class="text-[9px] font-bold" style="color: #ef4444;">E</span>
                <span class="text-[9px] font-bold" style="color: #f97316;">D</span>
                <span class="text-[9px] font-bold" style="color: #eab308;">C</span>
                <span class="text-[9px] font-bold" style="color: #22c55e;">B</span>
                <span class="text-[9px] font-bold" style="color: #10b981;">A</span>
              </div>
            </div>
          </div>
          <div class="flex gap-6 flex-shrink-0">
            <div class="text-center">
              <div class="text-xs font-bold uppercase" style="color: var(--text-muted);">Funding</div>
              <div class="text-lg font-bold" style="color: var(--text-secondary);" id="summaryFunding">$17,500</div>
            </div>
            <div class="text-center">
              <div class="text-xs font-bold uppercase" style="color: var(--text-muted);">Factor</div>
              <div class="text-lg font-bold" style="color: var(--text-secondary);" id="summaryFactor">1.32x</div>
            </div>
            <div class="text-center">
              <div class="text-xs font-bold uppercase" style="color: var(--text-muted);">Term</div>
              <div class="text-lg font-bold" style="color: var(--text-secondary);" id="summaryTerm">9 mo</div>
            </div>
          </div>
        </div>
        
        <!-- Bottom Row: Risk Analytics -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-3" id="calcRiskIndicators">
          
          <!-- Risk Impact Metrics -->
          <div class="p-4 rounded-lg" style="background: var(--bg-card);">
            <div class="text-[10px] font-bold uppercase tracking-wider mb-3" style="color: var(--text-muted);">Risk Impact</div>
            <div class="grid grid-cols-3 gap-3">
              <div class="text-center p-3 rounded-lg" style="background: rgba(234, 179, 8, 0.15); border: 1px solid rgba(234, 179, 8, 0.3);">
                <div class="text-xl font-extrabold" id="calcPdValue" style="color: #eab308;">10.0%</div>
                <div class="text-[10px] font-bold uppercase tracking-wide" style="color: #eab308; opacity: 0.8;">PD</div>
              </div>
              <div class="text-center p-3 rounded-lg" style="background: rgba(16, 185, 129, 0.15); border: 1px solid rgba(16, 185, 129, 0.3);">
                <div class="text-xl font-extrabold" id="calcDscrValue" style="color: #10b981;">1.85x</div>
                <div class="text-[10px] font-bold uppercase tracking-wide" style="color: #10b981; opacity: 0.8;">DSCR</div>
              </div>
              <div class="text-center p-3 rounded-lg" style="background: rgba(16, 185, 129, 0.15); border: 1px solid rgba(16, 185, 129, 0.3);">
                <div class="text-xl font-extrabold" id="calcRiskLevel" style="color: #10b981;">Low</div>
                <div class="text-[10px] font-bold uppercase tracking-wide" style="color: #10b981; opacity: 0.8;">Risk</div>
              </div>
            </div>
          </div>

          <!-- Probability of Default Gauge -->
          <div class="p-4 rounded-lg" style="background: var(--bg-card);">
            <div class="text-[10px] font-bold uppercase tracking-wider mb-2" style="color: var(--text-muted);">Probability of Default</div>
            <div class="gauge-container" style="transform: scale(0.85); transform-origin: top center;">
              <svg width="180" height="100" viewBox="0 0 180 100">
                <path class="gauge-arc gauge-bg" d="M 20 80 A 60 60 0 0 1 160 80" />
                <path class="gauge-arc gauge-fill" id="calcPdGaugeFill" d="M 20 80 A 60 60 0 0 1 160 80" 
                  stroke="#10b981" stroke-dasharray="0 188" />
                <circle class="gauge-needle" id="calcPdNeedle" cx="20" cy="80" r="4" />
              </svg>
              <div class="gauge-center-label">
                <div class="text-xl font-extrabold" id="calcPdDisplay" style="color: var(--text-primary);">10.0%</div>
                <div class="text-[9px] font-bold uppercase" style="color: var(--text-muted);">Est. PD</div>
              </div>
            </div>
            <div class="pd-scale" style="margin-top: -10px;">
              <span class="pd-scale-item" style="color: #10b981; font-size: 9px;">Low</span>
              <span class="pd-scale-item" style="color: #eab308; font-size: 9px;">Med</span>
              <span class="pd-scale-item" style="color: #f97316; font-size: 9px;">High</span>
              <span class="pd-scale-item" style="color: #ef4444; font-size: 9px;">Severe</span>
            </div>
          </div>

          <!-- DSCR Impact -->
          <div class="p-4 rounded-lg" style="background: var(--bg-card);">
            <div class="text-[10px] font-bold uppercase tracking-wider mb-3" style="color: var(--text-muted);">Debt Service Coverage</div>
            <div class="dscr-bar mb-3">
              <div class="text-[10px] font-bold" style="color: var(--text-muted);">0x</div>
              <div class="dscr-bar-track">
                <div class="dscr-marker" style="left: 33%;" data-label="1x"></div>
                <div class="dscr-marker" style="left: 50%;" data-label="1.5x"></div>
                <div class="dscr-marker" style="left: 66%;" data-label="2x"></div>
                <div class="dscr-bar-fill" id="calcDscrBarFill" style="width: 62%; background: #10b981;">
                  <span class="text-[10px] font-bold" style="color: #000;" id="calcDscrBarValue">1.85x</span>
                </div>
              </div>
              <div class="text-[10px] font-bold" style="color: var(--text-muted);">3x</div>
            </div>
            <div class="grid grid-cols-3 gap-2 text-center">
              <div>
                <div class="text-sm font-bold" style="color: var(--text-primary);" id="calcDscrMonthlyRev">$50,000</div>
                <div class="text-[7px] font-bold uppercase" style="color: var(--text-muted);">Monthly Rev</div>
              </div>
              <div>
                <div class="text-sm font-bold" style="color: var(--text-primary);" id="calcDscrMonthlyDebt">$2,574</div>
                <div class="text-[7px] font-bold uppercase" style="color: var(--text-muted);">Monthly Debt</div>
              </div>
              <div>
                <div class="text-sm font-bold" id="calcDscrRatio" style="color: #10b981;">1.85x</div>
                <div class="text-[7px] font-bold uppercase" style="color: var(--text-muted);">DSCR</div>
              </div>
            </div>
            <div class="mt-2 p-2 rounded-lg text-[9px]" id="calcDscrWarning" style="background: rgba(16, 185, 129, 0.1); color: #10b981; display: none;">
              <strong>Healthy DSCR:</strong> Excellent revenue coverage for debt service.
            </div>
          </div>

        </div>
      </div>
    </div>

    <!-- TWO COLUMN LAYOUT -->
    <div class="calc-layout px-6 max-w-[1600px] mx-auto">
      
      <!-- LEFT: INPUT PANEL -->
      <div class="space-y-6 calc-controls-column" id="calcControlsPanel">
        <div class="mobile-panel-handle" onclick="togglePanel('calcControlsPanel')">
          <div class="drawer-handle-bar"></div>
          <div class="drawer-label">
            <div class="drawer-chevrons">
              <div class="drawer-chevron"></div>
              <div class="drawer-chevron"></div>
            </div>
            <span class="drawer-label-text"></span>
            <div class="drawer-chevrons">
              <div class="drawer-chevron"></div>
              <div class="drawer-chevron"></div>
            </div>
          </div>
        </div>
        
        <!-- Input Sliders Card (this floats on mobile) -->
        <div class="card p-4 sliders-card">
          <div class="flex items-center gap-3 mb-4 sliders-header">
            <div class="section-indicator"></div>
            <h3 class="section-title">Input Parameters</h3>
          </div>
          
          <!-- Input Sliders -->
          <div class="rounded-xl p-3 border mb-2" style="background: var(--bg-option-card); border-color: var(--border-secondary);">
            <label class="text-xs font-bold uppercase tracking-wide block" style="color: var(--text-muted);">Credit Score (FICO)</label>
            <div class="flex items-baseline gap-1.5 mb-2 mt-1">
              <span class="text-2xl font-extrabold" style="color: var(--text-primary);" id="creditDisplay">650</span>
            </div>
            <input type="range" class="slider w-full" id="creditScore" min="450" max="850" step="5" value="650" oninput="calculate()">
            <div class="flex justify-between text-[10px] font-semibold mt-1 uppercase tracking-wider" style="color: var(--text-muted);">
              <span>450</span>
              <span>850</span>
            </div>
          </div>

          <div class="rounded-xl p-3 border mb-2" style="background: var(--bg-option-card); border-color: var(--border-secondary);">
            <label class="text-xs font-bold uppercase tracking-wide block" style="color: var(--text-muted);">Monthly Revenue</label>
            <div class="flex items-baseline gap-1.5 mb-2 mt-1">
              <span class="text-2xl font-extrabold" style="color: var(--text-primary);" id="revenueDisplay">$50,000</span>
            </div>
            <input type="range" class="slider w-full" id="monthlyRevenue" min="5000" max="500000" step="1" value="50000" oninput="calculate()">
            <div class="flex justify-between text-[10px] font-semibold mt-1 uppercase tracking-wider" style="color: var(--text-muted);">
              <span>$5,000</span>
              <span>$500,000</span>
            </div>
          </div>

          <div class="rounded-xl p-3 border mb-2" style="background: var(--bg-option-card); border-color: var(--border-secondary);">
            <label class="text-xs font-bold uppercase tracking-wide block" style="color: var(--text-muted);">Average Daily Balance</label>
            <div class="flex items-baseline gap-1.5 mb-2 mt-1">
              <span class="text-2xl font-extrabold" style="color: var(--text-primary);" id="balanceDisplay">$8,000</span>
            </div>
            <input type="range" class="slider w-full" id="avgDailyBalance" min="500" max="100000" step="1" value="8000" oninput="calculate()">
            <div class="flex justify-between text-[10px] font-semibold mt-1 uppercase tracking-wider" style="color: var(--text-muted);">
              <span>$500</span>
              <span>$100,000</span>
            </div>
          </div>

          <div class="rounded-xl p-3 border mb-2" style="background: var(--bg-option-card); border-color: var(--border-secondary);">
            <label class="text-xs font-bold uppercase tracking-wide block" style="color: var(--text-muted);">Time in Business</label>
            <div class="flex items-baseline gap-1.5 mb-2 mt-1">
              <span class="text-2xl font-extrabold" style="color: var(--text-primary);" id="tibDisplay">24 mo</span>
            </div>
            <input type="range" class="slider w-full" id="timeInBusiness" min="3" max="120" step="1" value="24" oninput="calculate()">
            <div class="flex justify-between text-[10px] font-semibold mt-1 uppercase tracking-wider" style="color: var(--text-muted);">
              <span>3 mo</span>
              <span>120 mo</span>
            </div>
          </div>

          <div class="grid grid-cols-2 gap-2">
            <div class="rounded-xl p-3 border" style="background: var(--bg-option-card); border-color: var(--border-secondary);">
              <label class="text-xs font-bold uppercase tracking-wide block" style="color: var(--text-muted);">NSF / Overdrafts <span style="font-weight: 500; opacity: 0.7;">(90 Days)</span></label>
              <div class="flex items-baseline gap-1.5 mb-2 mt-1">
                <span class="text-2xl font-extrabold" style="color: var(--text-primary);" id="nsfDisplay">2</span>
              </div>
              <input type="range" class="slider w-full" id="nsfCount" min="0" max="15" step="1" value="2" oninput="calculate()">
              <div class="flex justify-between text-[10px] font-semibold mt-1 uppercase tracking-wider" style="color: var(--text-muted);">
                <span>0</span>
                <span>15</span>
              </div>
            </div>

            <div class="rounded-xl p-3 border" style="background: var(--bg-option-card); border-color: var(--border-secondary);">
              <label class="text-xs font-bold uppercase tracking-wide block" style="color: var(--text-muted);">Negative Days <span style="font-weight: 500; opacity: 0.7;">(90 Days)</span></label>
              <div class="flex items-baseline gap-1.5 mb-2 mt-1">
                <span class="text-2xl font-extrabold" style="color: var(--text-primary);" id="negDaysDisplay">1 days</span>
              </div>
              <input type="range" class="slider w-full" id="negativeDays" min="0" max="15" step="1" value="1" oninput="calculate()">
              <div class="flex justify-between text-[10px] font-semibold mt-1 uppercase tracking-wider" style="color: var(--text-muted);">
                <span>0</span>
                <span>15</span>
              </div>
            </div>
          </div>

          <!-- Existing Debt Payments -->
          <div class="rounded-xl p-3 border mt-2" style="background: var(--bg-option-card); border-color: var(--border-secondary);">
            <div class="flex items-center justify-between mb-2">
              <label class="text-xs font-bold uppercase tracking-wide" style="color: var(--text-muted);">Existing Debt Payments</label>
              <div class="flex items-center gap-1">
                <span class="text-[9px]" style="color: var(--text-muted);">paid</span>
                <select id="existingDebtFreqSelect" onchange="updateExistingDebtFreq()" class="text-[10px] font-semibold px-1.5 py-0.5 rounded" style="background: var(--bg-primary); color: var(--text-muted); border: 1px solid var(--border-secondary);">
                  <option value="daily">daily</option>
                  <option value="weekly">weekly</option>
                  <option value="monthly">monthly</option>
                </select>
              </div>
            </div>
            <div class="flex items-baseline gap-1.5 mb-2">
              <span class="text-2xl font-extrabold" style="color: var(--text-primary);" id="existingDebtDisplay">$0</span>
              <span class="text-xs font-semibold" style="color: var(--text-muted);" id="existingDebtFreqLabel">/day</span>
            </div>
            <input type="range" class="slider w-full" id="existingDebt" min="0" max="15000" step="50" value="0" oninput="calculate()">
            <div class="flex justify-between text-[10px] font-semibold mt-1 uppercase tracking-wider" style="color: var(--text-muted);">
              <span>$0</span>
              <span>$15,000</span>
            </div>
            <!-- Hidden radios for compatibility -->
            <div style="display: none;">
              <input type="radio" name="existingDebtFreq" value="daily" checked>
              <input type="radio" name="existingDebtFreq" value="weekly">
              <input type="radio" name="existingDebtFreq" value="monthly">
            </div>
          </div>

          <div class="mt-2">
            <!-- Industry Dropdown -->
            <div class="rounded-xl p-3 border" style="background: var(--bg-option-card); border-color: var(--border-secondary);">
              <label class="text-xs font-bold uppercase tracking-wide block mb-2" style="color: var(--text-muted);">Industry</label>
              <select id="industrySelect" onchange="handleIndustryChange()" class="w-full px-2 py-1.5 rounded-lg text-xs font-semibold" style="background: var(--bg-primary); color: var(--text-primary); border: 1px solid var(--border-secondary);">
                <optgroup label="Standard Industries">
                  <option value="retail">Retail / E-commerce</option>
                  <option value="restaurant">Restaurant / Food Service</option>
                  <option value="construction">Construction / Contracting</option>
                  <option value="auto">Auto Repair / Dealer</option>
                  <option value="medical">Medical / Healthcare</option>
                  <option value="professional">Professional Services</option>
                  <option value="manufacturing">Manufacturing</option>
                  <option value="wholesale">Wholesale / Distribution</option>
                  <option value="beauty">Beauty / Salon / Spa</option>
                  <option value="fitness">Fitness / Gym</option>
                  <option value="other">Other (Standard)</option>
                </optgroup>
                <optgroup label="Restricted (Fleet Size Required)">
                  <option value="trucking">Trucking / Transportation</option>
                </optgroup>
                <optgroup label="Prohibited Industries">
                  <option value="gambling">Gambling / Casino</option>
                  <option value="adult">Adult Entertainment</option>
                  <option value="cannabis">Cannabis / CBD</option>
                  <option value="firearms">Firearms / Weapons</option>
                  <option value="crypto">Cryptocurrency</option>
                  <option value="collection">Debt Collection</option>
                  <option value="telemarketing">Telemarketing</option>
                  <option value="pawn">Pawn Shop</option>
                </optgroup>
              </select>
              <div id="industryWarning" class="text-[9px] mt-1 font-semibold text-center" style="color: #ef4444; display: none;">Prohibited Industry</div>
              
              <!-- Trucking Fleet Size (hidden by default) -->
              <div id="truckingFleetSection" style="display: none; margin-top: 8px;">
                <label class="text-[10px] font-bold uppercase tracking-wide block mb-1" style="color: var(--text-muted);">Fleet Size (# of Vehicles)</label>
                <select id="fleetSize" onchange="calculate()" class="w-full px-2 py-1.5 rounded-lg text-xs font-semibold" style="background: var(--bg-primary); color: var(--text-primary); border: 1px solid var(--border-secondary);">
                  <option value="1">1 vehicle</option>
                  <option value="2">2 vehicles</option>
                  <option value="3">3 vehicles</option>
                  <option value="4">4 vehicles</option>
                  <option value="5">5 vehicles</option>
                  <option value="6">6-10 vehicles</option>
                  <option value="11">11-20 vehicles</option>
                  <option value="21">21+ vehicles</option>
                </select>
                <div id="fleetWarning" class="text-[9px] mt-1 font-semibold text-center" style="color: #ef4444; display: none;">Minimum 5 vehicles required</div>
              </div>
            </div>
          </div>

          <!-- Recalculate Button -->
          <button onclick="recalculateWithConfirm(this)" id="recalcBtn" class="w-full mt-3 py-3 rounded-xl font-bold text-sm uppercase tracking-wider transition-all duration-200" style="background: var(--accent); color: #000;">
            Recalculate
          </button>
          <div id="calcConfirmMsg" class="text-center text-xs mt-1 font-semibold" style="color: #22c55e; opacity: 0; transition: opacity 0.3s;"></div>

        </div>
      </div>
      <div class="calc-result-column">
        <div class="preview-sticky-wrapper">
          <div class="calc-result-preview" id="resultCard">
            
            <!-- Approved State -->
            <div id="approvedSection">
              <div class="calc-preview-header" id="resultHeader">
                <div class="calc-preview-label" id="resultLabel">AblesAI Tier C - Approved</div>
                <div class="calc-preview-amount" id="offerFunding">$17,500</div>
              </div>

              <div class="calc-stats-grid">
                <div class="calc-stat-cell">
                  <span class="calc-stat-label">Factor Rate</span>
                  <span class="calc-stat-value" id="offerFactor">1.32x</span>
                </div>
                <div class="calc-stat-cell">
                  <span class="calc-stat-label">Term</span>
                  <span class="calc-stat-value" id="offerTerm">9 Months</span>
                </div>
                <div class="calc-stat-cell">
                  <span class="calc-stat-label">Total Payback</span>
                  <span class="calc-stat-value" id="offerPayback">$23,100</span>
                </div>
                <div class="calc-stat-cell">
                  <span class="calc-stat-label" id="paymentFreqLabel">Daily Payment</span>
                  <span class="calc-stat-value accent" id="offerPayment">$117</span>
                </div>
              </div>

              <!-- Holdback & APR Display -->
              <div class="grid grid-cols-2 gap-0" style="border-bottom: 1px solid var(--border-secondary); background: rgba(var(--accent-rgb), 0.05);">
                <div class="p-4 text-center" style="border-right: 1px solid var(--border-secondary);">
                  <div class="text-xs font-bold uppercase tracking-wider mb-1" style="color: var(--text-muted);">Holdback</div>
                  <div class="text-2xl font-extrabold" style="color: var(--accent);" id="offerHoldback">4.91%</div>
                </div>
                <div class="p-4 text-center">
                  <div class="text-xs font-bold uppercase tracking-wider mb-1" style="color: var(--text-muted);">Est. APR</div>
                  <div class="text-2xl font-extrabold" style="color: var(--accent);" id="offerAPR">42.7%</div>
                </div>
              </div>

              <!-- Closing Breakdown -->
              <div class="p-4" style="border-bottom: 1px solid var(--border-secondary);">
                <div class="text-xs font-bold uppercase tracking-wider mb-3" style="color: var(--text-muted);">Closing Breakdown</div>
                <div class="space-y-2 text-xs">
                  <div class="flex justify-between" style="color: var(--text-secondary);">
                    <span>Gross Funding</span>
                    <span class="font-semibold" id="closingGross">$17,500</span>
                  </div>
                  <div class="flex justify-between" style="color: var(--text-muted);">
                    <span>Origination Fee (3%)</span>
                    <span id="closingOrig">-$525</span>
                  </div>
                  <div class="flex justify-between" style="color: var(--text-muted);">
                    <span>Admin Fee</span>
                    <span>-$995</span>
                  </div>
                  <div class="flex justify-between" style="color: var(--text-muted);">
                    <span>Wire Fee</span>
                    <span>-$50</span>
                  </div>
                  <div class="flex justify-between pt-2 mt-2" style="border-top: 1px solid var(--border-secondary); color: var(--accent);">
                    <span class="font-bold">Net Wire Amount</span>
                    <span class="font-bold" id="closingNet">$15,930</span>
                  </div>
                </div>
              </div>

              <!-- Stips -->
              <div class="p-4" style="border-bottom: 1px solid var(--border-secondary);">
                <div class="text-xs font-bold uppercase tracking-wider mb-3" style="color: var(--text-muted);">Required Documentation</div>
                <div class="space-y-2">
                  <div class="flex items-center gap-2 text-xs" style="color: var(--text-secondary);">
                    <svg class="w-3 h-3" style="color: var(--accent);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4"/>
                    </svg>
                    <span>Driver's License</span>
                  </div>
                  <div class="flex items-center gap-2 text-xs" style="color: var(--text-secondary);">
                    <svg class="w-3 h-3" style="color: var(--accent);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4"/>
                    </svg>
                    <span>Voided Check</span>
                  </div>
                  <div class="flex items-center gap-2 text-xs" style="color: var(--text-secondary);">
                    <svg class="w-3 h-3" style="color: var(--accent);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4"/>
                    </svg>
                    <span>3 Months Bank Statements</span>
                  </div>
                  <div class="flex items-center gap-2 text-xs" style="color: var(--text-secondary);">
                    <svg class="w-3 h-3" style="color: var(--accent);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4"/>
                    </svg>
                    <span>Proof of Ownership</span>
                  </div>
                  <div class="flex items-center gap-2 text-xs" style="color: var(--text-secondary);">
                    <svg class="w-3 h-3" style="color: var(--accent);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4"/>
                    </svg>
                    <span>Landlord Contact</span>
                  </div>
                </div>
              </div>

              <!-- Decision -->
              <div class="calc-payment-display" id="decisionSection" style="background: rgba(var(--accent-rgb), 0.1);">
                <div class="calc-payment-label" id="decisionLabel" style="color: var(--accent);">Decision</div>
                <div class="calc-payment-amount" id="decisionStatus" style="color: var(--accent); font-size: 1.25rem;">&#10003; APPROVED</div>
              </div>
            </div>

            <!-- Declined State -->
            <div id="declinedSection" class="hidden">
              <div class="declined-card m-6">
                <div class="text-5xl mb-4" style="color: #ef4444;">&#10005;</div>
                <div class="text-xl font-bold mb-2" style="color: #ef4444;">APPLICATION DECLINED</div>
                <div class="text-sm" id="declineReason" style="color: var(--text-secondary);">Does not meet minimum requirements</div>
              </div>
              <div class="calc-payment-display" style="background: rgba(239, 68, 68, 0.1);">
                <div class="calc-payment-label" style="color: #ef4444;">Decision</div>
                <div class="calc-payment-amount" style="color: #ef4444; font-size: 1.25rem;">&#10005; DECLINED</div>
              </div>
            </div>

          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- APPROVAL OVERRIDE TAB -->
  <div id="tab-override" class="tab-panel">
    <div class="p-6 pb-0 max-w-[1600px] mx-auto">
      
      <!-- Header -->
      <div class="mb-6 text-center">
        <div class="flex items-center justify-center gap-3 mb-2">
          <div class="w-1 h-8 rounded-full" style="background: var(--accent);"></div>
          <h1 class="text-2xl font-extrabold" style="color: var(--text-primary);">Model Override</h1>
        </div>
        <p class="text-sm" style="color: var(--text-muted);">Adjust calculated offer terms and analyze risk impact</p>
      </div>

      <!-- CREDIT ENGINE SECTION (at top) -->
      <div class="card p-6 mb-6" id="overrideCreditEngineCard">
        <div class="flex items-center gap-3 mb-6">
          <div class="section-indicator"></div>
          <h3 class="section-title">AblesAI v4.2 Credit Engine</h3>
        </div>
        <div class="score-panel" id="scorePanelOverride">
          <div class="score-header" id="scoreHeaderBgOverride" style="background: linear-gradient(135deg, rgba(234,179,8,0.15) 0%, rgba(234,179,8,0.05) 100%);">
            <div style="display: flex; align-items: center; justify-content: space-between;">
              <div>
                <div style="font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; color: var(--text-muted);">AblesAI Score</div>
                <div id="scoreValueOverride" style="font-size: 30px; font-weight: 900; color: #eab308;">62<span style="font-size: 18px; font-weight: 600; color: var(--text-muted);">/100</span></div>
              </div>
              <div style="text-align: center;">
                <div id="tierLetterOverride" style="font-size: 36px; font-weight: 900; color: #eab308;">C</div>
                <div id="tierLabelOverride" style="font-size: 10px; font-weight: 700; text-transform: uppercase; color: var(--text-muted);">Mid-Prime</div>
              </div>
            </div>
          </div>
          <div class="score-body">
            <div style="font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 16px; color: var(--text-muted);">Score Breakdown</div>
            <div class="breakdown-row">
              <div style="display: flex; align-items: center; gap: 8px;">
                <div id="dotCreditOverride" style="width: 8px; height: 8px; border-radius: 50%; background: #eab308;"></div>
                <span style="font-size: 12px; font-weight: 600; color: var(--text-secondary);">Credit Score</span>
              </div>
              <div style="display: flex; align-items: center; gap: 8px;">
                <div class="breakdown-bar-track"><div class="breakdown-bar-fill" id="barCreditOverride" style="width: 50%; background: #eab308;"></div></div>
                <span id="scoreCreditOverride" style="font-size: 12px; font-weight: 700; width: 48px; text-align: right; color: var(--text-primary);">15/30</span>
              </div>
            </div>
            <div class="breakdown-row">
              <div style="display: flex; align-items: center; gap: 8px;">
                <div id="dotBehaviorOverride" style="width: 8px; height: 8px; border-radius: 50%; background: #10b981;"></div>
                <span style="font-size: 12px; font-weight: 600; color: var(--text-secondary);">Behavior (<span id="eventsLabelOverride">3</span> events)</span>
              </div>
              <div style="display: flex; align-items: center; gap: 8px;">
                <div class="breakdown-bar-track"><div class="breakdown-bar-fill" id="barBehaviorOverride" style="width: 70%; background: #10b981;"></div></div>
                <span id="scoreBehaviorOverride" style="font-size: 12px; font-weight: 700; width: 48px; text-align: right; color: var(--text-primary);">21/30</span>
              </div>
            </div>
            <div class="breakdown-row">
              <div style="display: flex; align-items: center; gap: 8px;">
                <div id="dotRevenueOverride" style="width: 8px; height: 8px; border-radius: 50%; background: #eab308;"></div>
                <span style="font-size: 12px; font-weight: 600; color: var(--text-secondary);">Revenue</span>
              </div>
              <div style="display: flex; align-items: center; gap: 8px;">
                <div class="breakdown-bar-track"><div class="breakdown-bar-fill" id="barRevenueOverride" style="width: 46%; background: #eab308;"></div></div>
                <span id="scoreRevenueOverride" style="font-size: 12px; font-weight: 700; width: 48px; text-align: right; color: var(--text-primary);">9/20</span>
              </div>
            </div>
            <div class="breakdown-row">
              <div style="display: flex; align-items: center; gap: 8px;">
                <div id="dotStabilityOverride" style="width: 8px; height: 8px; border-radius: 50%; background: #10b981;"></div>
                <span style="font-size: 12px; font-weight: 600; color: var(--text-secondary);">Stability</span>
              </div>
              <div style="display: flex; align-items: center; gap: 8px;">
                <div class="breakdown-bar-track"><div class="breakdown-bar-fill" id="barStabilityOverride" style="width: 70%; background: #10b981;"></div></div>
                <span id="scoreStabilityOverride" style="font-size: 12px; font-weight: 700; width: 48px; text-align: right; color: var(--text-primary);">7/10</span>
              </div>
            </div>
            <div class="breakdown-row">
              <div style="display: flex; align-items: center; gap: 8px;">
                <div id="dotBufferOverride" style="width: 8px; height: 8px; border-radius: 50%; background: #10b981;"></div>
                <span style="font-size: 12px; font-weight: 600; color: var(--text-secondary);">Buffer (<span id="bufferPctOverride">16</span>%)</span>
              </div>
              <div style="display: flex; align-items: center; gap: 8px;">
                <div class="breakdown-bar-track"><div class="breakdown-bar-fill" id="barBufferOverride" style="width: 100%; background: #10b981;"></div></div>
                <span id="scoreBufferOverride" style="font-size: 12px; font-weight: 700; width: 48px; text-align: right; color: var(--text-primary);">10/10</span>
              </div>
            </div>
            <div class="tier-scale">
              <div class="tier-seg tier-a">A 80+</div>
              <div class="tier-seg tier-b">B 65+</div>
              <div class="tier-seg tier-c">C 50+</div>
              <div class="tier-seg tier-d">D 35+</div>
              <div class="tier-seg tier-e">E &lt;35</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Combined Summary & Risk Analytics Card -->
      <div class="card p-3 mb-6" style="background: var(--bg-card-inner);">
        <!-- Top Row: Score & Offer Summary -->
        <div class="p-4 flex items-center justify-between flex-wrap gap-4 rounded-lg mb-3" style="background: var(--bg-card);">
          <div class="flex items-center gap-6 flex-1">
            <div class="text-center px-4 py-2 rounded-xl flex-shrink-0" style="background: var(--bg-card-inner);">
              <div class="text-xs font-bold uppercase tracking-wider" style="color: var(--text-muted);">Tier</div>
              <div class="text-3xl font-black" id="overrideTierDisplay" style="color: var(--accent);">C</div>
            </div>
            <div class="flex-1 min-w-[200px]">
              <div class="flex items-center justify-between mb-2">
                <div class="text-xs font-bold uppercase tracking-wider" style="color: var(--text-muted);">AblesAI Score</div>
                <div class="text-lg font-extrabold" style="color: var(--text-primary);"><span id="overrideScoreDisplay">62</span>/100</div>
              </div>
              <div class="summary-score-bar">
                <div class="summary-score-fill" id="overrideScoreFill" style="width: 62%;"></div>
                <div class="summary-score-marker" id="overrideScoreMarker" style="left: 62%;" data-score="62"></div>
              </div>
              <div class="flex justify-between mt-1">
                <span class="text-[9px] font-bold" style="color: #ef4444;">E</span>
                <span class="text-[9px] font-bold" style="color: #f97316;">D</span>
                <span class="text-[9px] font-bold" style="color: #eab308;">C</span>
                <span class="text-[9px] font-bold" style="color: #22c55e;">B</span>
                <span class="text-[9px] font-bold" style="color: #10b981;">A</span>
              </div>
            </div>
          </div>
          <div class="flex gap-6 flex-shrink-0">
            <div class="text-center">
              <div class="text-xs font-bold uppercase" style="color: var(--text-muted);">Calc Funding</div>
              <div class="text-lg font-bold" style="color: var(--text-secondary);" id="calcFundingDisplay">$17,500</div>
            </div>
            <div class="text-center">
              <div class="text-xs font-bold uppercase" style="color: var(--text-muted);">Calc Factor</div>
              <div class="text-lg font-bold" style="color: var(--text-secondary);" id="calcFactorDisplay">1.32x</div>
            </div>
            <div class="text-center">
              <div class="text-xs font-bold uppercase" style="color: var(--text-muted);">Calc Term</div>
              <div class="text-lg font-bold" style="color: var(--text-secondary);" id="calcTermDisplay">9 mo</div>
            </div>
          </div>
        </div>
        
        <!-- Bottom Row: Risk Analytics -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-3" id="overrideRiskIndicators">
          
          <!-- Risk Impact Metrics -->
          <div class="p-4 rounded-lg" style="background: var(--bg-card);">
            <div class="text-[10px] font-bold uppercase tracking-wider mb-3" style="color: var(--text-muted);">Risk Impact</div>
            <div class="grid grid-cols-3 gap-3">
              <div class="text-center p-3 rounded-lg" style="background: rgba(234, 179, 8, 0.15); border: 1px solid rgba(234, 179, 8, 0.3);">
                <div class="text-xl font-extrabold" id="pdImpact" style="color: #eab308;">+2.1%</div>
                <div class="text-[10px] font-bold uppercase tracking-wide" style="color: #eab308; opacity: 0.8;">PD Change</div>
              </div>
              <div class="text-center p-3 rounded-lg" style="background: rgba(16, 185, 129, 0.15); border: 1px solid rgba(16, 185, 129, 0.3);">
                <div class="text-xl font-extrabold" id="dscrImpact" style="color: #10b981;">1.85x</div>
                <div class="text-[10px] font-bold uppercase tracking-wide" style="color: #10b981; opacity: 0.8;">DSCR</div>
              </div>
              <div class="text-center p-3 rounded-lg" style="background: rgba(234, 179, 8, 0.15); border: 1px solid rgba(234, 179, 8, 0.3);">
                <div class="text-xl font-extrabold" id="riskScore" style="color: #eab308;">Medium</div>
                <div class="text-[10px] font-bold uppercase tracking-wide" style="color: #eab308; opacity: 0.8;">Risk</div>
              </div>
            </div>
          </div>

          <!-- Probability of Default Gauge -->
          <div class="p-4 rounded-lg" style="background: var(--bg-card);">
            <div class="text-[10px] font-bold uppercase tracking-wider mb-2" style="color: var(--text-muted);">Probability of Default</div>
            <div class="gauge-container" style="transform: scale(0.85); transform-origin: top center;">
              <svg width="180" height="100" viewBox="0 0 180 100">
                <path class="gauge-arc gauge-bg" d="M 20 80 A 60 60 0 0 1 160 80" />
                <path class="gauge-arc gauge-fill" id="pdGaugeFill" d="M 20 80 A 60 60 0 0 1 160 80" 
                  stroke="#10b981" stroke-dasharray="0 188" />
                <circle class="gauge-needle" id="pdNeedle" cx="20" cy="80" r="4" />
              </svg>
              <div class="gauge-center-label">
                <div class="text-xl font-extrabold" id="pdValue" style="color: var(--text-primary);">8.2%</div>
                <div class="text-[9px] font-bold uppercase" style="color: var(--text-muted);">Est. PD</div>
              </div>
            </div>
            <div class="pd-scale" style="margin-top: -10px;">
              <span class="pd-scale-item" style="color: #10b981; font-size: 9px;">Low</span>
              <span class="pd-scale-item" style="color: #eab308; font-size: 9px;">Med</span>
              <span class="pd-scale-item" style="color: #f97316; font-size: 9px;">High</span>
              <span class="pd-scale-item" style="color: #ef4444; font-size: 9px;">Severe</span>
            </div>
          </div>

          <!-- DSCR Impact -->
          <div class="p-4 rounded-lg" style="background: var(--bg-card);">
            <div class="text-[10px] font-bold uppercase tracking-wider mb-3" style="color: var(--text-muted);">Debt Service Coverage</div>
            <div class="dscr-bar mb-3">
              <div class="text-[10px] font-bold" style="color: var(--text-muted);">0x</div>
              <div class="dscr-bar-track">
                <div class="dscr-marker" style="left: 33%;" data-label="1x"></div>
                <div class="dscr-marker" style="left: 50%;" data-label="1.5x"></div>
                <div class="dscr-marker" style="left: 66%;" data-label="2x"></div>
                <div class="dscr-bar-fill" id="dscrBarFill" style="width: 62%; background: #10b981;">
                  <span class="text-[10px] font-bold" style="color: #000;" id="dscrBarValue">1.85x</span>
                </div>
              </div>
              <div class="text-[10px] font-bold" style="color: var(--text-muted);">3x</div>
            </div>
            <div class="grid grid-cols-3 gap-2 text-center">
              <div>
                <div class="text-sm font-bold" style="color: var(--text-primary);" id="dscrMonthlyRev">$50,000</div>
                <div class="text-[7px] font-bold uppercase" style="color: var(--text-muted);">Monthly Rev</div>
              </div>
              <div>
                <div class="text-sm font-bold" style="color: var(--text-primary);" id="dscrMonthlyDebt">$2,574</div>
                <div class="text-[7px] font-bold uppercase" style="color: var(--text-muted);">Monthly Debt</div>
              </div>
              <div>
                <div class="text-sm font-bold" id="dscrRatio" style="color: #10b981;">1.85x</div>
                <div class="text-[7px] font-bold uppercase" style="color: var(--text-muted);">DSCR</div>
              </div>
            </div>
            <div class="mt-2 p-2 rounded-lg text-[9px]" id="dscrWarning" style="background: rgba(16, 185, 129, 0.1); color: #10b981; display: none;">
              <strong>Healthy DSCR:</strong> Excellent revenue coverage for debt service.
            </div>
          </div>

        </div>
      </div>

      <!-- TWO COLUMN LAYOUT: Sliders + Card -->
      <div class="override-layout px-6 max-w-[1600px] mx-auto">
        
        <!-- LEFT: Override Controls -->
        <div class="space-y-6 override-controls-column" id="overrideControlsPanel">
          <div class="mobile-panel-handle" onclick="togglePanel('overrideControlsPanel')">
            <div class="drawer-handle-bar"></div>
            <div class="drawer-label">
              <div class="drawer-chevrons">
                <div class="drawer-chevron"></div>
                <div class="drawer-chevron"></div>
              </div>
              <span class="drawer-label-text"></span>
              <div class="drawer-chevrons">
                <div class="drawer-chevron"></div>
                <div class="drawer-chevron"></div>
              </div>
            </div>
          </div>
          <div class="card p-4">
            
            <!-- Section Header -->
            <div class="flex items-center gap-3 mb-4">
              <div class="section-indicator"></div>
              <h3 class="section-title">Model Override Controls</h3>
            </div>
          
            <!-- Funding Override -->
            <div class="override-slider-group mb-2">
            <div class="override-slider-header">
              <div>
                <label class="text-xs font-bold uppercase tracking-wide" style="color: var(--text-muted);">Funding Amount</label>
              </div>
              <div class="override-value-display">
                <div class="override-value-main" id="overrideFundingDisplay">$17,500</div>
                <div class="override-value-calc">Calc: <span id="calcFundingRef">$17,500</span></div>
              </div>
            </div>
            <input type="range" class="slider w-full" id="overrideFunding" min="5000" max="100000" step="1" value="17500" oninput="calculateOverride()">
            <div class="flex justify-between text-[10px] font-semibold mt-1" style="color: var(--text-muted);">
              <span>$5,000</span>
              <span>$100,000</span>
            </div>
            <div class="mt-2" id="fundingVarianceContainer">
              <div class="variance-indicator neutral" id="fundingVariance">
                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14"/></svg>
                <span>No variance</span>
              </div>
            </div>
          </div>

          <!-- Factor Rate Override -->
          <div class="override-slider-group mb-2">
            <div class="override-slider-header">
              <div>
                <label class="text-xs font-bold uppercase tracking-wide" style="color: var(--text-muted);">Factor Rate</label>
              </div>
              <div class="override-value-display">
                <div class="override-value-main" id="overrideFactorDisplay">1.32x</div>
                <div class="override-value-calc">Calc: <span id="calcFactorRef">1.32x</span></div>
              </div>
            </div>
            <input type="range" class="slider w-full" id="overrideFactor" min="1.15" max="1.55" step="0.01" value="1.32" oninput="calculateOverride()">
            <div class="flex justify-between text-[10px] font-semibold mt-1" style="color: var(--text-muted);">
              <span>1.15x</span>
              <span>1.55x</span>
            </div>
            <div class="mt-2" id="factorVarianceContainer">
              <div class="variance-indicator neutral" id="factorVariance">
                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14"/></svg>
                <span>No variance</span>
              </div>
            </div>
          </div>

          <!-- Term Override -->
          <div class="override-slider-group mb-2">
            <div class="override-slider-header">
              <div>
                <label class="text-xs font-bold uppercase tracking-wide" style="color: var(--text-muted);">Term Length</label>
              </div>
              <div class="override-value-display">
                <div class="override-value-main" id="overrideTermDisplay">9 Months</div>
                <div class="override-value-calc">Calc: <span id="calcTermRef">9 mo</span></div>
              </div>
            </div>
            <input type="range" class="slider w-full" id="overrideTerm" min="3" max="15" step="1" value="9" oninput="calculateOverride()">
            <div class="flex justify-between text-[10px] font-semibold mt-1" style="color: var(--text-muted);">
              <span>3 mo</span>
              <span>15 mo</span>
            </div>
            <div class="mt-2" id="termVarianceContainer">
              <div class="variance-indicator neutral" id="termVariance">
                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14"/></svg>
                <span>No variance</span>
              </div>
            </div>
          </div>

          <!-- Payment Frequency Override -->
          <div class="override-slider-group mb-2 text-center">
            <label class="text-xs font-bold uppercase tracking-wide block mb-2" style="color: var(--text-muted);">Payment Frequency</label>
            <div class="freq-toggle-group">
              <label class="freq-toggle">
                <input type="radio" name="overridePaymentFreq" value="daily" checked onchange="calculateOverride()">
                <span class="freq-toggle-btn">Daily</span>
              </label>
              <label class="freq-toggle">
                <input type="radio" name="overridePaymentFreq" value="weekly" onchange="calculateOverride()">
                <span class="freq-toggle-btn">Weekly</span>
              </label>
            </div>
          </div>

          <!-- Reset Button -->
          <div class="grid grid-cols-2 gap-2 mt-2">
            <button onclick="recalculateOverrideWithConfirm(this)" class="w-full py-2 px-4 rounded-xl font-bold text-sm transition-all" 
              style="background: var(--accent); color: #000;">
              Recalculate
            </button>
            <button onclick="resetOverride()" class="w-full py-2 px-4 rounded-xl font-bold text-sm transition-all" 
              style="background: var(--bg-card-inner); border: 1px solid var(--border-primary); color: var(--text-secondary);">
              Reset
            </button>
          </div>
          <div id="overrideConfirmMsg" class="text-center text-xs mt-1 font-semibold" style="color: #22c55e; opacity: 0; transition: opacity 0.3s;"></div>

          </div>
        </div>

        <!-- RIGHT: Result Preview Card -->
        <div class="override-result-column">
          <div class="preview-sticky-wrapper">
          <!-- Override Result Card -->
          <div class="calc-result-preview" id="overrideResultCard">
            <div class="calc-preview-header" id="overrideResultHeader">
              <div class="calc-preview-label">Model Override</div>
              <div class="calc-preview-amount" id="overrideOfferFunding">$17,500</div>
            </div>

            <div class="calc-stats-grid">
              <div class="calc-stat-cell">
                <span class="calc-stat-label">Factor Rate</span>
                <span class="calc-stat-value" id="overrideOfferFactor">1.32x</span>
              </div>
              <div class="calc-stat-cell">
                <span class="calc-stat-label">Term</span>
                <span class="calc-stat-value" id="overrideOfferTerm">9 Months</span>
              </div>
              <div class="calc-stat-cell">
                <span class="calc-stat-label">Total Payback</span>
                <span class="calc-stat-value" id="overrideOfferPayback">$23,100</span>
              </div>
              <div class="calc-stat-cell">
                <span class="calc-stat-label" id="overridePaymentFreqLabel">Daily Payment</span>
                <span class="calc-stat-value accent" id="overrideOfferPayment">$117</span>
              </div>
            </div>

            <!-- Holdback & APR Display -->
            <div class="grid grid-cols-2 gap-0" style="border-bottom: 1px solid var(--border-secondary); background: rgba(var(--accent-rgb), 0.05);">
              <div class="p-4 text-center" style="border-right: 1px solid var(--border-secondary);">
                <div class="text-xs font-bold uppercase tracking-wider mb-1" style="color: var(--text-muted);">Holdback</div>
                <div class="text-2xl font-extrabold" style="color: var(--accent);" id="overrideOfferHoldback">4.91%</div>
              </div>
              <div class="p-4 text-center">
                <div class="text-xs font-bold uppercase tracking-wider mb-1" style="color: var(--text-muted);">Est. APR</div>
                <div class="text-2xl font-extrabold" style="color: var(--accent);" id="overrideOfferAPR">42.7%</div>
              </div>
            </div>

            <!-- Comparison Section -->
            <div class="p-4" style="border-bottom: 1px solid var(--border-secondary);">
              <div class="text-xs font-bold uppercase tracking-wider mb-3" style="color: var(--text-muted);">Variance from Calculated</div>
              <div class="comparison-row">
                <span class="comparison-label">Funding</span>
                <div class="comparison-values">
                  <span class="comparison-calc" id="compFundingCalc">$17,500</span>
                  <span class="comparison-override" id="compFundingOverride">$17,500</span>
                  <span class="text-xs font-bold" id="compFundingDiff" style="color: var(--text-muted);">+$0</span>
                </div>
              </div>
              <div class="comparison-row">
                <span class="comparison-label">Payback</span>
                <div class="comparison-values">
                  <span class="comparison-calc" id="compPaybackCalc">$23,100</span>
                  <span class="comparison-override" id="compPaybackOverride">$23,100</span>
                  <span class="text-xs font-bold" id="compPaybackDiff" style="color: var(--text-muted);">+$0</span>
                </div>
              </div>
              <div class="comparison-row">
                <span class="comparison-label" id="compPaymentLabel">Daily Payment</span>
                <div class="comparison-values">
                  <span class="comparison-calc" id="compPaymentCalc">$117</span>
                  <span class="comparison-override" id="compPaymentOverride">$117</span>
                  <span class="text-xs font-bold" id="compPaymentDiff" style="color: var(--text-muted);">+$0</span>
                </div>
              </div>
            </div>

            <!-- Closing Breakdown -->
            <div class="p-4" style="border-bottom: 1px solid var(--border-secondary);">
              <div class="text-xs font-bold uppercase tracking-wider mb-3" style="color: var(--text-muted);">Closing Breakdown</div>
              <div class="space-y-2 text-xs">
                <div class="flex justify-between" style="color: var(--text-secondary);">
                  <span>Gross Funding</span>
                  <span class="font-semibold" id="overrideClosingGross">$17,500</span>
                </div>
                <div class="flex justify-between" style="color: var(--text-muted);">
                  <span>Origination Fee (3%)</span>
                  <span id="overrideClosingOrig">-$525</span>
                </div>
                <div class="flex justify-between" style="color: var(--text-muted);">
                  <span>Admin Fee</span>
                  <span>-$995</span>
                </div>
                <div class="flex justify-between" style="color: var(--text-muted);">
                  <span>Wire Fee</span>
                  <span>-$50</span>
                </div>
                <div class="flex justify-between pt-2 mt-2" style="border-top: 1px solid var(--border-secondary); color: var(--accent);">
                  <span class="font-bold">Net Wire Amount</span>
                  <span class="font-bold" id="overrideClosingNet">$15,930</span>
                </div>
              </div>
            </div>

            <!-- Override Decision -->
            <div class="calc-payment-display" id="overrideDecisionSection" style="background: rgba(var(--accent-rgb), 0.1);">
              <div class="calc-payment-label" style="color: var(--accent);">Override Status</div>
              <div class="calc-payment-amount" id="overrideDecisionStatus" style="color: var(--accent); font-size: 1.25rem;">APPROVED (OVERRIDE)</div>
            </div>
          </div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- MODEL INFO TAB -->
  <div id="tab-model" class="tab-panel">
    <div class="model-container">
      
      <!-- Header -->
      <div class="mb-12 text-center">
        <h1 class="text-3xl font-extrabold mb-2" style="color: var(--text-primary);">AblesAI v4.2</h1>
        <p class="text-sm" style="color: var(--text-muted);">Predictive Engine for Revenue-Based Underwriting Scoring</p>
        <p class="text-xs mt-2" style="color: var(--text-muted);">Updated Dec 2024 - Model-Driven Offer Payment Schedule</p>
      </div>

      <!-- Intro Grid -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
        
        <!-- What is AblesAI -->
        <div class="model-card">
          <div class="model-card-header">
            <div class="model-card-icon" style="background: #10b981;">?</div>
            <span class="text-sm font-bold" style="color: var(--text-primary);">What is AblesAI?</span>
          </div>
          <div class="model-card-body">
            <p class="text-sm leading-relaxed mb-3" style="color: var(--text-secondary);">
              AblesAI is a proprietary credit scoring algorithm designed specifically for Merchant Cash Advance (MCA) underwriting. Unlike traditional FICO scores that focus on consumer credit history, AblesAI evaluates a business's ability to repay based on actual cash flow performance.
            </p>
            <p class="text-sm leading-relaxed" style="color: var(--text-secondary);">
              The model analyzes 5 key dimensions of business health, producing a score 0-100 that determines both approval status and pricing tier.
            </p>
          </div>
        </div>

        <!-- Score Range & Tiers -->
        <div class="model-card">
          <div class="model-card-header">
            <span class="text-sm font-bold" style="color: var(--text-primary);">Score Range & Tiers</span>
          </div>
          <div class="model-card-body">
            <div class="tier-table-row">
              <div class="tier-badge" style="background: #10b981;">A</div>
              <div class="flex-1">
                <div class="text-sm font-bold" style="color: var(--text-primary);">Prime</div>
                <div class="text-xs" style="color: var(--text-muted);">Factor: 1.18x | Term: 12 mo</div>
              </div>
              <div class="text-sm font-semibold" style="color: var(--text-secondary);">80-100 pts</div>
            </div>
            <div class="tier-table-row">
              <div class="tier-badge" style="background: #22c55e;">B</div>
              <div class="flex-1">
                <div class="text-sm font-bold" style="color: var(--text-primary);">Standard</div>
                <div class="text-xs" style="color: var(--text-muted);">Factor: 1.24x | Term: 10 mo</div>
              </div>
              <div class="text-sm font-semibold" style="color: var(--text-secondary);">65-79 pts</div>
            </div>
            <div class="tier-table-row">
              <div class="tier-badge" style="background: #eab308;">C</div>
              <div class="flex-1">
                <div class="text-sm font-bold" style="color: var(--text-primary);">Mid-Prime</div>
                <div class="text-xs" style="color: var(--text-muted);">Factor: 1.32x | Term: 9 mo</div>
              </div>
              <div class="text-sm font-semibold" style="color: var(--text-secondary);">50-64 pts</div>
            </div>
            <div class="tier-table-row">
              <div class="tier-badge" style="background: #f97316;">D</div>
              <div class="flex-1">
                <div class="text-sm font-bold" style="color: var(--text-primary);">Elevated Risk</div>
                <div class="text-xs" style="color: var(--text-muted);">Factor: 1.38x | Term: 6 mo</div>
              </div>
              <div class="text-sm font-semibold" style="color: var(--text-secondary);">35-49 pts</div>
            </div>
            <div class="tier-table-row">
              <div class="tier-badge" style="background: #ef4444;">E</div>
              <div class="flex-1">
                <div class="text-sm font-bold" style="color: var(--text-primary);">High Risk</div>
                <div class="text-xs" style="color: var(--text-muted);">Factor: 1.45x | Term: 4 mo</div>
              </div>
              <div class="text-sm font-semibold" style="color: var(--text-secondary);">0-34 pts</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Score Weight Distribution -->
      <div class="text-[10px] font-bold uppercase tracking-wider mb-4" style="color: var(--text-muted);">Score Weight Distribution</div>
      <div class="model-card mb-8">
        <div class="model-card-body">
          <div class="donut-section">
            <div class="donut-chart">
              <svg width="160" height="160" viewBox="0 0 160 160">
                <circle cx="80" cy="80" r="60" fill="none" stroke="#1a1a1a" stroke-width="18"/>
                <circle cx="80" cy="80" r="60" fill="none" stroke="#f97316" stroke-width="18"
                  stroke-dasharray="113 377" stroke-dashoffset="0" stroke-linecap="round"/>
                <circle cx="80" cy="80" r="60" fill="none" stroke="#eab308" stroke-width="18"
                  stroke-dasharray="113 377" stroke-dashoffset="-113" stroke-linecap="round"/>
                <circle cx="80" cy="80" r="60" fill="none" stroke="#10b981" stroke-width="18"
                  stroke-dasharray="75 377" stroke-dashoffset="-226" stroke-linecap="round"/>
                <circle cx="80" cy="80" r="60" fill="none" stroke="#06b6d4" stroke-width="18"
                  stroke-dasharray="38 377" stroke-dashoffset="-301" stroke-linecap="round"/>
                <circle cx="80" cy="80" r="60" fill="none" stroke="#8b5cf6" stroke-width="18"
                  stroke-dasharray="38 377" stroke-dashoffset="-339" stroke-linecap="round"/>
              </svg>
              <div class="donut-center">
                <span class="text-3xl font-extrabold" style="color: var(--text-primary);">100</span>
                <span class="text-[9px] font-bold uppercase" style="color: var(--text-muted);">Max Points</span>
              </div>
            </div>
            <div class="grid grid-cols-2 gap-3">
              <div class="flex items-center gap-2">
                <div class="w-3 h-3 rounded" style="background: #f97316;"></div>
                <div>
                  <div class="text-xs" style="color: var(--text-secondary);">Credit Score</div>
                  <div class="text-[10px]" style="color: var(--text-muted);">30 points (30%)</div>
                </div>
              </div>
              <div class="flex items-center gap-2">
                <div class="w-3 h-3 rounded" style="background: #eab308;"></div>
                <div>
                  <div class="text-xs" style="color: var(--text-secondary);">Behavior</div>
                  <div class="text-[10px]" style="color: var(--text-muted);">30 points (30%)</div>
                </div>
              </div>
              <div class="flex items-center gap-2">
                <div class="w-3 h-3 rounded" style="background: #10b981;"></div>
                <div>
                  <div class="text-xs" style="color: var(--text-secondary);">Revenue</div>
                  <div class="text-[10px]" style="color: var(--text-muted);">20 points (20%)</div>
                </div>
              </div>
              <div class="flex items-center gap-2">
                <div class="w-3 h-3 rounded" style="background: #06b6d4;"></div>
                <div>
                  <div class="text-xs" style="color: var(--text-secondary);">Stability</div>
                  <div class="text-[10px]" style="color: var(--text-muted);">10 points (10%)</div>
                </div>
              </div>
              <div class="flex items-center gap-2">
                <div class="w-3 h-3 rounded" style="background: #8b5cf6;"></div>
                <div>
                  <div class="text-xs" style="color: var(--text-secondary);">Buffer</div>
                  <div class="text-[10px]" style="color: var(--text-muted);">10 points (10%)</div>
                </div>
              </div>
              <div class="flex items-center gap-2">
                <div class="w-3 h-3 rounded" style="background: #ef4444;"></div>
                <div>
                  <div class="text-xs" style="color: var(--text-secondary);">Prohibited Industry</div>
                  <div class="text-[10px]" style="color: var(--text-muted);">Auto-Decline</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Scoring Components -->
      <div class="text-[10px] font-bold uppercase tracking-wider mb-4" style="color: var(--text-muted);">Scoring Components Explained</div>

      <!-- Credit Score -->
      <div class="score-component">
        <div class="score-component-header">
          <div class="score-comp-badge" style="background: #f97316;">30</div>
          <div class="flex-1">
            <h3 class="text-sm font-bold" style="color: var(--text-primary);">Credit Score (FICO)</h3>
            <p class="text-xs" style="color: var(--text-muted);">Traditional credit quality indicator</p>
          </div>
          <span class="text-[10px] font-bold px-2 py-1 rounded" style="background: rgba(239,68,68,0.15); color: #ef4444;">KNOCKOUT: &lt;500</span>
        </div>
        <div class="score-component-body">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
            <div>
              <div class="text-[9px] font-bold uppercase tracking-wider mb-2" style="color: var(--text-muted);">Formula</div>
              <div class="formula-value">( (FICO - 500) / 300 ) x 30</div>
            </div>
            <div>
              <div class="text-[9px] font-bold uppercase tracking-wider mb-2" style="color: var(--text-muted);">Example</div>
              <div class="formula-value">FICO 680 = (680-500)/300 x 30 = 18 pts</div>
            </div>
          </div>
          <div class="text-[9px] font-bold uppercase tracking-wider mb-2" style="color: var(--text-muted);">Score Curve</div>
          <div class="score-gradient-bar"></div>
          <div class="flex justify-between text-[9px]" style="color: var(--text-muted);">
            <span>500</span><span>550</span><span>600</span><span>650</span><span>700</span><span>800+</span>
          </div>
        </div>
      </div>

      <!-- Behavior -->
      <div class="score-component">
        <div class="score-component-header">
          <div class="score-comp-badge" style="background: #eab308;">30</div>
          <div class="flex-1">
            <h3 class="text-sm font-bold" style="color: var(--text-primary);">Behavior (Risk Events)</h3>
            <p class="text-xs" style="color: var(--text-muted);">NSF/Overdrafts + Negative Balance Days (90-Day Period)</p>
          </div>
          <span class="text-[10px] font-bold px-2 py-1 rounded" style="background: rgba(239,68,68,0.15); color: #ef4444;">KNOCKOUT: >10 events</span>
        </div>
        <div class="score-component-body">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
            <div>
              <div class="text-[9px] font-bold uppercase tracking-wider mb-2" style="color: var(--text-muted);">Formula</div>
              <div class="formula-value">30 - (events x 3)</div>
            </div>
            <div>
              <div class="text-[9px] font-bold uppercase tracking-wider mb-2" style="color: var(--text-muted);">Events = NSF + NEG DAYS</div>
              <div class="formula-value">2 NSF + 1 neg day = 3 events = 21 pts</div>
            </div>
          </div>
          <div class="text-[9px] font-bold uppercase tracking-wider mb-2" style="color: var(--text-muted);">Points by Event Count</div>
          <div class="points-grid">
            <div class="points-cell" style="background: #10b981; color: #000;"><span class="block text-sm font-extrabold">30</span><span class="text-[8px]">0</span></div>
            <div class="points-cell" style="background: #10b981; color: #000;"><span class="block text-sm font-extrabold">27</span><span class="text-[8px]">1</span></div>
            <div class="points-cell" style="background: #22c55e; color: #000;"><span class="block text-sm font-extrabold">24</span><span class="text-[8px]">2</span></div>
            <div class="points-cell" style="background: #22c55e; color: #000;"><span class="block text-sm font-extrabold">21</span><span class="text-[8px]">3</span></div>
            <div class="points-cell" style="background: #eab308; color: #000;"><span class="block text-sm font-extrabold">18</span><span class="text-[8px]">4</span></div>
            <div class="points-cell" style="background: #eab308; color: #000;"><span class="block text-sm font-extrabold">15</span><span class="text-[8px]">5</span></div>
            <div class="points-cell" style="background: #f97316; color: #000;"><span class="block text-sm font-extrabold">12</span><span class="text-[8px]">6</span></div>
            <div class="points-cell" style="background: #f97316; color: #000;"><span class="block text-sm font-extrabold">9</span><span class="text-[8px]">7</span></div>
            <div class="points-cell" style="background: #ef4444; color: #fff;"><span class="block text-sm font-extrabold">6</span><span class="text-[8px]">8</span></div>
            <div class="points-cell" style="background: #ef4444; color: #fff;"><span class="block text-sm font-extrabold">3</span><span class="text-[8px]">9</span></div>
            <div class="points-cell" style="background: #7f1d1d; color: #fff;"><span class="block text-sm font-extrabold">0</span><span class="text-[8px]">10+</span></div>
          </div>
        </div>
      </div>

      <!-- Revenue -->
      <div class="score-component">
        <div class="score-component-header">
          <div class="score-comp-badge" style="background: #10b981;">20</div>
          <div class="flex-1">
            <h3 class="text-sm font-bold" style="color: var(--text-primary);">Revenue (Monthly Deposits)</h3>
            <p class="text-xs" style="color: var(--text-muted);">Business cash flow capacity</p>
          </div>
          <span class="text-[10px] font-bold px-2 py-1 rounded" style="background: rgba(239,68,68,0.15); color: #ef4444;">KNOCKOUT: &lt;$7,500</span>
        </div>
        <div class="score-component-body">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
            <div>
              <div class="text-[9px] font-bold uppercase tracking-wider mb-2" style="color: var(--text-muted);">Formula</div>
              <div class="formula-value">( (Rev - 7500) / 92500 ) x 20</div>
            </div>
            <div>
              <div class="text-[9px] font-bold uppercase tracking-wider mb-2" style="color: var(--text-muted);">Example</div>
              <div class="formula-value">$50K/mo = (50000-7500)/92500 x 20 = 9.2 pts</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Stability -->
      <div class="score-component">
        <div class="score-component-header">
          <div class="score-comp-badge" style="background: #06b6d4;">10</div>
          <div class="flex-1">
            <h3 class="text-sm font-bold" style="color: var(--text-primary);">Stability (Time in Business)</h3>
            <p class="text-xs" style="color: var(--text-muted);">Business maturity and track record</p>
          </div>
        </div>
        <div class="score-component-body">
          <div class="text-[9px] font-bold uppercase tracking-wider mb-3" style="color: var(--text-muted);">Fixed Tier System</div>
          <div class="tier-boxes">
            <div class="tier-box" style="border-color: #10b981; background: rgba(16,185,129,0.1);">
              <div class="text-2xl font-extrabold" style="color: #10b981;">10</div>
              <div class="text-xs font-semibold" style="color: #10b981;">36+ mo</div>
              <div class="text-[10px]" style="color: var(--text-muted);">3+ years</div>
            </div>
            <div class="tier-box" style="border-color: #22c55e; background: rgba(34,197,94,0.1);">
              <div class="text-2xl font-extrabold" style="color: #22c55e;">7</div>
              <div class="text-xs font-semibold" style="color: #22c55e;">24-35 mo</div>
              <div class="text-[10px]" style="color: var(--text-muted);">2-3 years</div>
            </div>
            <div class="tier-box" style="border-color: #eab308; background: rgba(234,179,8,0.1);">
              <div class="text-2xl font-extrabold" style="color: #eab308;">4</div>
              <div class="text-xs font-semibold" style="color: #eab308;">12-23 mo</div>
              <div class="text-[10px]" style="color: var(--text-muted);">1-2 years</div>
            </div>
            <div class="tier-box" style="border-color: #ef4444; background: rgba(239,68,68,0.1);">
              <div class="text-2xl font-extrabold" style="color: #ef4444;">1</div>
              <div class="text-xs font-semibold" style="color: #ef4444;">&lt;12 mo</div>
              <div class="text-[10px]" style="color: var(--text-muted);">&lt;1 year</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Buffer -->
      <div class="score-component">
        <div class="score-component-header">
          <div class="score-comp-badge" style="background: #8b5cf6;">10</div>
          <div class="flex-1">
            <h3 class="text-sm font-bold" style="color: var(--text-primary);">Buffer (ADB / Revenue Ratio)</h3>
            <p class="text-xs" style="color: var(--text-muted);">Cash reserve as safety cushion</p>
          </div>
        </div>
        <div class="score-component-body">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
            <div>
              <div class="text-[9px] font-bold uppercase tracking-wider mb-2" style="color: var(--text-muted);">Formula</div>
              <div class="formula-value">Avg Daily Balance / Monthly Revenue</div>
            </div>
            <div>
              <div class="text-[9px] font-bold uppercase tracking-wider mb-2" style="color: var(--text-muted);">Example</div>
              <div class="formula-value">$5K ADB / $50K Rev = 10% = 10 pts</div>
            </div>
          </div>
          <div class="text-[9px] font-bold uppercase tracking-wider mb-3" style="color: var(--text-muted);">Buffer Thresholds</div>
          <div class="buffer-boxes">
            <div class="tier-box" style="border-color: #10b981; background: rgba(16,185,129,0.1);">
              <div class="text-2xl font-extrabold" style="color: #10b981;">10</div>
              <div class="text-xs font-semibold" style="color: #10b981;">10%+</div>
              <div class="text-[10px]" style="color: var(--text-muted);">Strong Reserve</div>
            </div>
            <div class="tier-box" style="border-color: #eab308; background: rgba(234,179,8,0.1);">
              <div class="text-2xl font-extrabold" style="color: #eab308;">5</div>
              <div class="text-xs font-semibold" style="color: #eab308;">5-9.9%</div>
              <div class="text-[10px]" style="color: var(--text-muted);">Moderate</div>
            </div>
            <div class="tier-box" style="border-color: #ef4444; background: rgba(239,68,68,0.1);">
              <div class="text-2xl font-extrabold" style="color: #ef4444;">0</div>
              <div class="text-xs font-semibold" style="color: #ef4444;">&lt;5%</div>
              <div class="text-[10px]" style="color: var(--text-muted);">Thin Margins</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Decline / Safety Rules -->
      <div class="rules-grid">
        <div class="rules-card">
          <div class="rules-card-header" style="background: rgba(239,68,68,0.1);">
            <div class="rules-icon" style="background: #ef4444; color: #fff;">&#10005;</div>
            <span class="text-sm font-bold" style="color: #ef4444;">Automatic Declines</span>
          </div>
          <div class="rules-card-body">
            <p class="text-xs mb-3" style="color: var(--text-muted);">These criteria result in immediate decline:</p>
            <ul class="rules-list">
              <li><span class="w-2 h-2 rounded-full flex-shrink-0" style="background: #ef4444;"></span>FICO score below 500</li>
              <li><span class="w-2 h-2 rounded-full flex-shrink-0" style="background: #ef4444;"></span>Monthly revenue below $7,500</li>
              <li><span class="w-2 h-2 rounded-full flex-shrink-0" style="background: #ef4444;"></span>More than 10 risk events (90 days)</li>
              <li><span class="w-2 h-2 rounded-full flex-shrink-0" style="background: #ef4444;"></span>Qualified amount below $10,000</li>
              <li><span class="w-2 h-2 rounded-full flex-shrink-0" style="background: #ef4444;"></span>Prohibited industry (8 categories)</li>
              <li><span class="w-2 h-2 rounded-full flex-shrink-0" style="background: #ef4444;"></span>Trucking with less than 5 vehicles</li>
              <li><span class="w-2 h-2 rounded-full flex-shrink-0" style="background: #ef4444;"></span>Existing debt exceeds 25% of revenue</li>
            </ul>
          </div>
        </div>

        <div class="rules-card">
          <div class="rules-card-header" style="background: rgba(234,179,8,0.1);">
            <div class="rules-icon" style="background: #eab308; color: #000;">!</div>
            <span class="text-sm font-bold" style="color: #eab308;">Safety Valves</span>
          </div>
          <div class="rules-card-body">
            <p class="text-xs mb-3" style="color: var(--text-muted);">Credit triggers that force tier downgrades:</p>
            <ul class="rules-list">
              <li><span class="w-2 h-2 rounded-full flex-shrink-0" style="background: #eab308;"></span>FICO &lt; 600 = Maximum Tier C</li>
              <li><span class="w-2 h-2 rounded-full flex-shrink-0" style="background: #f97316;"></span>FICO &lt; 550 = Maximum Tier D</li>
              <li><span class="w-2 h-2 rounded-full flex-shrink-0" style="background: #ef4444;"></span>FICO &lt; 520 = Forced to Tier E</li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Payment Frequency Logic -->
      <div class="text-[10px] font-bold uppercase tracking-wider mb-4 mt-8" style="color: var(--text-muted);">Offer Payment Frequency</div>
      <div class="model-card mb-8">
        <div class="model-card-body">
          <p class="text-sm mb-4" style="color: var(--text-secondary);">
            The model determines whether the approved offer will have <span style="color: var(--text-primary); font-weight: 600;">daily or weekly payments</span>. Weekly payments are offered only when all criteria are met:
          </p>
          <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
            <div class="p-3 rounded-lg" style="background: var(--card-bg); border: 1px solid var(--border-secondary);">
              <div class="text-xs font-bold" style="color: var(--accent);">DSCR</div>
              <div class="text-lg font-extrabold" style="color: var(--text-primary);">1.5x+</div>
              <div class="text-[10px]" style="color: var(--text-muted);">Debt coverage ratio</div>
            </div>
            <div class="p-3 rounded-lg" style="background: var(--card-bg); border: 1px solid var(--border-secondary);">
              <div class="text-xs font-bold" style="color: var(--accent);">Debt Burden</div>
              <div class="text-lg font-extrabold" style="color: var(--text-primary);">15%</div>
              <div class="text-[10px]" style="color: var(--text-muted);">Max existing debt</div>
            </div>
            <div class="p-3 rounded-lg" style="background: var(--card-bg); border: 1px solid var(--border-secondary);">
              <div class="text-xs font-bold" style="color: var(--accent);">Cash Buffer</div>
              <div class="text-lg font-extrabold" style="color: var(--text-primary);">8%+</div>
              <div class="text-[10px]" style="color: var(--text-muted);">Balance / revenue</div>
            </div>
            <div class="p-3 rounded-lg" style="background: var(--card-bg); border: 1px solid var(--border-secondary);">
              <div class="text-xs font-bold" style="color: var(--accent);">Risk Events</div>
              <div class="text-lg font-extrabold" style="color: var(--text-primary);">3</div>
              <div class="text-[10px]" style="color: var(--text-muted);">Max NSF + neg days</div>
            </div>
          </div>
          <p class="text-xs mt-4" style="color: var(--text-muted);">
            If any criterion fails, the offer defaults to daily payments (safer for lender, more manageable for merchant).
          </p>
        </div>
      </div>

      <!-- Prohibited Industries -->
      <div class="text-[10px] font-bold uppercase tracking-wider mb-4" style="color: var(--text-muted);">Prohibited Industries</div>
      <div class="model-card mb-8">
        <div class="model-card-body">
          <p class="text-sm mb-4" style="color: var(--text-secondary);">
            The following industries result in automatic decline regardless of score:
          </p>
          <div class="grid grid-cols-2 md:grid-cols-4 gap-2">
            <div class="text-xs px-3 py-2 rounded" style="background: rgba(239,68,68,0.1); color: #ef4444;">Gambling/Casino</div>
            <div class="text-xs px-3 py-2 rounded" style="background: rgba(239,68,68,0.1); color: #ef4444;">Adult Entertainment</div>
            <div class="text-xs px-3 py-2 rounded" style="background: rgba(239,68,68,0.1); color: #ef4444;">Cannabis/CBD</div>
            <div class="text-xs px-3 py-2 rounded" style="background: rgba(239,68,68,0.1); color: #ef4444;">Firearms/Weapons</div>
            <div class="text-xs px-3 py-2 rounded" style="background: rgba(239,68,68,0.1); color: #ef4444;">Cryptocurrency</div>
            <div class="text-xs px-3 py-2 rounded" style="background: rgba(239,68,68,0.1); color: #ef4444;">Debt Collection</div>
            <div class="text-xs px-3 py-2 rounded" style="background: rgba(239,68,68,0.1); color: #ef4444;">Telemarketing</div>
            <div class="text-xs px-3 py-2 rounded" style="background: rgba(239,68,68,0.1); color: #ef4444;">Pawn Shop</div>
          </div>
          <p class="text-xs mt-4" style="color: var(--text-muted);">
            Transportation/Trucking is restricted (requires minimum 5-vehicle fleet).
          </p>
        </div>
      </div>

      <!-- Triple-Constraint Sizing -->
      <div class="sizing-section">
        <div class="flex items-center gap-3 mb-4">
          <div class="w-8 h-8 rounded-lg flex items-center justify-center text-sm font-extrabold" style="background: var(--accent); color: #000;">$</div>
          <span class="text-sm font-bold" style="color: var(--text-primary);">Funding Calculation</span>
        </div>
        <p class="text-sm mb-6" style="color: var(--text-muted);">Funding is calculated using a <span class="font-semibold" style="color: var(--text-primary);">calibrated multiplier</span> adjusted by business factors, then capped by debt capacity.</p>
        
        <div class="sizing-caps">
          <div class="sizing-cap">
            <div class="text-[10px] font-bold uppercase tracking-wider mb-1" style="color: var(--accent);">BASE</div>
            <div class="text-lg font-extrabold mb-1" style="color: var(--text-primary);">Revenue Multiple</div>
            <div class="text-xs" style="color: var(--text-muted);">Starting point: 0.40x revenue</div>
            <div class="text-[10px] mt-3 pt-3" style="border-top: 1px solid var(--border-secondary); color: var(--text-secondary);">Calibrated to RC+10%</div>
          </div>
          <div class="sizing-cap">
            <div class="text-[10px] font-bold uppercase tracking-wider mb-1" style="color: var(--accent);">ADJUST</div>
            <div class="text-lg font-extrabold mb-1" style="color: var(--text-primary);">TIB / Credit / Events</div>
            <div class="text-xs" style="color: var(--text-muted);">Bonuses and penalties applied</div>
            <div class="text-[10px] mt-3 pt-3" style="border-top: 1px solid var(--border-secondary); color: var(--text-secondary);">10+ yr TIB: +0.80x bonus</div>
          </div>
          <div class="sizing-cap">
            <div class="text-[10px] font-bold uppercase tracking-wider mb-1" style="color: var(--accent);">CAP</div>
            <div class="text-lg font-extrabold mb-1" style="color: var(--text-primary);">Debt Capacity</div>
            <div class="text-xs" style="color: var(--text-muted);">Total debt service max 25% of revenue</div>
            <div class="text-[10px] mt-3 pt-3" style="border-top: 1px solid var(--border-secondary); color: var(--text-secondary);">Max funding: $165,000</div>
          </div>
        </div>

        <div class="example-box">
          <div class="flex items-center gap-2 mb-3">
            <div class="w-3 h-0.5 rounded" style="background: var(--accent);"></div>
            <span class="text-[9px] font-bold uppercase tracking-wider" style="color: var(--text-muted);">Example: Existing Debt Impact</span>
          </div>
          <p class="text-sm leading-relaxed" style="color: var(--text-secondary);">
            Merchant with $50K revenue, $3K/mo existing debt:<br>
            <span class="font-semibold" style="color: var(--text-primary);">Max Debt Service:</span> $50K x 25% = $12,500/mo<br>
            <span class="font-semibold" style="color: var(--text-primary);">Available for New:</span> $12,500 - $3,000 = $9,500/mo<br>
            <span class="font-semibold" style="color: var(--text-primary);">Max New Funding:</span> ~$76K (at Tier B factor 1.24x, 10 mo)<br>
            <span class="font-semibold" style="color: var(--accent);">Final Amount:</span> min(calculated amount, debt-capped amount)
          </p>
        </div>
      </div>

      <!-- Version Notes -->
      <div class="text-[10px] font-bold uppercase tracking-wider mb-4 mt-8" style="color: var(--text-muted);">Version Notes</div>
      <div class="model-card">
        <div class="model-card-body">
          <div class="mb-4">
            <div class="flex items-center gap-2 mb-2">
              <span class="text-xs font-bold" style="color: var(--accent);">v4.2</span>
              <span class="text-[10px]" style="color: var(--text-muted);">December 2024</span>
            </div>
            <ul class="text-xs space-y-1" style="color: var(--text-secondary);">
              <li>Model determines offer payment frequency (daily vs weekly) based on cash flow</li>
              <li>Prohibited industries now auto-decline (8 categories)</li>
              <li>Trucking requires minimum fleet size of 5 vehicles</li>
              <li>Existing debt consideration with 25% revenue cap</li>
            </ul>
          </div>
          <div class="mb-4">
            <div class="flex items-center gap-2 mb-2">
              <span class="text-xs font-bold" style="color: var(--text-secondary);">v4.1</span>
              <span class="text-[10px]" style="color: var(--text-muted);">November 2024</span>
            </div>
            <ul class="text-xs space-y-1" style="color: var(--text-muted);">
              <li>Funding calibrated to RC+10% methodology</li>
              <li>Industry dropdown with 20+ categories</li>
              <li>Risk indicator calculations (PD, LGD, EL, DSCR)</li>
            </ul>
          </div>
          <div>
            <div class="flex items-center gap-2 mb-2">
              <span class="text-xs font-bold" style="color: var(--text-secondary);">v4.0</span>
              <span class="text-[10px]" style="color: var(--text-muted);">October 2024</span>
            </div>
            <ul class="text-xs space-y-1" style="color: var(--text-muted);">
              <li>PERREPUS 5-component scoring model</li>
              <li>Tier-based pricing (A-E)</li>
              <li>Triple-constraint sizing methodology</li>
            </ul>
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- Floating Action Button for Sliders (Mobile) -->
  <button class="slider-fab" id="sliderFab" onclick="openSliderModal()">
    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
      <rect x="4" y="2" width="16" height="20" rx="2" fill="none" stroke="currentColor" stroke-width="2"/>
      <rect x="7" y="5" width="10" height="4" rx="1" fill="currentColor"/>
      <circle cx="8" cy="13" r="1.2" fill="currentColor"/>
      <circle cx="12" cy="13" r="1.2" fill="currentColor"/>
      <circle cx="16" cy="13" r="1.2" fill="currentColor"/>
      <circle cx="8" cy="17" r="1.2" fill="currentColor"/>
      <circle cx="12" cy="17" r="1.2" fill="currentColor"/>
      <circle cx="16" cy="17" r="1.2" fill="currentColor"/>
    </svg>
  </button>

  <!-- Slider Modal Overlay -->
  <div class="slider-modal-overlay" id="sliderModalOverlay" onclick="closeSliderModal(event)">
    <div class="slider-modal" onclick="event.stopPropagation()">
      <div class="slider-modal-header">
        <span class="slider-modal-title" id="modalTitle">Input Parameters</span>
        <button class="slider-modal-close" onclick="closeSliderModal()">&times;</button>
      </div>
      
      <!-- MODEL SCORE Sliders (Qualifications) -->
      <div id="modalCalcContent">
        <!-- Score Meter -->
        <div class="modal-score-meter">
          <div class="modal-score-header">
            <div class="modal-score-info">
              <div class="modal-tier-badge" id="modalTierBadge" style="border-color: #eab308;">
                <div class="modal-tier-letter" id="modalTierLetter" style="color: #eab308;">C</div>
                <div class="modal-tier-label" id="modalTierLabel">Mid-Prime</div>
              </div>
              <div class="modal-score-text">
                <div class="modal-score-label">AblesAI Score</div>
                <div class="modal-score-value">
                  <span class="modal-score-number" id="modalScoreNumber">62</span>
                  <span class="modal-score-max">/100</span>
                </div>
              </div>
            </div>
            <div class="modal-score-bar-container">
              <div class="modal-score-bar">
                <div class="modal-score-bar-fill" id="modalScoreBarFill" style="width: 100%;"></div>
                <div class="modal-score-bar-marker" id="modalScoreMarker" style="left: 62%;"></div>
              </div>
              <div class="modal-score-scale">
                <span style="color: #ef4444;">E <span style="opacity:0.6">0</span></span>
                <span style="color: #f97316;">D <span style="opacity:0.6">35</span></span>
                <span style="color: #eab308;">C <span style="opacity:0.6">50</span></span>
                <span style="color: #22c55e;">B <span style="opacity:0.6">65</span></span>
                <span style="color: #10b981;">A <span style="opacity:0.6">80+</span></span>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Offer Terms Section - between score and sliders -->
        <div class="modal-offer-terms">
          <div class="modal-section-label">Calculated Offer Terms</div>
          <div class="sliders-grid">
            <div class="slider-cell offer-term-cell">
              <label>Funding Amount</label>
              <div class="value" id="modalCalcFundingDisplay">$17,500</div>
            </div>
            <div class="slider-cell offer-term-cell">
              <label>Factor Rate</label>
              <div class="value" id="modalCalcFactorDisplay">1.32x</div>
            </div>
            <div class="slider-cell offer-term-cell">
              <label>Term Length</label>
              <div class="value" id="modalCalcTermDisplay">9 mo</div>
            </div>
          </div>
        </div>
        
        <div class="sliders-grid" id="modalSlidersGrid">
          <!-- Credit -->
          <div class="slider-cell">
            <label>Credit Score</label>
            <div class="value" id="modalCreditDisplay">650</div>
            <input type="range" class="slider" id="modalCreditScore" min="450" max="850" step="5" value="650" oninput="syncSlider('creditScore', this.value)">
          </div>
          
          <!-- Revenue -->
          <div class="slider-cell">
            <label>Monthly Revenue</label>
            <div class="value" id="modalRevenueDisplay">$50,000</div>
            <input type="range" class="slider" id="modalMonthlyRevenue" min="5000" max="500000" step="1" value="50000" oninput="syncSlider('monthlyRevenue', this.value)">
          </div>
          
          <!-- Balance -->
          <div class="slider-cell">
            <label>Avg Daily Balance</label>
            <div class="value" id="modalBalanceDisplay">$8,000</div>
            <input type="range" class="slider" id="modalAvgDailyBalance" min="500" max="100000" step="1" value="8000" oninput="syncSlider('avgDailyBalance', this.value)">
          </div>
          
          <!-- TIB -->
          <div class="slider-cell">
            <label>Time in Business</label>
            <div class="value" id="modalTibDisplay">24 mo</div>
            <input type="range" class="slider" id="modalTimeInBusiness" min="3" max="120" step="1" value="24" oninput="syncSlider('timeInBusiness', this.value)">
          </div>
          
          <!-- NSF -->
          <div class="slider-cell">
            <label>NSF / Overdrafts <span style="font-weight: 400; opacity: 0.6;">(90 Days)</span></label>
            <div class="value" id="modalNsfDisplay">2</div>
            <input type="range" class="slider" id="modalNsfCount" min="0" max="15" step="1" value="2" oninput="syncSlider('nsfCount', this.value)">
          </div>
          
          <!-- Negative Days -->
          <div class="slider-cell">
            <label>Negative Days <span style="font-weight: 400; opacity: 0.6;">(90 Days)</span></label>
            <div class="value" id="modalNegDaysDisplay">1 days</div>
            <input type="range" class="slider" id="modalNegativeDays" min="0" max="30" step="1" value="1" oninput="syncSlider('negativeDays', this.value)">
          </div>
        </div>
        
        <!-- Existing Debt - Full Width -->
        <div class="slider-cell" style="margin-bottom: 8px;">
          <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 4px;">
            <label style="margin-bottom: 0;">Existing Debt Payments</label>
            <div style="display: flex; align-items: center; gap: 4px;">
              <span style="font-size: 9px; color: var(--text-muted);">paid</span>
              <select id="modalExistingDebtFreqSelect" onchange="syncExistingDebtFreq(this.value)" style="font-size: 9px; padding: 2px 4px; background: var(--bg-primary); color: var(--text-muted); border: 1px solid var(--border-secondary); border-radius: 4px;">
                <option value="daily">daily</option>
                <option value="weekly">weekly</option>
                <option value="monthly">monthly</option>
              </select>
            </div>
          </div>
          <div class="value" id="modalExistingDebtDisplay">$0/day</div>
          <input type="range" class="slider" id="modalExistingDebt" min="0" max="15000" step="50" value="0" oninput="syncSlider('existingDebt', this.value)">
          <!-- Hidden radios for compatibility -->
          <div style="display: none;">
            <input type="radio" name="modalExistingDebtFreq" value="daily" checked>
            <input type="radio" name="modalExistingDebtFreq" value="weekly">
            <input type="radio" name="modalExistingDebtFreq" value="monthly">
          </div>
        </div>
        
        <!-- Industry Dropdown -->
        <div class="slider-cell" style="margin-bottom: 8px;">
          <label>Industry</label>
          <select id="modalIndustrySelect" onchange="syncIndustry(this.value)" class="w-full px-2 py-1.5 rounded-lg text-xs font-semibold" style="background: var(--bg-primary); color: var(--text-primary); border: 1px solid var(--border-secondary);">
            <optgroup label="Standard Industries">
              <option value="retail">Retail / E-commerce</option>
              <option value="restaurant">Restaurant / Food Service</option>
              <option value="construction">Construction / Contracting</option>
              <option value="auto">Auto Repair / Dealer</option>
              <option value="medical">Medical / Healthcare</option>
              <option value="professional">Professional Services</option>
              <option value="manufacturing">Manufacturing</option>
              <option value="wholesale">Wholesale / Distribution</option>
              <option value="beauty">Beauty / Salon / Spa</option>
              <option value="fitness">Fitness / Gym</option>
              <option value="other">Other (Standard)</option>
            </optgroup>
            <optgroup label="Restricted (Fleet Size Required)">
              <option value="trucking">Trucking / Transportation</option>
            </optgroup>
            <optgroup label="Prohibited Industries">
              <option value="gambling">Gambling / Casino</option>
              <option value="adult">Adult Entertainment</option>
              <option value="cannabis">Cannabis / CBD</option>
              <option value="firearms">Firearms / Weapons</option>
              <option value="crypto">Cryptocurrency</option>
              <option value="collection">Debt Collection</option>
              <option value="telemarketing">Telemarketing</option>
              <option value="pawn">Pawn Shop</option>
            </optgroup>
          </select>
          <!-- Modal Fleet Size (hidden by default) -->
          <div id="modalTruckingFleetSection" style="display: none; margin-top: 6px;">
            <select id="modalFleetSize" onchange="syncFleetSize(this.value)" class="w-full px-2 py-1 rounded-lg text-xs font-semibold" style="background: var(--bg-primary); color: var(--text-primary); border: 1px solid var(--border-secondary);">
              <option value="1">1 vehicle</option>
              <option value="2">2 vehicles</option>
              <option value="3">3 vehicles</option>
              <option value="4">4 vehicles</option>
              <option value="5">5 vehicles</option>
              <option value="6">6-10 vehicles</option>
              <option value="11">11-20 vehicles</option>
              <option value="21">21+ vehicles</option>
            </select>
          </div>
        </div>
      </div>
      
      <!-- MODEL OVERRIDE Sliders (Terms) -->
      <div id="modalOverrideContent" style="display: none;">
        <!-- Score Meter for Override -->
        <div class="modal-score-meter">
          <div class="modal-score-header">
            <div class="modal-score-info">
              <div class="modal-tier-badge" id="modalOverrideTierBadge" style="border-color: #eab308;">
                <div class="modal-tier-letter" id="modalOverrideTierLetter" style="color: #eab308;">C</div>
                <div class="modal-tier-label" id="modalOverrideTierLabel">Mid-Prime</div>
              </div>
              <div class="modal-score-text">
                <div class="modal-score-label">AblesAI Score</div>
                <div class="modal-score-value">
                  <span class="modal-score-number" id="modalOverrideScoreNumber">62</span>
                  <span class="modal-score-max">/100</span>
                </div>
              </div>
            </div>
            <div class="modal-score-bar-container">
              <div class="modal-score-bar">
                <div class="modal-score-bar-fill" id="modalOverrideScoreBarFill" style="width: 100%;"></div>
                <div class="modal-score-bar-marker" id="modalOverrideScoreMarker" style="left: 62%;"></div>
              </div>
              <div class="modal-score-scale">
                <span style="color: #ef4444;">E <span style="opacity:0.6">0</span></span>
                <span style="color: #f97316;">D <span style="opacity:0.6">35</span></span>
                <span style="color: #eab308;">C <span style="opacity:0.6">50</span></span>
                <span style="color: #22c55e;">B <span style="opacity:0.6">65</span></span>
                <span style="color: #10b981;">A <span style="opacity:0.6">80+</span></span>
              </div>
            </div>
          </div>
          
          <!-- Risk Metrics Row - Compact inline -->
          <div class="modal-risk-metrics-inline">
            <div class="modal-pd-inline">
              <div class="modal-pd-gauge-small">
                <svg width="60" height="36" viewBox="0 0 180 100">
                  <path class="gauge-arc gauge-bg" d="M 20 80 A 60 60 0 0 1 160 80" />
                  <path class="gauge-arc gauge-fill" id="modalPdGaugeFill" d="M 20 80 A 60 60 0 0 1 160 80" 
                    stroke="#10b981" stroke-dasharray="0 188" />
                </svg>
              </div>
              <div class="modal-pd-info">
                <span class="modal-pd-number" id="modalPdValue">8.2%</span>
                <span class="modal-pd-text">Est. PD</span>
              </div>
            </div>
            <div class="modal-dscr-inline">
              <div class="modal-dscr-mini-bar">
                <div class="modal-dscr-mini-fill" id="modalDscrFill" style="width: 62%; background: #10b981;">
                  <span id="modalDscrBarValue">1.85x</span>
                </div>
              </div>
              <div class="modal-dscr-info">
                <span class="modal-dscr-number" id="modalDscrRatio">1.85x</span>
                <span class="modal-dscr-text">DSCR</span>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Calculated Terms (from model) -->
        <div class="modal-offer-terms">
          <div class="modal-section-label">Model Calculated Terms</div>
          <div class="sliders-grid">
            <div class="slider-cell offer-term-cell">
              <label>Funding Amount</label>
              <div class="value" id="modalOverrideCalcFunding">$17,500</div>
            </div>
            <div class="slider-cell offer-term-cell">
              <label>Factor Rate</label>
              <div class="value" id="modalOverrideCalcFactor">1.32x</div>
            </div>
            <div class="slider-cell offer-term-cell">
              <label>Term Length</label>
              <div class="value" id="modalOverrideCalcTerm">9 mo</div>
            </div>
          </div>
        </div>
        
        <!-- Override Sliders with Variance -->
        <div class="modal-override-section">
          <div class="modal-section-label" style="color: var(--text-muted);">Override Terms</div>
          <div class="sliders-grid override-grid">
            <!-- Funding Amount -->
            <div class="slider-cell override-slider-cell">
              <label>Funding Amount</label>
              <div class="override-value-row">
                <div class="value" id="modalOverrideFundingDisplay">$17,500</div>
                <div class="variance-badge" id="modalFundingVariance">+$0</div>
              </div>
              <input type="range" class="slider" id="modalOverrideFunding" min="5000" max="100000" step="1" value="17500" oninput="syncOverrideSlider('overrideFunding', this.value)">
            </div>
            
            <!-- Factor Rate -->
            <div class="slider-cell override-slider-cell">
              <label>Factor Rate</label>
              <div class="override-value-row">
                <div class="value" id="modalOverrideFactorDisplay">1.32x</div>
                <div class="variance-badge" id="modalFactorVariance">+0.00</div>
              </div>
              <input type="range" class="slider" id="modalOverrideFactor" min="1.15" max="1.55" step="0.01" value="1.32" oninput="syncOverrideSlider('overrideFactor', this.value)">
            </div>
            
            <!-- Term -->
            <div class="slider-cell override-slider-cell">
              <label>Term Length</label>
              <div class="override-value-row">
                <div class="value" id="modalOverrideTermDisplay">9 Months</div>
                <div class="variance-badge" id="modalTermVariance">+0 mo</div>
              </div>
              <input type="range" class="slider" id="modalOverrideTerm" min="3" max="15" step="1" value="9" oninput="syncOverrideSlider('overrideTerm', this.value)">
            </div>
          </div>
        </div>
        
        <!-- Payment Frequency for Override -->
        <div class="toggle-section" style="margin-top: 12px;">
          <label>Payment Frequency</label>
          <div class="freq-toggle-group">
            <label class="freq-toggle">
              <input type="radio" name="modalOverridePaymentFreq" value="daily" checked onchange="syncOverrideRadio('overridePaymentFreq', 'daily')">
              <span class="freq-toggle-btn">Daily</span>
            </label>
            <label class="freq-toggle">
              <input type="radio" name="modalOverridePaymentFreq" value="weekly" onchange="syncOverrideRadio('overridePaymentFreq', 'weekly')">
              <span class="freq-toggle-btn">Weekly</span>
            </label>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Settings Modal -->
  <div class="settings-overlay" id="settingsOverlay" onclick="if(event.target === this) closeSettings()">
    <div class="settings-modal">
      <div class="settings-header">
        <h2>Settings</h2>
        <button class="settings-close" onclick="closeSettings()">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <div class="settings-body">
        <!-- Appearance Section -->
        <div class="settings-section">
          <div class="settings-section-title">Appearance</div>
          <div class="settings-row">
            <div>
              <div class="settings-row-label">Light Theme</div>
              <div class="settings-row-desc">Switch to light mode for better visibility</div>
            </div>
            <div class="toggle-switch" id="themeToggle" onclick="toggleTheme()"></div>
          </div>
        </div>

        <!-- Credit Model Adjustments Section -->
        <div class="settings-section">
          <div class="settings-section-title">Credit Model Adjustments</div>
          
          <div class="model-slider-row">
            <div class="model-slider-header">
              <span class="model-slider-label">Revenue Weight</span>
              <span class="model-slider-value" id="revenueWeightValue">30%</span>
            </div>
            <div class="model-slider-desc">Impact of monthly revenue on score calculation</div>
            <input type="range" class="model-slider-input" id="revenueWeightSlider" min="10" max="50" value="30" oninput="updateModelWeights()">
          </div>

          <div class="model-slider-row">
            <div class="model-slider-header">
              <span class="model-slider-label">Time in Business Weight</span>
              <span class="model-slider-value" id="tibWeightValue">20%</span>
            </div>
            <div class="model-slider-desc">Impact of business age on score calculation</div>
            <input type="range" class="model-slider-input" id="tibWeightSlider" min="5" max="35" value="20" oninput="updateModelWeights()">
          </div>

          <div class="model-slider-row">
            <div class="model-slider-header">
              <span class="model-slider-label">Industry Risk Weight</span>
              <span class="model-slider-value" id="industryWeightValue">15%</span>
            </div>
            <div class="model-slider-desc">Impact of industry classification on score</div>
            <input type="range" class="model-slider-input" id="industryWeightSlider" min="5" max="30" value="15" oninput="updateModelWeights()">
          </div>

          <div class="model-slider-row">
            <div class="model-slider-header">
              <span class="model-slider-label">Credit Score Weight</span>
              <span class="model-slider-value" id="creditWeightValue">20%</span>
            </div>
            <div class="model-slider-desc">Impact of personal credit on score calculation</div>
            <input type="range" class="model-slider-input" id="creditWeightSlider" min="5" max="35" value="20" oninput="updateModelWeights()">
          </div>

          <div class="model-slider-row">
            <div class="model-slider-header">
              <span class="model-slider-label">Negative Days Weight</span>
              <span class="model-slider-value" id="negDaysWeightValue">15%</span>
            </div>
            <div class="model-slider-desc">Impact of negative balance days on score</div>
            <input type="range" class="model-slider-input" id="negDaysWeightSlider" min="5" max="30" value="15" oninput="updateModelWeights()">
          </div>

          <div class="model-slider-row">
            <div class="model-slider-header">
              <span class="model-slider-label">Base PD Multiplier</span>
              <span class="model-slider-value" id="pdMultiplierValue">1.0x</span>
            </div>
            <div class="model-slider-desc">Adjust base probability of default calculation</div>
            <input type="range" class="model-slider-input" id="pdMultiplierSlider" min="50" max="150" value="100" oninput="updateModelWeights()">
          </div>

          <div class="model-slider-row">
            <div class="model-slider-header">
              <span class="model-slider-label">Max Funding % of Revenue</span>
              <span class="model-slider-value" id="maxFundingPctValue">150%</span>
            </div>
            <div class="model-slider-desc">Maximum funding as percentage of monthly revenue</div>
            <input type="range" class="model-slider-input" id="maxFundingPctSlider" min="50" max="250" value="150" oninput="updateModelWeights()">
          </div>

          <div class="model-slider-row">
            <div class="model-slider-header">
              <span class="model-slider-label">Factor Rate Spread</span>
              <span class="model-slider-value" id="factorSpreadValue">0.20</span>
            </div>
            <div class="model-slider-desc">Range between min and max factor rates per tier</div>
            <input type="range" class="model-slider-input" id="factorSpreadSlider" min="10" max="40" value="20" oninput="updateModelWeights()">
          </div>

          <button class="settings-reset-btn" onclick="resetModelWeights()">Reset to Defaults</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ============================================
    // TIER SYSTEM
    // ============================================
    
    const TIER_COLORS = {
      A: { main: '#10b981', rgb: '16, 185, 129', label: 'Prime' },
      B: { main: '#22c55e', rgb: '34, 197, 94', label: 'Near-Prime' },
      C: { main: '#eab308', rgb: '234, 179, 8', label: 'Mid-Prime' },
      D: { main: '#f97316', rgb: '249, 115, 22', label: 'Sub-Prime' },
      E: { main: '#ef4444', rgb: '239, 68, 68', label: 'High-Risk' }
    };

    const TIER_DATA = {
      A: { factor: 1.18, multiplier: 1.40, termMonths: 12 },
      B: { factor: 1.24, multiplier: 1.00, termMonths: 10 },
      C: { factor: 1.32, multiplier: 0.65, termMonths: 9 },
      D: { factor: 1.38, multiplier: 0.50, termMonths: 6 },
      E: { factor: 1.45, multiplier: 0.40, termMonths: 4 }
    };

    // ============================================
    // MODEL WEIGHTS (adjustable via settings)
    // ============================================
    const MODEL_WEIGHTS = {
      revenue: 30,
      tib: 20,
      industry: 15,
      credit: 20,
      negDays: 15,
      pdMultiplier: 100,
      maxFundingPct: 150,
      factorSpread: 20
    };

    const DEFAULT_WEIGHTS = { ...MODEL_WEIGHTS };

    // ============================================
    // SETTINGS FUNCTIONS
    // ============================================
    function openSettings() {
      document.getElementById('settingsOverlay').classList.add('active');
      loadSettingsValues();
    }

    function closeSettings() {
      document.getElementById('settingsOverlay').classList.remove('active');
    }

    function toggleTheme() {
      const toggle = document.getElementById('themeToggle');
      const isLight = document.body.classList.toggle('light-theme');
      toggle.classList.toggle('active', isLight);
      localStorage.setItem('theme', isLight ? 'light' : 'dark');
    }

    function loadSettingsValues() {
      document.getElementById('revenueWeightSlider').value = MODEL_WEIGHTS.revenue;
      document.getElementById('revenueWeightValue').textContent = MODEL_WEIGHTS.revenue + '%';
      
      document.getElementById('tibWeightSlider').value = MODEL_WEIGHTS.tib;
      document.getElementById('tibWeightValue').textContent = MODEL_WEIGHTS.tib + '%';
      
      document.getElementById('industryWeightSlider').value = MODEL_WEIGHTS.industry;
      document.getElementById('industryWeightValue').textContent = MODEL_WEIGHTS.industry + '%';
      
      document.getElementById('creditWeightSlider').value = MODEL_WEIGHTS.credit;
      document.getElementById('creditWeightValue').textContent = MODEL_WEIGHTS.credit + '%';
      
      document.getElementById('negDaysWeightSlider').value = MODEL_WEIGHTS.negDays;
      document.getElementById('negDaysWeightValue').textContent = MODEL_WEIGHTS.negDays + '%';
      
      document.getElementById('pdMultiplierSlider').value = MODEL_WEIGHTS.pdMultiplier;
      document.getElementById('pdMultiplierValue').textContent = (MODEL_WEIGHTS.pdMultiplier / 100).toFixed(1) + 'x';
      
      document.getElementById('maxFundingPctSlider').value = MODEL_WEIGHTS.maxFundingPct;
      document.getElementById('maxFundingPctValue').textContent = MODEL_WEIGHTS.maxFundingPct + '%';
      
      document.getElementById('factorSpreadSlider').value = MODEL_WEIGHTS.factorSpread;
      document.getElementById('factorSpreadValue').textContent = (MODEL_WEIGHTS.factorSpread / 100).toFixed(2);
    }

    function updateModelWeights() {
      MODEL_WEIGHTS.revenue = parseInt(document.getElementById('revenueWeightSlider').value);
      MODEL_WEIGHTS.tib = parseInt(document.getElementById('tibWeightSlider').value);
      MODEL_WEIGHTS.industry = parseInt(document.getElementById('industryWeightSlider').value);
      MODEL_WEIGHTS.credit = parseInt(document.getElementById('creditWeightSlider').value);
      MODEL_WEIGHTS.negDays = parseInt(document.getElementById('negDaysWeightSlider').value);
      MODEL_WEIGHTS.pdMultiplier = parseInt(document.getElementById('pdMultiplierSlider').value);
      MODEL_WEIGHTS.maxFundingPct = parseInt(document.getElementById('maxFundingPctSlider').value);
      MODEL_WEIGHTS.factorSpread = parseInt(document.getElementById('factorSpreadSlider').value);

      // Update display values
      document.getElementById('revenueWeightValue').textContent = MODEL_WEIGHTS.revenue + '%';
      document.getElementById('tibWeightValue').textContent = MODEL_WEIGHTS.tib + '%';
      document.getElementById('industryWeightValue').textContent = MODEL_WEIGHTS.industry + '%';
      document.getElementById('creditWeightValue').textContent = MODEL_WEIGHTS.credit + '%';
      document.getElementById('negDaysWeightValue').textContent = MODEL_WEIGHTS.negDays + '%';
      document.getElementById('pdMultiplierValue').textContent = (MODEL_WEIGHTS.pdMultiplier / 100).toFixed(1) + 'x';
      document.getElementById('maxFundingPctValue').textContent = MODEL_WEIGHTS.maxFundingPct + '%';
      document.getElementById('factorSpreadValue').textContent = (MODEL_WEIGHTS.factorSpread / 100).toFixed(2);

      // Save to localStorage
      localStorage.setItem('modelWeights', JSON.stringify(MODEL_WEIGHTS));

      // Recalculate with new weights
      if (typeof calculate === 'function') {
        calculate();
      }
    }

    function resetModelWeights() {
      Object.assign(MODEL_WEIGHTS, DEFAULT_WEIGHTS);
      loadSettingsValues();
      localStorage.removeItem('modelWeights');
      if (typeof calculate === 'function') {
        calculate();
      }
    }

    // Load saved settings on page load
    function loadSavedSettings() {
      // Load theme
      const savedTheme = localStorage.getItem('theme');
      if (savedTheme === 'light') {
        document.body.classList.add('light-theme');
        document.getElementById('themeToggle').classList.add('active');
      }

      // Load model weights
      const savedWeights = localStorage.getItem('modelWeights');
      if (savedWeights) {
        try {
          Object.assign(MODEL_WEIGHTS, JSON.parse(savedWeights));
        } catch (e) {
          console.error('Error loading model weights:', e);
        }
      }
    }

    function getBarColor(pct) {
      if (pct >= 75) return '#10b981';
      if (pct >= 50) return '#eab308';
      return '#ef4444';
    }

    function getTier(score) {
      if (score >= 80) return 'A';
      if (score >= 65) return 'B';
      if (score >= 50) return 'C';
      if (score >= 35) return 'D';
      return 'E';
    }

    function formatCurrency(val) {
      return '$' + Math.round(val).toLocaleString();
    }

    // Update indicator box styling based on color
    function updateIndicatorBox(elementId, color) {
      const el = document.getElementById(elementId);
      if (!el) return;
      const box = el.parentElement;
      const colorMap = {
        '#ef4444': { bg: 'rgba(239, 68, 68, 0.15)', border: 'rgba(239, 68, 68, 0.3)' },
        '#f97316': { bg: 'rgba(249, 115, 22, 0.15)', border: 'rgba(249, 115, 22, 0.3)' },
        '#eab308': { bg: 'rgba(234, 179, 8, 0.15)', border: 'rgba(234, 179, 8, 0.3)' },
        '#22c55e': { bg: 'rgba(34, 197, 94, 0.15)', border: 'rgba(34, 197, 94, 0.3)' },
        '#10b981': { bg: 'rgba(16, 185, 129, 0.15)', border: 'rgba(16, 185, 129, 0.3)' }
      };
      const colors = colorMap[color] || colorMap['#eab308'];
      box.style.background = colors.bg;
      box.style.borderColor = colors.border;
      const label = box.querySelector('div:last-child');
      if (label) label.style.color = color;
    }

    // Mobile panel toggle
    function togglePanel(panelId) {
      const panel = document.getElementById(panelId);
      if (panel) {
        panel.classList.toggle('collapsed');
      }
    }

    // ============================================
    // SLIDER MODAL (Mobile)
    // ============================================
    let currentModalMode = 'calc'; // 'calc' or 'override'
    
    function openSliderModal() {
      // Detect which tab is active by checking the tab panel
      const overridePanel = document.getElementById('tab-override');
      const isOverrideActive = overridePanel && overridePanel.classList.contains('active');
      
      currentModalMode = isOverrideActive ? 'override' : 'calc';
      
      // Update modal title and content visibility
      const modalTitle = document.getElementById('modalTitle');
      const calcContent = document.getElementById('modalCalcContent');
      const overrideContent = document.getElementById('modalOverrideContent');
      
      if (currentModalMode === 'override') {
        modalTitle.textContent = 'Adjust Offer Terms';
        calcContent.style.display = 'none';
        overrideContent.style.display = 'block';
        syncOverrideModalFromMain();
      } else {
        modalTitle.textContent = 'Input Parameters';
        calcContent.style.display = 'block';
        overrideContent.style.display = 'none';
        syncModalFromMain();
      }
      
      document.getElementById('sliderModalOverlay').classList.add('active');
      document.getElementById('sliderFab').classList.add('hidden');
      document.body.style.overflow = 'hidden';
    }
    
    function closeSliderModal(event) {
      if (event && event.target !== event.currentTarget) return;
      document.getElementById('sliderModalOverlay').classList.remove('active');
      document.getElementById('sliderFab').classList.remove('hidden');
      document.body.style.overflow = '';
    }
    
    // Sync override modal sliders from main override sliders
    function syncOverrideModalFromMain() {
      const funding = document.getElementById('overrideFunding').value;
      const factor = document.getElementById('overrideFactor').value;
      const term = document.getElementById('overrideTerm').value;
      
      document.getElementById('modalOverrideFunding').value = funding;
      document.getElementById('modalOverrideFactor').value = factor;
      document.getElementById('modalOverrideTerm').value = term;
      
      document.getElementById('modalOverrideFundingDisplay').textContent = formatCurrency(parseInt(funding));
      document.getElementById('modalOverrideFactorDisplay').textContent = parseFloat(factor).toFixed(2) + 'x';
      document.getElementById('modalOverrideTermDisplay').textContent = term + ' Months';
      
      // Sync payment frequency
      const selectedFreq = document.querySelector('input[name="overridePaymentFreq"]:checked');
      if (selectedFreq) {
        const modalFreq = document.querySelector('input[name="modalOverridePaymentFreq"][value="' + selectedFreq.value + '"]');
        if (modalFreq) modalFreq.checked = true;
      }
      
      // Update override score meter
      updateModalOverrideScoreMeter();
      
      // Update calculated terms and variances
      updateModalDisplays();
    }
    
    function updateModalOverrideScoreMeter() {
      if (!window.calcOffer) return;
      
      const score = window.calcOffer.score || 0;
      const tier = window.calcOffer.tier || 'E';
      const tierColors = window.calcOffer.tierColors || { main: '#ef4444' };
      
      const tierLabels = {
        'A': 'Prime',
        'B': 'Near-Prime', 
        'C': 'Mid-Prime',
        'D': 'Sub-Prime',
        'E': 'Deep Sub'
      };
      
      const scoreEl = document.getElementById('modalOverrideScoreNumber');
      const tierEl = document.getElementById('modalOverrideTierLetter');
      const labelEl = document.getElementById('modalOverrideTierLabel');
      const markerEl = document.getElementById('modalOverrideScoreMarker');
      const badgeEl = document.getElementById('modalOverrideTierBadge');
      
      if (scoreEl) scoreEl.textContent = score;
      if (tierEl) {
        tierEl.textContent = tier;
        tierEl.style.color = tierColors.main;
      }
      if (labelEl) labelEl.textContent = tierLabels[tier] || 'Unknown';
      if (markerEl) markerEl.style.left = score + '%';
      if (badgeEl) badgeEl.style.borderColor = tierColors.main;
      
      // Update risk metrics
      updateModalRiskMetrics();
    }
    
    function updateModalRiskMetrics() {
      if (!window.calcOffer) return;
      
      const calc = window.calcOffer;
      const el = (id) => document.getElementById(id);
      
      // Get override values from modal or main sliders
      const overrideFunding = parseInt(el('overrideFunding')?.value) || calc.funding;
      const overrideFactor = parseFloat(el('overrideFactor')?.value) || calc.factor;
      const overrideTerm = parseInt(el('overrideTerm')?.value) || calc.term;
      
      const payback = overrideFunding * overrideFactor;
      
      // Calculate PD
      const tierPD = { A: 3, B: 6, C: 10, D: 18, E: 28 };
      let basePD = tierPD[calc.tier] || 10;
      
      const fundingRatio = overrideFunding / calc.funding;
      const factorRatio = overrideFactor / calc.factor;
      const termRatio = overrideTerm / calc.term;
      
      let pdAdjustment = 0;
      pdAdjustment += (fundingRatio - 1) * 15;
      pdAdjustment -= (factorRatio - 1) * 8;
      pdAdjustment += (termRatio - 1) * 5;
      
      const estimatedPD = Math.max(1, Math.min(40, basePD + pdAdjustment));
      
      // Update modal PD gauge
      if (el('modalPdValue')) el('modalPdValue').textContent = estimatedPD.toFixed(1) + '%';
      
      const pdPct = estimatedPD / 40;
      const arcLength = 188 * pdPct;
      if (el('modalPdGaugeFill')) el('modalPdGaugeFill').setAttribute('stroke-dasharray', `${arcLength} 188`);
      
      let pdColor = '#10b981';
      if (estimatedPD > 25) pdColor = '#ef4444';
      else if (estimatedPD > 15) pdColor = '#f97316';
      else if (estimatedPD > 5) pdColor = '#eab308';
      if (el('modalPdGaugeFill')) el('modalPdGaugeFill').setAttribute('stroke', pdColor);
      
      // Calculate DSCR (including existing debt)
      const monthlyDebt = payback / overrideTerm;
      const existingDebt = parseInt(document.getElementById('existingDebt')?.value) || 0;
      const totalMonthlyDebt = monthlyDebt + existingDebt;
      const dscr = calc.revenue / totalMonthlyDebt;
      
      if (el('modalDscrRevenue')) el('modalDscrRevenue').textContent = formatCurrency(calc.revenue);
      if (el('modalDscrDebt')) el('modalDscrDebt').textContent = formatCurrency(Math.round(totalMonthlyDebt)) + (existingDebt > 0 ? ' (incl. existing)' : '');
      if (el('modalDscrRatio')) el('modalDscrRatio').textContent = dscr.toFixed(2) + 'x';
      if (el('modalDscrBarValue')) el('modalDscrBarValue').textContent = dscr.toFixed(2) + 'x';
      
      const dscrPct = Math.min(100, (dscr / 3) * 100);
      if (el('modalDscrFill')) el('modalDscrFill').style.width = dscrPct + '%';
      
      let dscrColor = '#ef4444';
      if (dscr >= 2) dscrColor = '#10b981';
      else if (dscr >= 1.5) dscrColor = '#22c55e';
      else if (dscr >= 1.25) dscrColor = '#eab308';
      else if (dscr >= 1) dscrColor = '#f97316';
      
      if (el('modalDscrFill')) el('modalDscrFill').style.background = dscrColor;
      if (el('modalDscrRatio')) el('modalDscrRatio').style.color = dscrColor;
      
      // DSCR warning
      const dscrWarning = el('modalDscrWarning');
      if (dscrWarning) {
        if (dscr < 1) {
          dscrWarning.style.display = 'block';
          dscrWarning.style.background = 'rgba(239, 68, 68, 0.1)';
          dscrWarning.style.color = '#ef4444';
          dscrWarning.innerHTML = '<strong>Warning:</strong> DSCR below 1.0x';
        } else if (dscr < 1.25) {
          dscrWarning.style.display = 'block';
          dscrWarning.style.background = 'rgba(249, 115, 22, 0.1)';
          dscrWarning.style.color = '#f97316';
          dscrWarning.innerHTML = '<strong>Caution:</strong> Tight debt coverage';
        } else if (dscr >= 2) {
          dscrWarning.style.display = 'block';
          dscrWarning.style.background = 'rgba(16, 185, 129, 0.1)';
          dscrWarning.style.color = '#10b981';
          dscrWarning.innerHTML = '<strong>Healthy:</strong> Excellent coverage';
        } else {
          dscrWarning.style.display = 'none';
        }
      }
    }
    
    // Sync override slider from modal to main
    function syncOverrideSlider(mainId, value) {
      const mainSlider = document.getElementById(mainId);
      if (mainSlider) {
        mainSlider.value = value;
        calculateOverride();
        
        // Update modal display
        if (mainId === 'overrideFunding') {
          document.getElementById('modalOverrideFundingDisplay').textContent = formatCurrency(parseInt(value));
        } else if (mainId === 'overrideFactor') {
          document.getElementById('modalOverrideFactorDisplay').textContent = parseFloat(value).toFixed(2) + 'x';
        } else if (mainId === 'overrideTerm') {
          document.getElementById('modalOverrideTermDisplay').textContent = value + ' Months';
        }
        
        // Update variance badges and risk metrics
        updateModalOverrideVariances();
        updateModalRiskMetrics();
      }
    }
    
    // Sync override radio from modal to main
    function syncOverrideRadio(name, value) {
      const mainRadio = document.querySelector('input[name="' + name + '"][value="' + value + '"]');
      if (mainRadio) {
        mainRadio.checked = true;
        calculateOverride();
      }
    }
    
    function syncModalFromMain() {
      // Sync slider values
      const mainModal = {
        'monthlyRevenue': 'modalMonthlyRevenue',
        'avgDailyBalance': 'modalAvgDailyBalance',
        'creditScore': 'modalCreditScore',
        'timeInBusiness': 'modalTimeInBusiness',
        'nsfCount': 'modalNsfCount',
        'negativeDays': 'modalNegativeDays',
        'existingDebt': 'modalExistingDebt'
      };
      
      Object.entries(mainModal).forEach(([mainId, modalId]) => {
        const main = document.getElementById(mainId);
        const modal = document.getElementById(modalId);
        if (main && modal) {
          modal.value = main.value;
        }
      });
      
      // Sync existing debt frequency (dropdown + hidden radios)
      const debtFreqVal = document.querySelector('input[name="existingDebtFreq"]:checked')?.value || 'daily';
      const modalDebtFreq = document.querySelector(`input[name="modalExistingDebtFreq"][value="${debtFreqVal}"]`);
      if (modalDebtFreq) modalDebtFreq.checked = true;
      const modalDebtFreqSelect = document.getElementById('modalExistingDebtFreqSelect');
      if (modalDebtFreqSelect) modalDebtFreqSelect.value = debtFreqVal;
      
      // Sync industry dropdown
      const industryVal = document.getElementById('industrySelect')?.value || 'retail';
      const modalIndustry = document.getElementById('modalIndustrySelect');
      if (modalIndustry) modalIndustry.value = industryVal;
      
      // Sync fleet size and visibility for trucking
      const fleetVal = document.getElementById('fleetSize')?.value || '1';
      const modalFleet = document.getElementById('modalFleetSize');
      if (modalFleet) modalFleet.value = fleetVal;
      
      // Show/hide trucking sections
      const isTrucking = industryVal === 'trucking';
      const truckingSection = document.getElementById('truckingFleetSection');
      const modalTruckingSection = document.getElementById('modalTruckingFleetSection');
      if (truckingSection) truckingSection.style.display = isTrucking ? 'block' : 'none';
      if (modalTruckingSection) modalTruckingSection.style.display = isTrucking ? 'block' : 'none';
      
      // Update displays
      updateModalDisplays();
      updateModalScoreMeter();
    }
    
    function updateModalScoreMeter() {
      if (!window.calcOffer) return;
      
      const score = window.calcOffer.score || 0;
      const tier = window.calcOffer.tier || 'E';
      const tierColors = window.calcOffer.tierColors || { main: '#ef4444' };
      
      const tierLabels = {
        'A': 'Prime',
        'B': 'Near-Prime', 
        'C': 'Mid-Prime',
        'D': 'Sub-Prime',
        'E': 'Deep Sub'
      };
      
      const scoreEl = document.getElementById('modalScoreNumber');
      const tierEl = document.getElementById('modalTierLetter');
      const labelEl = document.getElementById('modalTierLabel');
      const markerEl = document.getElementById('modalScoreMarker');
      const badgeEl = document.getElementById('modalTierBadge');
      
      if (scoreEl) scoreEl.textContent = score;
      if (tierEl) {
        tierEl.textContent = tier;
        tierEl.style.color = tierColors.main;
      }
      if (labelEl) labelEl.textContent = tierLabels[tier] || 'Unknown';
      if (markerEl) markerEl.style.left = score + '%';
      if (badgeEl) badgeEl.style.borderColor = tierColors.main;
    }
    
    function syncSlider(mainId, value) {
      const main = document.getElementById(mainId);
      if (main) {
        main.value = value;
        calculate();
        updateModalDisplays();
        updateModalScoreMeter();
      }
    }
    
    function syncRadio(name, value) {
      const main = document.querySelector(`input[name="${name}"][value="${value}"]`);
      if (main) {
        main.checked = true;
        calculate();
        updateModalScoreMeter();
      }
    }
    
    function syncIndustry(value) {
      const main = document.getElementById('industrySelect');
      if (main) {
        main.value = value;
        // Trigger industry change handler for trucking fleet visibility
        handleIndustryChange();
        updateModalScoreMeter();
      }
    }
    
    function updateExistingDebtFreq() {
      const select = document.getElementById('existingDebtFreqSelect');
      const value = select ? select.value : 'daily';
      // Sync hidden radio buttons
      const radio = document.querySelector(`input[name="existingDebtFreq"][value="${value}"]`);
      if (radio) radio.checked = true;
      // Sync modal radio
      const modalRadio = document.querySelector(`input[name="modalExistingDebtFreq"][value="${value}"]`);
      if (modalRadio) modalRadio.checked = true;
      // Sync modal dropdown
      const modalSelect = document.getElementById('modalExistingDebtFreqSelect');
      if (modalSelect) modalSelect.value = value;
      // Update label
      const freqLabels = { daily: '/day', weekly: '/week', monthly: '/month' };
      const label = document.getElementById('existingDebtFreqLabel');
      if (label) label.textContent = freqLabels[value];
      calculate();
    }
    
    function syncExistingDebtFreq(value) {
      // Sync main dropdown
      const mainSelect = document.getElementById('existingDebtFreqSelect');
      if (mainSelect) mainSelect.value = value;
      // Sync all radios
      const radio = document.querySelector(`input[name="existingDebtFreq"][value="${value}"]`);
      if (radio) radio.checked = true;
      const modalRadio = document.querySelector(`input[name="modalExistingDebtFreq"][value="${value}"]`);
      if (modalRadio) modalRadio.checked = true;
      // Update label
      const freqLabels = { daily: '/day', weekly: '/week', monthly: '/month' };
      const label = document.getElementById('existingDebtFreqLabel');
      if (label) label.textContent = freqLabels[value];
      calculate();
    }
    
    function updateModalDisplays() {
      const revenue = parseInt(document.getElementById('monthlyRevenue').value) || 0;
      const balance = parseInt(document.getElementById('avgDailyBalance').value) || 0;
      const credit = parseInt(document.getElementById('creditScore').value) || 0;
      const tib = parseInt(document.getElementById('timeInBusiness').value) || 0;
      const nsf = parseInt(document.getElementById('nsfCount').value) || 0;
      const negDays = parseInt(document.getElementById('negativeDays').value) || 0;
      const existingDebtRaw = parseInt(document.getElementById('existingDebt').value) || 0;
      const existingDebtFreq = document.querySelector('input[name="existingDebtFreq"]:checked')?.value || 'daily';
      
      const debtFreqLabels = { daily: '/day', weekly: '/wk', monthly: '/mo' };
      
      const el = (id) => document.getElementById(id);
      if (el('modalRevenueDisplay')) el('modalRevenueDisplay').textContent = formatCurrency(revenue);
      if (el('modalBalanceDisplay')) el('modalBalanceDisplay').textContent = formatCurrency(balance);
      if (el('modalCreditDisplay')) el('modalCreditDisplay').textContent = credit;
      if (el('modalTibDisplay')) el('modalTibDisplay').textContent = tib + ' mo';
      if (el('modalNsfDisplay')) el('modalNsfDisplay').textContent = nsf;
      if (el('modalNegDaysDisplay')) el('modalNegDaysDisplay').textContent = negDays + ' days';
      if (el('modalExistingDebtDisplay')) el('modalExistingDebtDisplay').textContent = formatCurrency(existingDebtRaw) + debtFreqLabels[existingDebtFreq];
      
      // Update offer terms from calcOffer (MODEL SCORE modal)
      if (window.calcOffer) {
        if (el('modalCalcFundingDisplay')) el('modalCalcFundingDisplay').textContent = formatCurrency(window.calcOffer.funding || 0);
        if (el('modalCalcFactorDisplay')) el('modalCalcFactorDisplay').textContent = (window.calcOffer.factor || 1).toFixed(2) + 'x';
        if (el('modalCalcTermDisplay')) el('modalCalcTermDisplay').textContent = (window.calcOffer.term || 0) + ' mo';
        
        // Update MODEL OVERRIDE modal calculated terms
        if (el('modalOverrideCalcFunding')) el('modalOverrideCalcFunding').textContent = formatCurrency(window.calcOffer.funding || 0);
        if (el('modalOverrideCalcFactor')) el('modalOverrideCalcFactor').textContent = (window.calcOffer.factor || 1).toFixed(2) + 'x';
        if (el('modalOverrideCalcTerm')) el('modalOverrideCalcTerm').textContent = (window.calcOffer.term || 0) + ' mo';
      }
      
      // Update override modal variances
      updateModalOverrideVariances();
    }
    
    function updateModalOverrideVariances() {
      if (!window.calcOffer) return;
      
      const el = (id) => document.getElementById(id);
      const calcFunding = window.calcOffer.funding || 0;
      const calcFactor = window.calcOffer.factor || 1;
      const calcTerm = window.calcOffer.term || 0;
      
      const overrideFunding = parseInt(el('overrideFunding')?.value) || calcFunding;
      const overrideFactor = parseFloat(el('overrideFactor')?.value) || calcFactor;
      const overrideTerm = parseInt(el('overrideTerm')?.value) || calcTerm;
      
      // Calculate variances
      const fundingDiff = overrideFunding - calcFunding;
      const factorDiff = overrideFactor - calcFactor;
      const termDiff = overrideTerm - calcTerm;
      
      // Update funding variance badge
      const fundingBadge = el('modalFundingVariance');
      if (fundingBadge) {
        const fundingSign = fundingDiff >= 0 ? '+' : '';
        fundingBadge.textContent = fundingSign + formatCurrency(fundingDiff);
        fundingBadge.className = 'variance-badge' + (fundingDiff > 0 ? ' positive' : fundingDiff < 0 ? ' negative' : '');
      }
      
      // Update factor variance badge
      const factorBadge = el('modalFactorVariance');
      if (factorBadge) {
        const factorSign = factorDiff >= 0 ? '+' : '';
        factorBadge.textContent = factorSign + factorDiff.toFixed(2);
        factorBadge.className = 'variance-badge' + (factorDiff > 0 ? ' positive' : factorDiff < 0 ? ' negative' : '');
      }
      
      // Update term variance badge
      const termBadge = el('modalTermVariance');
      if (termBadge) {
        const termSign = termDiff >= 0 ? '+' : '';
        termBadge.textContent = termSign + termDiff + ' mo';
        termBadge.className = 'variance-badge' + (termDiff > 0 ? ' positive' : termDiff < 0 ? ' negative' : '');
      }
    }

    function recalculateWithConfirm(btn) {
      calculate();
      
      // Get calculated values for verification
      const score = document.getElementById('scoreValueTop').textContent.replace('/100', '');
      const funding = document.getElementById('offerFunding').textContent;
      const payback = document.getElementById('offerPayback').textContent;
      const payment = document.getElementById('offerPayment').textContent;
      
      // Show confirmation message
      const msg = document.getElementById('calcConfirmMsg');
      msg.innerHTML = 'Verified: Score ' + score + ' | ' + funding + ' funding | ' + payback + ' payback | ' + payment + '/day';
      msg.style.opacity = '1';
      
      // Button flash
      const origBg = btn.style.background;
      btn.style.background = '#22c55e';
      btn.textContent = 'Verified';
      
      setTimeout(() => {
        btn.style.background = origBg;
        btn.textContent = 'Recalculate';
      }, 1500);
      
      setTimeout(() => {
        msg.style.opacity = '0';
      }, 4000);
    }
    
    function recalculateOverrideWithConfirm(btn) {
      calculateOverride();
      
      // Get override calculated values for verification
      const funding = document.getElementById('overrideOfferFunding').textContent;
      const payback = document.getElementById('overrideOfferPayback').textContent;
      const payment = document.getElementById('overrideOfferPayment').textContent;
      const factor = document.getElementById('overrideFactorDisplay').textContent;
      
      // Show confirmation message
      const msg = document.getElementById('overrideConfirmMsg');
      msg.innerHTML = 'Verified: ' + funding + ' x ' + factor + ' = ' + payback + ' | ' + payment + '/day';
      msg.style.opacity = '1';
      
      // Button flash
      const origBg = btn.style.background;
      btn.style.background = '#22c55e';
      btn.textContent = 'Verified';
      
      setTimeout(() => {
        btn.style.background = origBg;
        btn.textContent = 'Recalculate';
      }, 1500);
      
      setTimeout(() => {
        msg.style.opacity = '0';
      }, 4000);
    }

    // Prohibited industry codes (auto-decline)
    const PROHIBITED_INDUSTRIES = ['gambling', 'adult', 'cannabis', 'firearms', 'crypto', 'collection', 'telemarketing', 'pawn'];
    
    // Handle industry dropdown change - show/hide fleet size for trucking
    function handleIndustryChange() {
      const industry = document.getElementById('industrySelect').value;
      const truckingSection = document.getElementById('truckingFleetSection');
      const modalTruckingSection = document.getElementById('modalTruckingFleetSection');
      const industryWarning = document.getElementById('industryWarning');
      const fleetWarning = document.getElementById('fleetWarning');
      
      // Show/hide trucking fleet section
      if (industry === 'trucking') {
        if (truckingSection) truckingSection.style.display = 'block';
        if (modalTruckingSection) modalTruckingSection.style.display = 'block';
        if (industryWarning) industryWarning.style.display = 'none';
        // Check fleet size
        const fleetSize = parseInt(document.getElementById('fleetSize').value) || 1;
        if (fleetWarning) fleetWarning.style.display = fleetSize < 5 ? 'block' : 'none';
      } else {
        if (truckingSection) truckingSection.style.display = 'none';
        if (modalTruckingSection) modalTruckingSection.style.display = 'none';
        if (fleetWarning) fleetWarning.style.display = 'none';
        // Show prohibited warning
        if (industryWarning) {
          industryWarning.style.display = PROHIBITED_INDUSTRIES.includes(industry) ? 'block' : 'none';
        }
      }
      
      calculate();
    }
    
    // Sync fleet size from modal to main
    function syncFleetSize(value) {
      const main = document.getElementById('fleetSize');
      if (main) {
        main.value = value;
        // Update fleet warning
        const fleetWarning = document.getElementById('fleetWarning');
        if (fleetWarning) fleetWarning.style.display = parseInt(value) < 5 ? 'block' : 'none';
        calculate();
      }
    }
    
    function calculate() {
      // Get values
      const revenue = parseInt(document.getElementById('monthlyRevenue').value) || 0;
      const balance = parseInt(document.getElementById('avgDailyBalance').value) || 0;
      const credit = parseInt(document.getElementById('creditScore').value) || 0;
      const tib = parseInt(document.getElementById('timeInBusiness').value) || 0;
      const nsf = parseInt(document.getElementById('nsfCount').value) || 0;
      const negDays = parseInt(document.getElementById('negativeDays').value) || 0;
      const existingDebtRaw = parseInt(document.getElementById('existingDebt').value) || 0;
      const existingDebtFreq = document.querySelector('input[name="existingDebtFreq"]:checked').value;
      
      // Convert existing debt to monthly
      let existingDebt = existingDebtRaw;
      if (existingDebtFreq === 'daily') {
        existingDebt = existingDebtRaw * 22; // ~22 business days/month
      } else if (existingDebtFreq === 'weekly') {
        existingDebt = existingDebtRaw * 4.33; // ~4.33 weeks/month
      }
      existingDebt = Math.round(existingDebt);
      
      // Get industry and check status
      const industry = document.getElementById('industrySelect').value;
      const isProhibited = PROHIBITED_INDUSTRIES.includes(industry);
      const fleetSize = parseInt(document.getElementById('fleetSize')?.value) || 1;
      const isTruckingDecline = industry === 'trucking' && fleetSize < 5;
      
      // Update fleet warning for trucking
      const fleetWarning = document.getElementById('fleetWarning');
      if (fleetWarning && industry === 'trucking') {
        fleetWarning.style.display = fleetSize < 5 ? 'block' : 'none';
      }

      // Update displays
      document.getElementById('revenueDisplay').textContent = formatCurrency(revenue);
      document.getElementById('balanceDisplay').textContent = formatCurrency(balance);
      document.getElementById('creditDisplay').textContent = credit;
      document.getElementById('tibDisplay').textContent = tib + ' mo';
      document.getElementById('nsfDisplay').textContent = nsf;
      document.getElementById('negDaysDisplay').textContent = negDays + ' days';
      
      // Update existing debt display with frequency label
      const debtFreqLabels = { daily: '/day', weekly: '/wk', monthly: '/mo' };
      document.getElementById('existingDebtDisplay').textContent = formatCurrency(existingDebtRaw);
      document.getElementById('existingDebtFreqLabel').textContent = debtFreqLabels[existingDebtFreq];

      // Calculate AblesAI score components using MODEL_WEIGHTS
      // Normalize weights to sum to 100
      const totalWeight = MODEL_WEIGHTS.revenue + MODEL_WEIGHTS.tib + MODEL_WEIGHTS.industry + MODEL_WEIGHTS.credit + MODEL_WEIGHTS.negDays;
      const normalize = 100 / totalWeight;

      const creditWeight = MODEL_WEIGHTS.credit * normalize;
      const revenueWeight = MODEL_WEIGHTS.revenue * normalize;
      const tibWeight = MODEL_WEIGHTS.tib * normalize;
      const negDaysWeight = MODEL_WEIGHTS.negDays * normalize;
      const industryWeight = MODEL_WEIGHTS.industry * normalize;

      // Credit score component (scaled to weight)
      const creditPts = credit < 500 ? 0 : Math.min(creditWeight, ((credit - 500) / 300) * creditWeight);
      
      // Behavior component (NSF + negative days) - uses negDays weight
      const events = nsf + negDays;
      const behavePts = events > 10 ? 0 : Math.max(0, negDaysWeight - (events * (negDaysWeight / 10)));
      
      // Revenue component (scaled to weight)
      const revPts = revenue < 7500 ? 0 : Math.min(revenueWeight, ((revenue - 7500) / 92500) * revenueWeight);
      
      // Time in business / stability component
      const stabPts = tib >= 36 ? tibWeight : tib >= 24 ? tibWeight * 0.7 : tib >= 12 ? tibWeight * 0.4 : tibWeight * 0.1;
      
      // Buffer / industry component (uses industry weight as proxy for risk buffer)
      const buffer = balance / revenue;
      const bufferPts = buffer >= 0.10 ? industryWeight : buffer >= 0.05 ? industryWeight * 0.5 : 0;

      // Total score (no restricted penalty - prohibited industries auto-decline)
      let totalScore = Math.round(creditPts + behavePts + revPts + stabPts + bufferPts);
      totalScore = Math.max(0, Math.min(100, totalScore));

      // Determine tier with safety valves
      let tier = getTier(totalScore);
      if (credit < 520) tier = 'E';
      else if (credit < 550 && (tier === 'A' || tier === 'B' || tier === 'C')) tier = 'D';
      else if (credit < 600 && (tier === 'A' || tier === 'B')) tier = 'C';

      let tierColors = TIER_COLORS[tier];
      let tierData = TIER_DATA[tier];

      // Update accent color
      document.documentElement.style.setProperty('--accent', tierColors.main);
      document.documentElement.style.setProperty('--accent-rgb', tierColors.rgb);

      // Top Credit Engine section updates (MODEL SCORE tab)
      document.getElementById('scoreValueTop').innerHTML = `${totalScore}<span class="text-lg font-semibold" style="color: var(--text-muted);">/100</span>`;
      document.getElementById('scoreValueTop').style.color = tierColors.main;
      document.getElementById('tierLetterTop').textContent = tier;
      document.getElementById('tierLetterTop').style.color = tierColors.main;
      document.getElementById('tierLabelTop').textContent = tierColors.label;
      document.getElementById('scoreHeaderBgTop').style.background = `linear-gradient(135deg, ${tierColors.main}15 0%, ${tierColors.main}05 100%)`;

      // Override Credit Engine section updates (MODEL OVERRIDE tab)
      document.getElementById('scoreValueOverride').innerHTML = `${totalScore}<span class="text-lg font-semibold" style="color: var(--text-muted);">/100</span>`;
      document.getElementById('scoreValueOverride').style.color = tierColors.main;
      document.getElementById('tierLetterOverride').textContent = tier;
      document.getElementById('tierLetterOverride').style.color = tierColors.main;
      document.getElementById('tierLabelOverride').textContent = tierColors.label;
      document.getElementById('scoreHeaderBgOverride').style.background = `linear-gradient(135deg, ${tierColors.main}15 0%, ${tierColors.main}05 100%)`;

      // Update breakdown bars
      document.getElementById('eventsLabelTop').textContent = events;
      document.getElementById('bufferPctTop').textContent = Math.round(buffer * 100);
      document.getElementById('eventsLabelOverride').textContent = events;
      document.getElementById('bufferPctOverride').textContent = Math.round(buffer * 100);

      // Credit bar (weight: 20)
      const creditPct = (creditPts / creditWeight) * 100;
      document.getElementById('barCreditTop').style.width = creditPct + '%';
      document.getElementById('barCreditTop').style.background = getBarColor(creditPct);
      document.getElementById('dotCreditTop').style.background = getBarColor(creditPct);
      document.getElementById('scoreCreditTop').textContent = Math.round(creditPts) + '/' + Math.round(creditWeight);
      document.getElementById('barCreditOverride').style.width = creditPct + '%';
      document.getElementById('barCreditOverride').style.background = getBarColor(creditPct);
      document.getElementById('dotCreditOverride').style.background = getBarColor(creditPct);
      document.getElementById('scoreCreditOverride').textContent = Math.round(creditPts) + '/' + Math.round(creditWeight);

      // Behavior bar (weight: 15)
      const behavePct = (behavePts / negDaysWeight) * 100;
      document.getElementById('barBehaviorTop').style.width = behavePct + '%';
      document.getElementById('barBehaviorTop').style.background = getBarColor(behavePct);
      document.getElementById('dotBehaviorTop').style.background = getBarColor(behavePct);
      document.getElementById('scoreBehaviorTop').textContent = Math.round(behavePts) + '/' + Math.round(negDaysWeight);
      document.getElementById('barBehaviorOverride').style.width = behavePct + '%';
      document.getElementById('barBehaviorOverride').style.background = getBarColor(behavePct);
      document.getElementById('dotBehaviorOverride').style.background = getBarColor(behavePct);
      document.getElementById('scoreBehaviorOverride').textContent = Math.round(behavePts) + '/' + Math.round(negDaysWeight);

      // Revenue bar (weight: 30)
      const revPct = (revPts / revenueWeight) * 100;
      document.getElementById('barRevenueTop').style.width = revPct + '%';
      document.getElementById('barRevenueTop').style.background = getBarColor(revPct);
      document.getElementById('dotRevenueTop').style.background = getBarColor(revPct);
      document.getElementById('scoreRevenueTop').textContent = Math.round(revPts) + '/' + Math.round(revenueWeight);
      document.getElementById('barRevenueOverride').style.width = revPct + '%';
      document.getElementById('barRevenueOverride').style.background = getBarColor(revPct);
      document.getElementById('dotRevenueOverride').style.background = getBarColor(revPct);
      document.getElementById('scoreRevenueOverride').textContent = Math.round(revPts) + '/' + Math.round(revenueWeight);

      // Stability bar (weight: 20)
      const stabPct = (stabPts / tibWeight) * 100;
      document.getElementById('barStabilityTop').style.width = stabPct + '%';
      document.getElementById('barStabilityTop').style.background = getBarColor(stabPct);
      document.getElementById('dotStabilityTop').style.background = getBarColor(stabPct);
      document.getElementById('scoreStabilityTop').textContent = Math.round(stabPts) + '/' + Math.round(tibWeight);
      document.getElementById('barStabilityOverride').style.width = stabPct + '%';
      document.getElementById('barStabilityOverride').style.background = getBarColor(stabPct);
      document.getElementById('dotStabilityOverride').style.background = getBarColor(stabPct);
      document.getElementById('scoreStabilityOverride').textContent = Math.round(stabPts) + '/' + Math.round(tibWeight);

      // Buffer bar (weight: 15)
      const bufferPctBar = (bufferPts / industryWeight) * 100;
      document.getElementById('barBufferTop').style.width = bufferPctBar + '%';
      document.getElementById('barBufferTop').style.background = getBarColor(bufferPctBar);
      document.getElementById('dotBufferTop').style.background = getBarColor(bufferPctBar);
      document.getElementById('scoreBufferTop').textContent = Math.round(bufferPts) + '/' + Math.round(industryWeight);
      document.getElementById('barBufferOverride').style.width = bufferPctBar + '%';
      document.getElementById('barBufferOverride').style.background = getBarColor(bufferPctBar);
      document.getElementById('dotBufferOverride').style.background = getBarColor(bufferPctBar);
      document.getElementById('scoreBufferOverride').textContent = Math.round(bufferPts) + '/' + Math.round(industryWeight);

      // Check for declines
      let declined = false;
      let declineReason = '';

      if (isProhibited) {
        declined = true;
        declineReason = 'Prohibited industry - not eligible for funding';
      } else if (isTruckingDecline) {
        declined = true;
        declineReason = 'Trucking requires minimum fleet size of 5 vehicles';
      } else if (credit < 500) {
        declined = true;
        declineReason = 'Credit score below minimum threshold (500)';
      } else if (revenue < 7500) {
        declined = true;
        declineReason = 'Monthly revenue below minimum threshold ($7,500)';
      } else if (events > 10) {
        declined = true;
        declineReason = 'Too many risk events (NSF + Negative Days > 10)';
      }

      // =====================================================
      // FUNDING CALCULATION - Calibrated to RC + 10%
      // Based on analysis of real RC offers
      // =====================================================
      
      // Base multiplier
      let fundingMult = 0.40;
      
      // TIB bonus (major driver - RC heavily rewards tenure)
      if (tib >= 240) fundingMult += 0.95;       // 20+ years
      else if (tib >= 120) fundingMult += 0.80;  // 10+ years
      else if (tib >= 60) fundingMult += 0.50;   // 5+ years
      else if (tib >= 36) fundingMult += 0.08;   // 3+ years
      else if (tib < 24) fundingMult -= 0.05;    // <2 years: penalty
      
      // Credit adjustment
      if (credit >= 780) fundingMult += 0.06;
      else if (credit >= 700) fundingMult += 0.03;
      else if (credit < 600) fundingMult -= 0.05;
      
      // Event penalty (context-sensitive)
      if (tib >= 60 && tib < 120) {
        fundingMult -= events * 0.16;  // 5-10yr TIB: harsh penalty
      } else if (tib >= 120) {
        fundingMult -= events * 0.08;  // 10+yr TIB: moderate
      } else {
        fundingMult -= events * 0.03;  // <5yr TIB: light (already low base)
      }
      
      // Revenue-based floor (larger businesses protected)
      let fundingFloor;
      if (revenue >= 100000) fundingFloor = 0.40;
      else if (revenue >= 50000) fundingFloor = 0.35;
      else fundingFloor = 0.33;
      
      fundingMult = Math.max(fundingMult, fundingFloor);
      
      // Apply +10% premium over RC
      fundingMult *= 1.04;
      
      let funding = Math.round(revenue * fundingMult);
      
      // Cap at $165k (10% above RC's typical $150k cap)
      funding = Math.min(funding, 165000);
      
      // =====================================================
      // EXISTING DEBT ADJUSTMENT
      // Cap funding so total debt service stays under 25% of revenue
      // =====================================================
      if (existingDebt > 0) {
        const maxDebtService = revenue * 0.25; // Max 25% of revenue for all debt
        const availableForNew = Math.max(0, maxDebtService - existingDebt);
        
        // Calculate what funding amount this supports
        // Use tier factor and term to estimate monthly payment
        const estFactor = tierData.factor;
        const estTerm = tierData.termMonths;
        const monthlyPaymentPerDollar = estFactor / estTerm;
        
        // Max funding = available monthly payment capacity / payment per dollar
        const maxFundingFromDebt = availableForNew / monthlyPaymentPerDollar;
        
        // Apply debt-based cap (but don't go below $10k if otherwise qualified)
        if (maxFundingFromDebt < funding) {
          funding = Math.max(10000, Math.round(maxFundingFromDebt));
        }
        
        // If existing debt already exceeds capacity, decline
        if (existingDebt >= maxDebtService && !declined) {
          declined = true;
          declineReason = 'Existing debt payments exceed available cash flow capacity';
        }
      }
      
      // Minimum $10k
      funding = Math.max(funding, 10000);
      
      if (funding < 10000 && !declined) {
        declined = true;
        declineReason = 'Qualified amount below minimum funding threshold ($10,000)';
      }

      const dailyRevenue = revenue / 22;

      // Update UI
      const approvedSection = document.getElementById('approvedSection');
      const declinedSection = document.getElementById('declinedSection');

      if (declined) {
        approvedSection.classList.add('hidden');
        declinedSection.classList.remove('hidden');
        document.getElementById('declineReason').textContent = declineReason;
        document.getElementById('resultCard').style.borderColor = '#ef4444';
        document.getElementById('calcRiskIndicators').style.display = 'none';
        document.getElementById('calcSummaryCard').style.display = 'none';
      } else {
        approvedSection.classList.remove('hidden');
        declinedSection.classList.add('hidden');
        document.getElementById('resultCard').style.borderColor = tierColors.main;
        document.getElementById('calcRiskIndicators').style.display = 'grid';

        // Update result header
        document.getElementById('resultLabel').textContent = `AblesAI Tier ${tier} - Approved`;

        // Calculate offer amounts first (needed for cash flow analysis)
        const payback = Math.round(funding * tierData.factor);
        const termDays = tierData.termMonths * 22;
        const dailyPayment = Math.round(payback / termDays * 100) / 100;
        const weeklyPayment = Math.round(payback / (tierData.termMonths * 4.33) * 100) / 100;
        const holdback = ((dailyPayment / dailyRevenue) * 100).toFixed(2);

        // Calculate monthly payment amounts for DSCR
        const monthlyPaymentDaily = dailyPayment * 22;
        const monthlyPaymentWeekly = weeklyPayment * 4.33;

        // Cash flow analysis for payment frequency decision
        const cashBuffer = balance / revenue; // balance to revenue ratio
        const debtBurdenPct = (existingDebt / revenue) * 100; // existing debt as % of revenue
        const totalEventsCount = nsf + negDays;
        
        // DSCR with weekly payments (including existing debt)
        const availableCashForDebt = revenue * 0.25; // Max 25% of revenue for debt service
        const totalMonthlyDebtWeekly = monthlyPaymentWeekly + existingDebt;
        const dscrWeekly = availableCashForDebt / totalMonthlyDebtWeekly;

        // Model decides payment frequency based on cash flow capacity
        // Weekly offered when merchant has strong cash flow metrics
        let paymentFreq = 'daily'; // default - safer for lender
        
        if (
          dscrWeekly >= 1.5 &&           // Healthy DSCR even with weekly payments
          debtBurdenPct <= 15 &&         // Low existing debt burden
          cashBuffer >= 0.08 &&          // Good cash buffer (8%+ of revenue)
          totalEventsCount <= 3          // Stable cash flow (few NSF/neg days)
        ) {
          paymentFreq = 'weekly';
        }

        // Set payment based on frequency
        let payment, paymentLabel, periodsPerMonth, daily;
        if (paymentFreq === 'weekly') {
          periodsPerMonth = 4.33;
          payment = weeklyPayment;
          daily = dailyPayment;
          paymentLabel = 'Weekly Payment';
        } else {
          periodsPerMonth = 22;
          payment = dailyPayment;
          daily = dailyPayment;
          paymentLabel = 'Daily Payment';
        }

        // Calculate APR based on payment frequency
        const totalCost = payback - funding;
        const effectiveRate = totalCost / funding;
        const termYears = tierData.termMonths / 12;
        let apr;
        if (paymentFreq === 'weekly') {
          apr = (effectiveRate / termYears) * 100 * 1.05; // Weekly 5% higher
        } else {
          apr = (effectiveRate / termYears) * 100 * 1.0; // Daily has lowest APR
        }
        apr = apr.toFixed(1);

        // Closing fees
        const origFee = Math.round(funding * 0.03);
        const adminFee = 995;
        const wireFee = 50;
        const netWire = funding - origFee - adminFee - wireFee;

        // Update offer display
        document.getElementById('offerFunding').textContent = formatCurrency(funding);
        document.getElementById('offerFactor').textContent = tierData.factor.toFixed(2) + 'x';
        document.getElementById('offerTerm').textContent = tierData.termMonths + ' Months';
        document.getElementById('offerPayback').textContent = formatCurrency(payback);
        document.getElementById('offerPayment').textContent = formatCurrency(Math.round(payment));
        document.getElementById('paymentFreqLabel').textContent = paymentLabel;
        document.getElementById('offerHoldback').textContent = holdback + '%';
        document.getElementById('offerAPR').textContent = apr + '%';

        // Update summary card
        document.getElementById('summaryTier').textContent = tier;
        document.getElementById('summaryTier').style.color = tierColors.main;
        document.getElementById('summaryScore').textContent = totalScore;
        document.getElementById('summaryFunding').textContent = formatCurrency(funding);
        document.getElementById('summaryFactor').textContent = tierData.factor.toFixed(2) + 'x';
        document.getElementById('summaryTerm').textContent = tierData.termMonths + ' mo';
        document.getElementById('calcSummaryCard').style.display = 'block';
        
        // Update summary score bar
        const scorePct = totalScore + '%';
        document.getElementById('summaryScoreFill').style.width = scorePct;
        document.getElementById('summaryScoreMarker').style.left = scorePct;
        document.getElementById('summaryScoreMarker').setAttribute('data-score', totalScore);

        // Update closing breakdown
        document.getElementById('closingGross').textContent = formatCurrency(funding);
        document.getElementById('closingOrig').textContent = '-' + formatCurrency(origFee);
        document.getElementById('closingNet').textContent = formatCurrency(netWire);

        // Update decision
        document.getElementById('decisionSection').style.background = `rgba(${tierColors.rgb}, 0.1)`;
        document.getElementById('decisionLabel').style.color = tierColors.main;
        document.getElementById('decisionStatus').style.color = tierColors.main;

        // Calculate and update Risk Indicators
        const tierPD = { A: 3, B: 6, C: 10, D: 18, E: 28 };
        const basePD = (tierPD[tier] || 10) * (MODEL_WEIGHTS.pdMultiplier / 100);
        
        // Update PD gauge
        const pdPct = basePD / 40;
        const arcLength = 188 * pdPct;
        document.getElementById('calcPdGaugeFill').setAttribute('stroke-dasharray', `${arcLength} 188`);
        
        let pdColor = '#10b981';
        if (basePD > 25) pdColor = '#ef4444';
        else if (basePD > 15) pdColor = '#f97316';
        else if (basePD > 5) pdColor = '#eab308';
        document.getElementById('calcPdGaugeFill').setAttribute('stroke', pdColor);
        
        // Position marker along arc (semicircle from 180deg to 0deg)
        const markerAngle = Math.PI * (1 - pdPct); // 180deg at 0%, 0deg at 100%
        const markerCx = 90 + 60 * Math.cos(markerAngle);
        const markerCy = 80 - 60 * Math.sin(markerAngle);
        document.getElementById('calcPdNeedle').setAttribute('cx', markerCx);
        document.getElementById('calcPdNeedle').setAttribute('cy', markerCy);
        document.getElementById('calcPdDisplay').textContent = basePD.toFixed(1) + '%';
        document.getElementById('calcPdValue').textContent = basePD.toFixed(1) + '%';
        document.getElementById('calcPdValue').style.color = pdColor;
        updateIndicatorBox('calcPdValue', pdColor);

        // Calculate DSCR (including existing debt)
        const monthlyDebt = payback / tierData.termMonths;
        const totalMonthlyDebt = monthlyDebt + existingDebt;
        const dscr = revenue / totalMonthlyDebt;
        
        document.getElementById('calcDscrMonthlyRev').textContent = formatCurrency(revenue);
        document.getElementById('calcDscrMonthlyDebt').textContent = formatCurrency(Math.round(totalMonthlyDebt)) + (existingDebt > 0 ? ' (incl. existing)' : '');
        document.getElementById('calcDscrRatio').textContent = dscr.toFixed(2) + 'x';
        document.getElementById('calcDscrBarValue').textContent = dscr.toFixed(2) + 'x';
        document.getElementById('calcDscrValue').textContent = dscr.toFixed(2) + 'x';

        // DSCR bar (scale 0-3x)
        const dscrPct = Math.min(100, (dscr / 3) * 100);
        document.getElementById('calcDscrBarFill').style.width = dscrPct + '%';
        
        let dscrColor = '#ef4444';
        if (dscr >= 2) dscrColor = '#10b981';
        else if (dscr >= 1.5) dscrColor = '#22c55e';
        else if (dscr >= 1.25) dscrColor = '#eab308';
        else if (dscr >= 1) dscrColor = '#f97316';
        
        document.getElementById('calcDscrBarFill').style.background = dscrColor;
        document.getElementById('calcDscrRatio').style.color = dscrColor;
        document.getElementById('calcDscrValue').style.color = dscrColor;
        updateIndicatorBox('calcDscrValue', dscrColor);

        // DSCR warning
        const dscrWarning = document.getElementById('calcDscrWarning');
        if (dscr < 1) {
          dscrWarning.style.display = 'block';
          dscrWarning.style.background = 'rgba(239, 68, 68, 0.1)';
          dscrWarning.style.color = '#ef4444';
          dscrWarning.innerHTML = '<strong>Critical:</strong> Cannot cover debt service from revenue.';
        } else if (dscr < 1.25) {
          dscrWarning.style.display = 'block';
          dscrWarning.style.background = 'rgba(249, 115, 22, 0.1)';
          dscrWarning.style.color = '#f97316';
          dscrWarning.innerHTML = '<strong>Warning:</strong> Minimal buffer for revenue fluctuations.';
        } else if (dscr >= 2) {
          dscrWarning.style.display = 'block';
          dscrWarning.style.background = 'rgba(16, 185, 129, 0.1)';
          dscrWarning.style.color = '#10b981';
          dscrWarning.innerHTML = '<strong>Healthy DSCR:</strong> Merchant has excellent revenue coverage for debt service.';
        } else {
          dscrWarning.style.display = 'none';
        }

        // Risk Level
        let riskLevel = 'Low';
        let riskColor = '#10b981';
        if (basePD > 20 || dscr < 1.25) {
          riskLevel = 'High';
          riskColor = '#ef4444';
        } else if (basePD > 12 || dscr < 1.5) {
          riskLevel = 'Medium';
          riskColor = '#eab308';
        }
        document.getElementById('calcRiskLevel').textContent = riskLevel;
        document.getElementById('calcRiskLevel').style.color = riskColor;
        updateIndicatorBox('calcRiskLevel', riskColor);

        // Store calculated values for override tab
        window.calcOffer = {
          funding: funding,
          factor: tierData.factor,
          term: tierData.termMonths,
          payback: payback,
          daily: daily,
          payment: payment,
          paymentFreq: paymentFreq,
          holdback: parseFloat(holdback),
          revenue: revenue,
          existingDebt: existingDebt,
          existingDebtRaw: existingDebtRaw,
          existingDebtFreq: existingDebtFreq,
          industry: industry,
          isProhibited: isProhibited,
          fleetSize: fleetSize,
          isTruckingDecline: isTruckingDecline,
          tier: tier,
          score: totalScore,
          tierColors: tierColors
        };
      }
    }

    // ============================================
    // OVERRIDE TAB FUNCTIONS
    // ============================================

    function calculateOverride() {
      if (!window.calcOffer) return;

      const calc = window.calcOffer;
      const overrideFunding = parseInt(document.getElementById('overrideFunding').value);
      const overrideFactor = parseFloat(document.getElementById('overrideFactor').value);
      const overrideTerm = parseInt(document.getElementById('overrideTerm').value);
      const paymentFreq = document.querySelector('input[name="overridePaymentFreq"]:checked').value;

      // Update displays
      document.getElementById('overrideFundingDisplay').textContent = formatCurrency(overrideFunding);
      document.getElementById('overrideFactorDisplay').textContent = overrideFactor.toFixed(2) + 'x';
      document.getElementById('overrideTermDisplay').textContent = overrideTerm + ' Months';

      // Calculate override offer
      const payback = Math.round(overrideFunding * overrideFactor);
      const termDays = overrideTerm * 22;
      const daily = Math.round(payback / termDays * 100) / 100;
      const dailyRevenue = calc.revenue / 22;
      const holdback = ((daily / dailyRevenue) * 100).toFixed(2);

      // Calculate payment based on frequency
      let payment, paymentLabel, calcPayment;
      if (paymentFreq === 'weekly') {
        const periodsPerMonth = 4.33;
        payment = Math.round(payback / (overrideTerm * periodsPerMonth) * 100) / 100;
        calcPayment = Math.round(calc.payback / (calc.term * periodsPerMonth) * 100) / 100;
        paymentLabel = 'Weekly Payment';
      } else if (paymentFreq === 'semiweekly') {
        const periodsPerMonth = 2;
        payment = Math.round(payback / (overrideTerm * periodsPerMonth) * 100) / 100;
        calcPayment = Math.round(calc.payback / (calc.term * periodsPerMonth) * 100) / 100;
        paymentLabel = 'Semi-Weekly Payment';
      } else if (paymentFreq === 'monthly') {
        payment = Math.round(payback / overrideTerm * 100) / 100;
        calcPayment = Math.round(calc.payback / calc.term * 100) / 100;
        paymentLabel = 'Monthly Payment';
      } else {
        payment = daily;
        calcPayment = calc.daily;
        paymentLabel = 'Daily Payment';
      }

      // Calculate APR based on payment frequency
      const totalCost = payback - overrideFunding;
      const effectiveRate = totalCost / overrideFunding;
      const termYears = overrideTerm / 12;
      let apr;
      if (paymentFreq === 'daily') {
        apr = (effectiveRate / termYears) * 100 * 1.0;
      } else if (paymentFreq === 'weekly') {
        apr = (effectiveRate / termYears) * 100 * 1.05;
      } else if (paymentFreq === 'semiweekly') {
        apr = (effectiveRate / termYears) * 100 * 1.10;
      } else {
        apr = (effectiveRate / termYears) * 100 * 1.20;
      }
      apr = apr.toFixed(1);

      // Closing fees
      const origFee = Math.round(overrideFunding * 0.03);
      const adminFee = 995;
      const wireFee = 50;
      const netWire = overrideFunding - origFee - adminFee - wireFee;

      // Update override result card
      document.getElementById('overrideOfferFunding').textContent = formatCurrency(overrideFunding);
      document.getElementById('overrideOfferFactor').textContent = overrideFactor.toFixed(2) + 'x';
      document.getElementById('overrideOfferTerm').textContent = overrideTerm + ' Months';
      document.getElementById('overrideOfferPayback').textContent = formatCurrency(payback);
      document.getElementById('overrideOfferPayment').textContent = formatCurrency(Math.round(payment));
      document.getElementById('overridePaymentFreqLabel').textContent = paymentLabel;
      document.getElementById('overrideOfferHoldback').textContent = holdback + '%';
      document.getElementById('overrideOfferAPR').textContent = apr + '%';

      // Update closing breakdown
      document.getElementById('overrideClosingGross').textContent = formatCurrency(overrideFunding);
      document.getElementById('overrideClosingOrig').textContent = '-' + formatCurrency(origFee);
      document.getElementById('overrideClosingNet').textContent = formatCurrency(netWire);

      // Calculate variances
      const fundingDiff = overrideFunding - calc.funding;
      const factorDiff = overrideFactor - calc.factor;
      const termDiff = overrideTerm - calc.term;
      const paybackDiff = payback - calc.payback;
      const paymentDiff = payment - calcPayment;

      // Update variance indicators
      updateVarianceIndicator('fundingVariance', fundingDiff, formatCurrency(Math.abs(fundingDiff)));
      updateVarianceIndicator('factorVariance', factorDiff, Math.abs(factorDiff).toFixed(2) + 'x');
      updateVarianceIndicator('termVariance', termDiff, Math.abs(termDiff) + ' mo');

      // Update comparison section
      document.getElementById('compFundingCalc').textContent = formatCurrency(calc.funding);
      document.getElementById('compFundingOverride').textContent = formatCurrency(overrideFunding);
      document.getElementById('compFundingDiff').textContent = (fundingDiff >= 0 ? '+' : '') + formatCurrency(fundingDiff);
      document.getElementById('compFundingDiff').style.color = fundingDiff > 0 ? '#10b981' : fundingDiff < 0 ? '#ef4444' : 'var(--text-muted)';

      document.getElementById('compPaybackCalc').textContent = formatCurrency(calc.payback);
      document.getElementById('compPaybackOverride').textContent = formatCurrency(payback);
      document.getElementById('compPaybackDiff').textContent = (paybackDiff >= 0 ? '+' : '') + formatCurrency(paybackDiff);
      document.getElementById('compPaybackDiff').style.color = paybackDiff > 0 ? '#ef4444' : paybackDiff < 0 ? '#10b981' : 'var(--text-muted)';

      document.getElementById('compPaymentLabel').textContent = paymentLabel;
      document.getElementById('compPaymentCalc').textContent = '$' + Math.round(calcPayment);
      document.getElementById('compPaymentOverride').textContent = '$' + Math.round(payment);
      document.getElementById('compPaymentDiff').textContent = (paymentDiff >= 0 ? '+' : '') + '$' + Math.round(paymentDiff);
      document.getElementById('compPaymentDiff').style.color = paymentDiff > 0 ? '#ef4444' : paymentDiff < 0 ? '#10b981' : 'var(--text-muted)';

      // Calculate Probability of Default (PD) - simplified model
      // Base PD from tier, adjusted by variance from calculated offer
      const tierPD = { A: 3, B: 6, C: 10, D: 18, E: 28 };
      let basePD = tierPD[calc.tier] || 10;
      
      // Adjust PD based on variance (higher funding = higher risk, higher factor = lower risk)
      const fundingRatio = overrideFunding / calc.funding;
      const factorRatio = overrideFactor / calc.factor;
      const termRatio = overrideTerm / calc.term;
      
      let pdAdjustment = 0;
      pdAdjustment += (fundingRatio - 1) * 15; // +15% PD per 100% increase in funding
      pdAdjustment -= (factorRatio - 1) * 8;   // -8% PD per factor increase (higher cost = lower risk to lender)
      pdAdjustment += (termRatio - 1) * 5;     // +5% PD per term extension
      
      const estimatedPD = Math.max(1, Math.min(40, basePD + pdAdjustment));
      
      // Update PD display
      document.getElementById('pdValue').textContent = estimatedPD.toFixed(1) + '%';
      document.getElementById('pdImpact').textContent = (pdAdjustment >= 0 ? '+' : '') + pdAdjustment.toFixed(1) + '%';
      const pdImpactColor = pdAdjustment > 2 ? '#ef4444' : pdAdjustment < -2 ? '#10b981' : '#eab308';
      document.getElementById('pdImpact').style.color = pdImpactColor;
      updateIndicatorBox('pdImpact', pdImpactColor);

      // Update PD gauge
      const pdPct = estimatedPD / 40; // 40% max
      const arcLength = 188 * pdPct;
      document.getElementById('pdGaugeFill').setAttribute('stroke-dasharray', `${arcLength} 188`);
      
      // Color based on PD level
      let pdColor = '#10b981';
      if (estimatedPD > 25) pdColor = '#ef4444';
      else if (estimatedPD > 15) pdColor = '#f97316';
      else if (estimatedPD > 5) pdColor = '#eab308';
      document.getElementById('pdGaugeFill').setAttribute('stroke', pdColor);
      
      // Position marker along arc (semicircle from 180deg to 0deg)
      const markerAngle = Math.PI * (1 - pdPct);
      const markerCx = 90 + 60 * Math.cos(markerAngle);
      const markerCy = 80 - 60 * Math.sin(markerAngle);
      document.getElementById('pdNeedle').setAttribute('cx', markerCx);
      document.getElementById('pdNeedle').setAttribute('cy', markerCy);

      // Calculate DSCR
      const monthlyDebt = payback / overrideTerm;
      const dscr = calc.revenue / monthlyDebt;
      
      document.getElementById('dscrMonthlyRev').textContent = formatCurrency(calc.revenue);
      document.getElementById('dscrMonthlyDebt').textContent = formatCurrency(Math.round(monthlyDebt));
      document.getElementById('dscrRatio').textContent = dscr.toFixed(2) + 'x';
      document.getElementById('dscrBarValue').textContent = dscr.toFixed(2) + 'x';
      document.getElementById('dscrImpact').textContent = dscr.toFixed(2) + 'x';

      // DSCR bar (scale 0-3x)
      const dscrPct = Math.min(100, (dscr / 3) * 100);
      document.getElementById('dscrBarFill').style.width = dscrPct + '%';
      
      // DSCR color
      let dscrColor = '#ef4444';
      if (dscr >= 2) dscrColor = '#10b981';
      else if (dscr >= 1.5) dscrColor = '#22c55e';
      else if (dscr >= 1.25) dscrColor = '#eab308';
      else if (dscr >= 1) dscrColor = '#f97316';
      
      document.getElementById('dscrBarFill').style.background = dscrColor;
      document.getElementById('dscrRatio').style.color = dscrColor;
      document.getElementById('dscrImpact').style.color = dscrColor;
      updateIndicatorBox('dscrImpact', dscrColor);

      // Risk score
      let riskLevel = 'Low';
      let riskColor = '#10b981';
      if (estimatedPD > 20 || dscr < 1.25) { riskLevel = 'High'; riskColor = '#ef4444'; }
      else if (estimatedPD > 12 || dscr < 1.5) { riskLevel = 'Medium'; riskColor = '#eab308'; }
      
      document.getElementById('riskScore').textContent = riskLevel;
      document.getElementById('riskScore').style.color = riskColor;
      updateIndicatorBox('riskScore', riskColor);

      // DSCR warning
      const dscrWarning = document.getElementById('dscrWarning');
      if (dscr < 1) {
        dscrWarning.style.display = 'block';
        dscrWarning.style.background = 'rgba(239, 68, 68, 0.1)';
        dscrWarning.style.color = '#ef4444';
        dscrWarning.innerHTML = '<strong>Warning:</strong> DSCR below 1.0x indicates merchant cannot cover debt service from revenue.';
      } else if (dscr < 1.25) {
        dscrWarning.style.display = 'block';
        dscrWarning.style.background = 'rgba(249, 115, 22, 0.1)';
        dscrWarning.style.color = '#f97316';
        dscrWarning.innerHTML = '<strong>Caution:</strong> DSCR below 1.25x leaves minimal buffer for revenue fluctuations.';
      } else if (dscr >= 2) {
        dscrWarning.style.display = 'block';
        dscrWarning.style.background = 'rgba(16, 185, 129, 0.1)';
        dscrWarning.style.color = '#10b981';
        dscrWarning.innerHTML = '<strong>Healthy DSCR:</strong> Merchant has excellent revenue coverage for debt service.';
      } else {
        dscrWarning.style.display = 'none';
      }

      // Update override decision styling based on risk
      const tierColors = calc.tierColors;
      document.getElementById('overrideResultCard').style.borderColor = riskColor;
      document.getElementById('overrideDecisionSection').style.background = `rgba(${riskColor === '#10b981' ? '16, 185, 129' : riskColor === '#eab308' ? '234, 179, 8' : '239, 68, 68'}, 0.1)`;
      document.getElementById('overrideDecisionStatus').style.color = riskColor;
    }

    function updateVarianceIndicator(elementId, diff, formattedDiff) {
      const el = document.getElementById(elementId);
      if (Math.abs(diff) < 0.001) {
        el.className = 'variance-indicator neutral';
        el.innerHTML = `<svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14"/></svg><span>No variance from calculated</span>`;
      } else if (diff > 0) {
        el.className = 'variance-indicator positive';
        el.innerHTML = `<svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"/></svg><span>+${formattedDiff} above calculated</span>`;
      } else {
        el.className = 'variance-indicator negative';
        el.innerHTML = `<svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg><span>-${formattedDiff} below calculated</span>`;
      }
    }

    function resetOverride() {
      if (!window.calcOffer) return;
      
      const calc = window.calcOffer;
      document.getElementById('overrideFunding').value = calc.funding;
      document.getElementById('overrideFactor').value = calc.factor;
      document.getElementById('overrideTerm').value = calc.term;
      
      // Reset payment frequency to daily (model default)
      document.querySelector('input[name="overridePaymentFreq"][value="daily"]').checked = true;
      
      calculateOverride();
    }

    function syncOverrideTab() {
      if (!window.calcOffer) return;
      
      const calc = window.calcOffer;
      
      // Update header displays
      document.getElementById('overrideTierDisplay').textContent = calc.tier;
      document.getElementById('overrideTierDisplay').style.color = calc.tierColors.main;
      document.getElementById('overrideScoreDisplay').textContent = calc.score;
      document.getElementById('calcFundingDisplay').textContent = formatCurrency(calc.funding);
      document.getElementById('calcFactorDisplay').textContent = calc.factor.toFixed(2) + 'x';
      document.getElementById('calcTermDisplay').textContent = calc.term + ' mo';
      
      // Update override score bar
      const scorePct = calc.score + '%';
      document.getElementById('overrideScoreFill').style.width = scorePct;
      document.getElementById('overrideScoreMarker').style.left = scorePct;
      document.getElementById('overrideScoreMarker').setAttribute('data-score', calc.score);

      // Update reference values
      document.getElementById('calcFundingRef').textContent = formatCurrency(calc.funding);
      document.getElementById('calcFactorRef').textContent = calc.factor.toFixed(2) + 'x';
      document.getElementById('calcTermRef').textContent = calc.term + ' mo';

      // Sync payment frequency - default to daily (model default)
      document.querySelector('input[name="overridePaymentFreq"][value="daily"]').checked = true;

      // Set slider ranges based on calculated values
      const fundingSlider = document.getElementById('overrideFunding');
      fundingSlider.min = Math.max(5000, calc.funding * 0.5);
      fundingSlider.max = Math.min(150000, calc.funding * 2);
      fundingSlider.value = calc.funding;

      document.getElementById('overrideFactor').value = calc.factor;
      document.getElementById('overrideTerm').value = calc.term;

      calculateOverride();
    }

    // Tab Switching
    function switchTab(tabName) {
      document.querySelectorAll('.tab-panel').forEach(panel => {
        panel.classList.remove('active');
      });
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      document.getElementById('tab-' + tabName).classList.add('active');
      event.currentTarget.classList.add('active');
      
      // Hide/show FAB based on tab (hide on MODEL INFO)
      const fab = document.getElementById('sliderFab');
      if (fab) {
        if (tabName === 'model') {
          fab.style.display = 'none';
        } else {
          fab.style.display = '';
        }
      }
      
      if (tabName === 'calculator') {
        calculate();
      } else if (tabName === 'override') {
        syncOverrideTab();
      }
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      loadSavedSettings();
      calculate();
    });
  </script>

</body>
</html>
